{"meta":{"title":"å¸•å¸•'s Blog","subtitle":"è®°å½•ç‚¹ç‚¹æ»´æ»´","description":"å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚","author":"å¸•å¸•","url":"https://hparis.github.io/blog"},"pages":[{"title":"Categories","date":"2018-03-19T14:23:35.140Z","updated":"2018-03-08T07:22:12.283Z","comments":true,"path":"categories/index.html","permalink":"https://hparis.github.io/blog/categories/index.html","excerpt":"","text":""},{"title":"About","date":"2018-03-27T03:24:57.172Z","updated":"2018-03-27T03:24:57.153Z","comments":true,"path":"about/index.html","permalink":"https://hparis.github.io/blog/about/index.html","excerpt":"","text":"å·¥ä½œç»å†åŒ—äº¬å“å† å¤©æˆç§‘æŠ€æœ‰é™å…¬å¸iOS é«˜çº§å·¥ç¨‹å¸ˆï¼ˆ2016.08 - è‡³ä»Šï¼‰ è´Ÿè´£æ—¥å¸¸çš„äº§å“ç ”å‘å’Œç»´æŠ¤å·¥ä½œ è´Ÿè´£å¯¹æ–°æŠ€æœ¯çš„ç ”ç©¶ä¸åº”ç”¨ è´Ÿè´£ä»£ç çš„é‡æ„å’Œå°è£… å®šåˆ¶é¡¹ç›®çš„å¼€å‘ å¾®ä¿¡å°ç¨‹åºçš„å¼€å‘ React Native çš„å¼€å‘ è‡ªåŠ¨åŒ–æ‰“åŒ…æµç¨‹ åŒ—äº¬é»‘ç±³ä¸–çºªç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸iOS é«˜çº§å·¥ç¨‹å¸ˆï¼ˆ2013.03 - 2016.08ï¼‰ Review å›¢é˜Ÿæˆå‘˜ä»£ç ï¼Œæå‡ºæŒ‡å¯¼æ„è§ è´Ÿè´£å¯¹è¿›è¡Œæ¶æ„è®¾è®¡ã€å¼€å‘ã€æ€§èƒ½åˆ†æå’Œä¼˜åŒ–ï¼Œåˆ†æå’Œå‘ç°ç³»ç»Ÿçš„ä¼˜åŒ–ç‚¹ æ–°æŠ€æœ¯çš„å­¦ä¹ å¹¶æ¨åŠ¨å›¢é˜Ÿæˆå‘˜çš„æŠ€æœ¯è¿›æ­¥ ä¸ºäº§å“éƒ¨é—¨æä¾›æŠ€æœ¯æ”¯æŒï¼Œæå‡ºäº§å“çš„ä¸è¶³ä¹‹å¤„ï¼Œå¸®åŠ©æ”¹è¿›äº§å“ é‡æ„ä»£ç ï¼Œå°è£…å¸¸ç”¨çš„å·¥å…·å’Œå…¬å¸çš„åŸºç¡€ä¸šåŠ¡ æ—¥å¸¸çš„ç ”å‘ç¼–ç å·¥ä½œ è´Ÿè´£å®¢æˆ·ç«¯å›¢é˜Ÿçš„æ‹›è˜å·¥ä½œ"},{"title":"Tags","date":"2018-03-08T08:19:23.811Z","updated":"2018-03-08T07:22:12.283Z","comments":true,"path":"tags/index.html","permalink":"https://hparis.github.io/blog/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"self åœ¨ block ä¸­çš„å¼•ç”¨è®¡æ•°å˜åŒ–","slug":"self-åœ¨-block-ä¸­çš„å¼•ç”¨è®¡æ•°å˜åŒ–","date":"2018-04-19T11:34:51.000Z","updated":"2018-04-23T08:21:10.189Z","comments":true,"path":"2018/04/19/self-åœ¨-block-ä¸­çš„å¼•ç”¨è®¡æ•°å˜åŒ–/","link":"","permalink":"https://hparis.github.io/blog/2018/04/19/self-åœ¨-block-ä¸­çš„å¼•ç”¨è®¡æ•°å˜åŒ–/","excerpt":"","text":"ç›¸ä¿¡å¤§å®¶åœ¨ Objective-C ä¸­éƒ½ä¼šé€šè¿‡ __waek çš„ä¿®é¥°ç¬¦æ¥ä¿è¯ block å’Œ self ä¸ä¼šäº’ç›¸å¼•ç”¨ï¼Œä»£ç å¦‚ä¸‹: 12345__weak typeof(self) weakSelf = self;self.block = ^&#123; __strong typeof(self) strongSelf = self; ...&#125; ä½†æ˜¯ä½ æ€è€ƒè¿‡ self åœ¨è¿™ä¸€æ®µæ—…ç¨‹ä¸­çš„å¼•ç”¨è®¡æ•°å˜åŒ–ä¹ˆï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šé€šè¿‡ä¸‰ä¸ªä¾‹å­æ¥å±•ç¤ºè¿™ä¸€æ®µæ—…ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ 123456789101112131415161718192021222324252627282930// ğŸŒ°1NSLog(@&quot;Before blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self)));self.block = ^&#123; self; NSLog(@&quot;Within blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self)));&#125;;self.block();NSLog(@&quot;After blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self)));// ğŸŒ°2__weak typeof(self) weakSelf = self;NSLog(@&quot;Before blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self)));self.block = ^&#123; weakSelf; NSLog(@&quot;Within blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(weakSelf)));&#125;;self.block();NSLog(@&quot;After blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self)));// ğŸŒ°3__weak typeof(self) weakSelf = self;NSLog(@&quot;Before blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self)));self.block = ^&#123; __strong typeof(self) strongSelf = weakSelf; NSLog(@&quot;Within blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(weakSelf)));&#125;;self.block();NSLog(@&quot;After blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self))); æˆ‘ä»¬å¯ä»¥é€šè¿‡ Clang å¯¹ä¸Šé¢çš„ä¸‰ä¸ªä¾‹å­åšä¸€ä¸‹ç¼–è¯‘ï¼Œé€šè¿‡ç¼–è¯‘åçš„ C ä»£ç ï¼ˆæ¥ä¸‹æ¥æ‰€å±•ç¤ºä»£ç éƒ½æ˜¯ç»è¿‡ç®€åŒ–ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡º self çš„å¼•ç”¨è®¡æ•°å˜åŒ–ã€‚ ğŸŒ°1 çš„ C ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647// Block ç»“æ„ä½“ã€‚è¿™ä¸ªå¤§å®¶å¯ä»¥é€šè¿‡å…¶ä»–çš„èµ„æ–™å»çœ‹çœ‹ï¼Œæˆ‘ä»¬ä»Šå¤©ä¸»è¦æ˜¯æ¥æ¢å¯»ä¸€ä¸‹ self çš„æ—…ç¨‹ï¼Œè¿™é‡Œå°±ä¸å¯¹ Block æœ¬èº«åšæ›´è¯¦ç»†çš„ä»‹ç»struct __block_impl &#123; void *isa; int Flags; int Reserved; void *FuncPtr;&#125;;// ^&#123;&#125; çš„å®ç°struct __BlockTest__test_block_impl_0 &#123; struct __block_impl impl; struct __BlockTest__test_block_desc_0* Desc; BlockTest *const __strong self; __BlockTest__test_block_impl_0(void *fp, struct __BlockTest__test_block_desc_0 *desc, BlockTest *const __strong _self, int flags=0) : self(_self) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125;&#125;;// Block æ–¹æ³•static void __BlockTest__test_block_func_0(struct __BlockTest__test_block_impl_0 *__cself) &#123; BlockTest *const __strong self = __cself-&gt;self; // bound by copy self;&#125;// Block çš„ copy æ“ä½œstatic void __BlockTest__test_block_copy_0(struct __BlockTest__test_block_impl_0*dst, struct __BlockTest__test_block_impl_0*src) &#123;_Block_object_assign((void*)&amp;dst-&gt;self, (void*)src-&gt;self, 3/*BLOCK_FIELD_IS_OBJECT*/);&#125;// Block çš„ dispose æ“ä½œstatic void __BlockTest__test_block_dispose_0(struct __BlockTest__test_block_impl_0*src) &#123;_Block_object_dispose((void*)src-&gt;self, 3/*BLOCK_FIELD_IS_OBJECT*/);&#125;// æè¿° Block çš„ copy å’Œ disposestatic struct __BlockTest__test_block_desc_0 &#123; size_t reserved; size_t Block_size; void (*copy)(struct __BlockTest__test_block_impl_0*, struct __BlockTest__test_block_impl_0*); void (*dispose)(struct __BlockTest__test_block_impl_0*);&#125; __BlockTest__test_block_desc_0_DATA = &#123; 0, sizeof(struct __BlockTest__test_block_impl_0), __BlockTest__test_block_copy_0, __BlockTest__test_block_dispose_0&#125;;// æ–¹æ³•ä¸»ä½“static void _I_BlockTest_test(BlockTest * self, SEL _cmd) &#123; ((void (*)(id, SEL, void (*)()))(void *)objc_msgSend)((id)self, sel_registerName(&quot;setBlock:&quot;), ((void (*)())&amp;__BlockTest__test_block_impl_0((void *)__BlockTest__test_block_func_0, &amp;__BlockTest__test_block_desc_0_DATA, self, 570425344))); ((void (*(*)(id, SEL))())(void *)objc_msgSend)((id)self, sel_registerName(&quot;block&quot;))();&#125; åœ¨æ–¹æ³•ä¸»ä½“é‡Œé¢é¦–å…ˆä¼šæ„é€ ä¸€ä¸ª __BlockTest__test_block_impl_0 çš„ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“æ•è·äº† selfï¼› __BlockTest__test_block_impl_0 çš„æ„é€ å‡½æ•°ä¸­ä½¿ç”¨äº† __strong æ¥æ•è· selfï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“åœ¨æ„é€ çš„æ—¶å€™é»˜è®¤æ˜¯ä½¿ç”¨ __strong æ¥æ•è·å¤–éƒ¨çš„å¯¹è±¡å˜é‡ï¼Œæ­¤æ—¶ self çš„å¼•ç”¨è®¡æ•°åº”è¯¥è¦ +1ï¼› Block è¢«æ„é€ å‡ºæ¥ä¹‹åéœ€è¦è¢«èµ‹å€¼ç»™ selfï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ ARC æ¨¡å¼ä¸‹æ­¤æ—¶çš„ Block ä¼šæ‰§è¡Œ Copy æ“ä½œï¼Œä» _NSConcreteStackBlock å˜æˆ _NSMallocBlockï¼› Block é€šè¿‡ __BlockTest__test_block_desc_0_DATA æ‰¾åˆ° Copy æ–¹æ³•çš„å…·ä½“å®ç° __BlockTest__test_block_copy_0ï¼Œä»ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬çŸ¥é“è¯¥æ–¹æ³•çš„å®ç°æ˜¯é€šè¿‡ _Block_object_assign æ¥å®ç°çš„ï¼ˆå¯¹äºè¿™ä¸ªæ–¹æ³•çš„å®ç°ç»†èŠ‚æš‚æ—¶è¿˜æ²¡æœ‰æ‰¾åˆ°æ›´ç›¸ä¿¡çš„èµ„æ–™ï¼Œæœ‰çŸ¥é“çš„å¯ä»¥éº»çƒ¦å‘Šè¯‰ä¸€ä¸‹ï¼‰ï¼Œé€šè¿‡åå­—æˆ‘ä»¬å¯ä»¥çŒœæµ‹å‡ºè¯¥æ–¹æ³•åªæ˜¯æŠŠæ•è·çš„å˜é‡åœ°å€ç›´æ¥æ‹·è´ä¸€ä»½åˆ°å †å†…å­˜ä¸­ï¼Œä½†æ˜¯ä¸ä¼šå¼•èµ·å¼•ç”¨è®¡æ•°çš„å˜åŒ–ï¼› å½“ Block è¢«çœŸæ­£æ‰§è¡Œçš„æ—¶å€™ä¼šé€šè¿‡ __block_impl çš„ FuncPtr æ‰¾åˆ°çœŸæ­£çš„å®ç°ä»£ç  __BlockTest__test_block_func_0ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢æœ‰è¿™æ ·ä¸€å¥ä»£ç  BlockTest *const __strong self = __cself-&gt;selfï¼Œå¾ˆæ˜æ˜¾æ­¤æ—¶ self çš„å¼•ç”¨è®¡æ•°ä¼š +1ï¼Œå½“è¯¥ __BlockTest__test_block_func_0 æ‰§è¡Œå®Œæ¯•ä¹‹åè¿˜æ˜¯ä¼šé‡Šæ”¾ self çš„ï¼Œæ­¤æ—¶å¼•ç”¨è®¡æ•°ä¼š -1ï¼› ä»ä¸Šé¢çš„åˆ†æè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ç”±äº Block åœ¨æ„é€ çš„æ—¶å€™é»˜è®¤å°±å¯¹æ•è·çš„ self è¿›è¡Œäº†å¼ºå¼•ç”¨ï¼Œå¯¼è‡´ self çš„å¼•ç”¨è®¡æ•° +1ï¼›è€Œåˆç”±äº self æŒæœ‰äº† Blockï¼Œæ‰€ä»¥è¿™é‡Œå°±é€ æˆäº†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ æˆ‘ä»¬æ¥çœ‹ ğŸŒ°2 èƒ½ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ ğŸŒ°2 çš„ C ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839// ^&#123;&#125; ç»“æ„ä½“struct __BlockTest__test_block_impl_0 &#123; struct __block_impl impl; struct __BlockTest__test_block_desc_0* Desc; BlockTest *const __weak weakSelf; __BlockTest__test_block_impl_0(void *fp, struct __BlockTest__test_block_desc_0 *desc, BlockTest *const __weak _weakSelf, int flags=0) : weakSelf(_weakSelf) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125;&#125;;// Block æ–¹æ³•static void __BlockTest__test_block_func_0(struct __BlockTest__test_block_impl_0 *__cself) &#123; BlockTest *const __weak weakSelf = __cself-&gt;weakSelf; // bound by copy weakSelf;&#125;// Block çš„ copy æ“ä½œstatic void __BlockTest__test_block_copy_0(struct __BlockTest__test_block_impl_0*dst, struct __BlockTest__test_block_impl_0*src) &#123;_Block_object_assign((void*)&amp;dst-&gt;weakSelf, (void*)src-&gt;weakSelf, 3/*BLOCK_FIELD_IS_OBJECT*/);&#125;// Block çš„ dispose æ“ä½œstatic void __BlockTest__test_block_dispose_0(struct __BlockTest__test_block_impl_0*src) &#123;_Block_object_dispose((void*)src-&gt;weakSelf, 3/*BLOCK_FIELD_IS_OBJECT*/);&#125;// æè¿° Block çš„ copy å’Œ disposestatic struct __BlockTest__test_block_desc_0 &#123; size_t reserved; size_t Block_size; void (*copy)(struct __BlockTest__test_block_impl_0*, struct __BlockTest__test_block_impl_0*); void (*dispose)(struct __BlockTest__test_block_impl_0*);&#125; __BlockTest__test_block_desc_0_DATA = &#123; 0, sizeof(struct __BlockTest__test_block_impl_0), __BlockTest__test_block_copy_0, __BlockTest__test_block_dispose_0&#125;;// æ–¹æ³•ä¸»ä½“static void _I_BlockTest_test(BlockTest * self, SEL _cmd) &#123; __attribute__((objc_ownership(weak))) typeof(self) weakSelf = self; ((void (*)(id, SEL, void (*)()))(void *)objc_msgSend)((id)self, sel_registerName(&quot;setBlock:&quot;), ((void (*)())&amp;__BlockTest__test_block_impl_0((void *)__BlockTest__test_block_func_0, &amp;__BlockTest__test_block_desc_0_DATA, weakSelf, 570425344))); ((void (*(*)(id, SEL))())(void *)objc_msgSend)((id)self, sel_registerName(&quot;block&quot;))();&#125; æ–¹æ³•ä¸»ä½“ä¼šå…ˆç”¨ __weak åˆå§‹åŒ–ä¸€ä¸ª weakSelfï¼Œæ­¤æ—¶ self çš„å¼•ç”¨è®¡æ•°æ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼›ä¹‹åä¼šæ„é€ ä¸€ä¸ª__BlockTest__test_block_impl_0 çš„ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“æ•è·äº† weakSelfï¼› __BlockTest__test_block_impl_0 çš„æ„é€ å‡½æ•°ä¸­ä½¿ç”¨äº† __weak æ¥æ•è· weakSelfï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“æ­¤æ—¶ self çš„å¼•ç”¨è®¡æ•°åº”è¯¥è¦ä¹Ÿæ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼› ç„¶åæŠŠè¯¥ç»“æ„ä½“èµ‹å€¼ç»™ self.blockï¼Œblock ç»“æ„ä½“è¢«ä»æ ˆå¤åˆ¶åˆ°å †çš„æ—¶å€™ä½¿ç”¨äº† _Block_object_assignï¼Œæ‰€ä»¥æ­¤æ—¶ self çš„å¼•ç”¨è®¡æ•°ä¸ä¼šå‘ç”Ÿå˜åŒ– ç„¶å block åœ¨è¢«æ‰§è¡Œçš„æ—¶å€™åšäº†ä¸€ä¸‹ __weak çš„æ“ä½œ BlockTest *const __weak weakSelf = __cself-&gt;weakSelfï¼Œè¿™æ—¶å€™ self çš„å¼•ç”¨è®¡æ•°ä¹Ÿä¸ä¼šå‘ç”Ÿå˜åŒ– ç”±äº block å¯¹ weakSelf æ²¡æœ‰å¼ºå¼•ç”¨ï¼Œæ‰€ä»¥åœ¨ block æ‰§è¡Œå®Œæˆä¹‹åä¹Ÿä¸éœ€è¦åšé‡Šæ”¾ weakSelf çš„å·¥ä½œ æ‰€ä»¥ï¼Œåœ¨è¯¥ä¾‹å­ä¸­ block æ— æ³•å¼ºå¼•ç”¨ weakSelfï¼ŒweakSelf çš„å¼•ç”¨è®¡æ•°æ²¡æœ‰å‘ç”Ÿä»»ä½•å˜åŒ–ã€‚ç”±äº self æ²¡æœ‰è¢« block å¼ºåº”ç”¨ï¼Œæ‰€ä»¥å½“ self è¦è¢«é‡Šæ”¾çš„æ—¶å€™ï¼Œblock ä¹Ÿä¼šè¢«é‡Šæ”¾ï¼Œè¿™å°±è§£å†³äº†æˆ‘ä»¬ ğŸŒ°1 ä¸­çš„å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ä½†æ˜¯åœ¨ block æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œself å¯¹è±¡æœ‰å¯èƒ½å·²ç»è¢«é‡Šæ”¾äº†ï¼Œæ­¤æ—¶å¦‚æœä½ è¿˜å»ä½¿ç”¨ weakSelf å°±æœ‰å¯èƒ½é€ æˆå¥”æºƒçš„æƒ…å†µã€‚ ğŸŒ°3 çš„ C ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233struct __BlockTest__test_block_impl_0 &#123; struct __block_impl impl; struct __BlockTest__test_block_desc_0* Desc; BlockTest *const __weak weakSelf; __BlockTest__test_block_impl_0(void *fp, struct __BlockTest__test_block_desc_0 *desc, BlockTest *const __weak _weakSelf, int flags=0) : weakSelf(_weakSelf) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125;&#125;;static void __BlockTest__test_block_func_0(struct __BlockTest__test_block_impl_0 *__cself) &#123; BlockTest *const __weak weakSelf = __cself-&gt;weakSelf; // bound by copy __attribute__((objc_ownership(strong))) typeof(self) strongSelf = weakSelf; &#125;static void __BlockTest__test_block_copy_0(struct __BlockTest__test_block_impl_0*dst, struct __BlockTest__test_block_impl_0*src) &#123;_Block_object_assign((void*)&amp;dst-&gt;weakSelf, (void*)src-&gt;weakSelf, 3/*BLOCK_FIELD_IS_OBJECT*/);&#125;static void __BlockTest__test_block_dispose_0(struct __BlockTest__test_block_impl_0*src) &#123;_Block_object_dispose((void*)src-&gt;weakSelf, 3/*BLOCK_FIELD_IS_OBJECT*/);&#125;static struct __BlockTest__test_block_desc_0 &#123; size_t reserved; size_t Block_size; void (*copy)(struct __BlockTest__test_block_impl_0*, struct __BlockTest__test_block_impl_0*); void (*dispose)(struct __BlockTest__test_block_impl_0*);&#125; __BlockTest__test_block_desc_0_DATA = &#123; 0, sizeof(struct __BlockTest__test_block_impl_0), __BlockTest__test_block_copy_0, __BlockTest__test_block_dispose_0&#125;;static void _I_BlockTest_test(BlockTest * self, SEL _cmd) &#123; __attribute__((objc_ownership(weak))) typeof(self) weakSelf = self; ((void (*)(id, SEL, void (*)()))(void *)objc_msgSend)((id)self, sel_registerName(&quot;setBlock:&quot;), ((void (*)())&amp;__BlockTest__test_block_impl_0((void *)__BlockTest__test_block_func_0, &amp;__BlockTest__test_block_desc_0_DATA, weakSelf, 570425344))); ((void (*(*)(id, SEL))())(void *)objc_msgSend)((id)self, sel_registerName(&quot;block&quot;))(); &#125; å‰é¢çš„æ­¥éª¤éƒ½è·Ÿ ğŸŒ°2 ä¸­çš„ä¸€æ ·ï¼Œå…³é”®æ˜¯åœ¨ Block çš„æ–¹æ³•å®ç°é‡Œé¢æœ‰ç‚¹ä¸ä¸€æ ·ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ __BlockTest__test_block_func_0ï¼Œå®ƒé¦–å…ˆè°ƒç”¨äº† BlockTest *const __weak weakSelf = __cself-&gt;weakSelfï¼Œ æ‰€ä»¥å®ƒæ­¤æ—¶çš„å¼•ç”¨è®¡æ•°ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼›ä½†æ˜¯æ¥ä¸‹æ¥åˆç”¨ objc_ownership(strong) æ¥å¼ºå¼•ç”¨ weakSelfï¼Œæ‰€ä»¥æ­¤æ—¶ self çš„å¼•ç”¨è®¡æ•° +1ã€‚è¿™å°±ä¿è¯äº†åœ¨å‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼ŒBlock ä¼šä¸€ç›´æŒæœ‰ selfï¼ŒçŸ¥é“ Block æ‰§è¡Œå®Œæ¯•ä¹‹åä¼šé‡Šæ”¾ weakSelfã€‚ æ‰€ä»¥ ğŸŒ°3 å®Œç¾çš„è§£å†³äº†å¾ªç¯åº”ç”¨å’Œç›´æ¥ä½¿ç”¨ __weak å¯èƒ½å¯¼è‡´å¥”æºƒçš„é—®é¢˜ã€‚ æœ€åï¼Œè¯´ä¸€ä¸‹å…³äº _Block_object_assign çš„çŒœæƒ³ï¼š 1_Block_object_assign((void*)&amp;dst-&gt;weakSelf, (void*)src-&gt;weakSelf, 3/*BLOCK_FIELD_IS_OBJECT*/); é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬çŸ¥é“ Block åœ¨æ„é€ çš„æ—¶å€™å°±ä¼šå¯¹æ•è·çš„å˜é‡è¿›è¡Œå†…å­˜ç®¡ç†ï¼ˆå¼ºå¼•ç”¨å’Œå¼±å¼•ç”¨ï¼‰ï¼Œæ‰€ä»¥å½“ Block åœ¨åš Copy æ“ä½œçš„æ—¶å€™å…¶å®æ²¡æœ‰å¿…è¦å¯¹å®ƒæ•è·çš„å˜é‡å†åšä¸€éå†…å­˜ç®¡ç†äº†ã€‚è¿™ä¹Ÿåº”è¯¥æ˜¯ Block çš„ Copy æ“ä½œä½¿ç”¨äº† _Block_object_assign è¿™ç§ä¸ä¼šå¯¼è‡´å¼•ç”¨è®¡æ•°å‘ç”Ÿå˜åŒ–çš„æ–¹å¼æ¥å®ç°çš„åŸå› ã€‚","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://hparis.github.io/blog/categories/æŠ€æœ¯/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://hparis.github.io/blog/tags/iOS/"},{"name":"Objective-C","slug":"Objective-C","permalink":"https://hparis.github.io/blog/tags/Objective-C/"},{"name":"Block","slug":"Block","permalink":"https://hparis.github.io/blog/tags/Block/"}]},{"title":"å¸¸ç”¨å·¥å…·","slug":"å¸¸ç”¨å·¥å…·","date":"2018-04-09T02:53:18.333Z","updated":"2018-04-23T08:18:41.327Z","comments":true,"path":"2018/04/09/å¸¸ç”¨å·¥å…·/","link":"","permalink":"https://hparis.github.io/blog/2018/04/09/å¸¸ç”¨å·¥å…·/","excerpt":"","text":"Rubyç‰ˆæœ¬ç®¡ç†å·¥å…· - rvm $ rvm list åˆ—å‡ºå·²å®‰è£…çš„ ruby ç‰ˆæœ¬ $ rvm list kn=own æ˜¾ç¤º local + remote çš„ ruby ç‰ˆæœ¬ $ rvm use [ruby-version] å¯ä»¥ä½¿ç”¨ default æ¥æ”¹å˜ç³»ç»Ÿç¯å¢ƒä¸‹çš„ ruby ç‰ˆæœ¬ï¼Œæˆ–ä½¿ç”¨ system æ¥æ”¹å˜å½“å‰ç¯å¢ƒä¸‹çš„ ruby ç‰ˆæœ¬ $ rvm remove [ruby-version] åˆ é™¤ ruby ç‰ˆæœ¬ åŒ…ç®¡ç†å·¥å…· - gem $ gem install [gem-package] å®‰è£… gem åŒ… $ gem update æ›´æ–° gem åŒ… $ gem update --system æ›´æ–° gem æœ¬èº« $ gem install [gem-package] å®‰è£… gem åŒ… $ gem list åˆ—å‡ºæ‰€æœ‰å®‰è£…çš„ gem åŒ… $ gem remove [gem-package] åˆ é™¤å®‰è£…è¿‡çš„ gem åŒ… å¸¸ç”¨å·¥å…·cocoapods gem instal cocoapods å®‰è£… cocoapods pod setup åˆå§‹åŒ–å’Œæ›´æ–° Pod åº“ pod install æ ¹æ®å½“å‰ç›®å½•çš„ Podfile æ–‡ä»¶å®‰è£… Pod åº“ pod update æ›´æ–° Podfile æ–‡ä»¶ä¸­çš„ Pod åº“ Pythonç‰ˆæœ¬ç®¡ç†å·¥å…· - pyenvJavaScriptåŒ…ç®¡ç†å·¥å…· - npmåŒ…ç®¡ç†å·¥å…· - brew","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://hparis.github.io/blog/categories/æŠ€æœ¯/"}],"tags":[{"name":"å…¶ä»–","slug":"å…¶ä»–","permalink":"https://hparis.github.io/blog/tags/å…¶ä»–/"}]},{"title":"å¦‚ä½•ç”¨ Objective-C å®ç°ä¸€ä¸ªæ­»é”","slug":"å¦‚ä½•ç”¨-Objective-C-å®ç°ä¸€ä¸ªæ­»é”","date":"2018-04-01T20:29:42.000Z","updated":"2018-04-01T14:16:27.166Z","comments":true,"path":"2018/04/02/å¦‚ä½•ç”¨-Objective-C-å®ç°ä¸€ä¸ªæ­»é”/","link":"","permalink":"https://hparis.github.io/blog/2018/04/02/å¦‚ä½•ç”¨-Objective-C-å®ç°ä¸€ä¸ªæ­»é”/","excerpt":"","text":"å½“ç³»ç»Ÿå­˜åœ¨ä¸¤ä¸ªçº¿ç¨‹åŠä»¥ä¸Šçš„æ—¶å€™ï¼ŒåŒæ–¹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹åœæ­¢æ‰§è¡Œï¼Œä»¥è·å¾—ç³»ç»Ÿèµ„æºï¼Œä½†æ˜¯æ²¡æœ‰ä¸€æ–¹æå‰é€€å‡ºçš„æ—¶å€™å°±å«åšæ­»é”ã€‚ é‚£åœ¨ Objective-C é‡Œé¢å¦‚ä½•å®ç°æ­»é”å‘¢ï¼š 12345678910111213141516171819202122self.lock1 = [NSLock new];self.lock2 = [NSLock new]; dispatch_async(dispatch_queue_create(&quot;com.papa.task1&quot;, DISPATCH_QUEUE_SERIAL), ^&#123; [self.lock1 lock]; NSLog(@&quot;task1 è·å¾— lock1&quot;); sleep(2); [self.lock2 lock]; NSLog(@&quot;task1 è·å¾— lock2&quot;); [self.lock2 unlock]; [self.lock1 unlock];&#125;);dispatch_async(dispatch_queue_create(&quot;com.papa.task2&quot;, DISPATCH_QUEUE_SERIAL), ^&#123; [self.lock2 lock]; NSLog(@&quot;task2 è·å¾— lock2&quot;); sleep(2); [self.lock1 lock]; NSLog(@&quot;task2 è·å¾— lock1&quot;); [self.lock1 unlock]; [self.lock2 unlock];&#125;); æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€åæ§åˆ¶å°è¾“å‡ºçš„ç»“æœæ˜¯ï¼š 12task2 è·å¾— lock2task1 è·å¾— lock1 æˆ– 12task2 è·å¾— lock2task1 è·å¾— lock1 ä¸ºä»€ä¹ˆæ˜¯ä¸¤ç§ç»“æœå‘¢ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„ã€Œåˆæ­¥äº†è§£ GCDã€ã€‚ ä½†æ˜¯ä¸ç®¡å¦‚ä½•ï¼Œè¿™ä¸¤ç§ç»“æœéƒ½æ²¡æœ‰è¾“å‡º task1 è·å¾— lock2 æˆ– task2 è·å¾— lock1ã€‚æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼š task1 è·å¾— lock1ï¼Œç„¶åæ²‰ç¡ 2s task2 è·å¾— lock2ï¼Œç„¶åæ²‰ç¡ 2s task1 ç»è¿‡ 2s çš„æ²‰ç¡ä¹‹åæƒ³è¦å»è·å– lock2ï¼Œæ­¤æ—¶å‘ç° lock2 å·²ç»è¢«ä½¿ç”¨ï¼Œé‚£å°±ç»§ç»­ç­‰å¾… task2 ç»è¿‡ 2s çš„æ²‰ç¡ä¹‹åæƒ³è¦å»è·å– lock1ï¼Œæ­¤æ—¶å‘ç° lock1 å·²ç»è¢«ä½¿ç”¨ï¼Œé‚£å°±ç»§ç»­ç­‰å¾… task1 åˆè¢«å”¤é†’æƒ³è¦å»è·å– lock2ï¼Œæ­¤æ—¶ lock2 ä¾æ—§æ²¡æœ‰è¢« task2 é‡Šæ”¾ï¼Œåªèƒ½ç»§ç»­ç­‰å¾… task2 åˆè¢«å”¤é†’æƒ³è¦å»è·å– lock1ï¼Œæ­¤æ—¶ lock1 ä¾æ—§æ²¡æœ‰è¢« task1 é‡Šæ”¾ï¼Œåªèƒ½ç»§ç»­ç­‰å¾… â€¦ â€¦ äºæ˜¯ task1 å’Œ task2 éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œä½†æ˜¯è‡ªå·±ä¹Ÿä¸é€€å‡ºä¹Ÿä¸é‡Šæ”¾èµ„æºï¼Œæœ€ç»ˆå¯¼è‡´æ­»é”çš„äº§ç”Ÿã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥è®¨è®ºå¦å¤–ä¸€ä¸ªä¾‹å­æ˜¯ä¸æ˜¯æ­»é”ï¼š 123456// æŸä¸ªæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶- (void)onClick:(UIEvent *)event &#123; dispatch_sync(dispatch_get_main_queue(), ^&#123; ... &#125;);&#125; ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ä¸Šé¢è¿™ä¸ªä¾‹å­ä¼šå¯¼è‡´ä¸»çº¿ç¨‹å‘ç”Ÿé˜»å¡çš„ç°è±¡ï¼Œä½†æ˜¯è¿™æ˜¯å› ä¸ºæ­»é”é€ æˆçš„ä¹ˆï¼Ÿ Submits a block to a dispatch queue for synchronous execution. Unlike dispatch_async, this function does not return until the block has finished. Calling this function and targeting the current queue results in deadlock. åœ¨å®˜æ–¹æ–‡æ¡£é‡Œé¢æ˜ç¡®çš„è¯´äº†ï¼Œè¿™å°±æ˜¯æ­»é”ã€‚æˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ä¾‹å­â€œç¿»è¯‘â€ä¸€ä¸‹ï¼š 123456789101112131415161718// é¦–å…ˆè¿›å…¥ onClick çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ­¤æ—¶æ˜¯éœ€è¦åŠ é”çš„// æŸä¸ªæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶- (void)onClick:(UIEvent *)event &#123; [self.lock1 lock]; // æ­¤æ—¶æˆ‘ä»¬å¯ä»¥è®¤ä¸º dispatch_sync æ˜¯åœ¨è·å– block é‡Œé¢çš„ lock2 &#123; [self.lock2 lock]; // æ”¾åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œé‚£ä¹ˆå®ƒä¹Ÿéœ€è¦è·å¾— lock1 [self.lock1 lock]; [self.lock1 unlock]; [self.lock2 unlock]; &#125; [self.lock1 unlock];&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶å®ä¸Šé¢çš„æƒ…å†µå°±æ˜¯ä¸¤ä¸ªä»»åŠ¡éƒ½åœ¨åŒæ—¶ç«äº‰ä¸»çº¿ç¨‹çš„èµ„æºï¼Œå¹¶ä¸”è°éƒ½æ²¡æœ‰é€€å‡ºæœ€ç»ˆå¯¼è‡´æ­»é”çš„äº§ç”Ÿã€‚ä½†æ˜¯è¿™ä¸¤ä¸ªä»»åŠ¡å¹¶ä¸æ˜¯æ™®é€šçš„ä¸¤ä¸ªçº¿ç¨‹åœ¨ç«äº‰èµ„æºï¼Œè€Œæ˜¯éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šï¼Œä¸€ä¸ªåµŒå¥—å¦å¤–ä¸€ä¸ªã€‚è€Œä¸”è¿™ç§ç‰¹æ®Šçš„æƒ…å†µï¼Œåœ¨è¿è¡Œçš„æ—¶å€™ä¼šç›´æ¥å¯¼è‡´å¥”æºƒï¼Œè€Œä¸åƒæˆ‘ä»¬ä¸€å¼€å§‹çš„ä¾‹å­ä¸€æ ·åªæ˜¯åœ¨äº’ç›¸ç­‰å¾…ã€‚ä½†æ˜¯æ—¢ç„¶è‹¹æœæŠŠè¿™ç§æƒ…å†µä¹Ÿç§°ä¸ºæ­»é”ï¼Œé‚£æˆ‘ä»¬å°±å½“åšæ­»é”æ¥çœ‹å¾…ï¼Œæ¯•ç«Ÿä»–ä»¬éƒ½æ˜¯åœ¨ç«äº‰ç³»ç»Ÿèµ„æºã€‚","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://hparis.github.io/blog/categories/æŠ€æœ¯/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://hparis.github.io/blog/tags/iOS/"},{"name":"Objective-C","slug":"Objective-C","permalink":"https://hparis.github.io/blog/tags/Objective-C/"},{"name":"GCD","slug":"GCD","permalink":"https://hparis.github.io/blog/tags/GCD/"}]},{"title":"è¯´è¯´ Objective-C ä¸­çš„ Copy æ“ä½œ","slug":"è¯´è¯´-Objective-C-ä¸­çš„-Copy-æ“ä½œ","date":"2018-03-23T16:35:55.000Z","updated":"2018-04-18T09:42:48.943Z","comments":true,"path":"2018/03/24/è¯´è¯´-Objective-C-ä¸­çš„-Copy-æ“ä½œ/","link":"","permalink":"https://hparis.github.io/blog/2018/03/24/è¯´è¯´-Objective-C-ä¸­çš„-Copy-æ“ä½œ/","excerpt":"","text":"æµ…æ‹·è´ï¼ˆShallow copiesï¼‰å’Œæ·±æ‹·è´ï¼ˆDeep copiesï¼‰æˆ‘ä»¬éƒ½çŸ¥é“ Objective-C ä¸­æŠŠ Copy æ“ä½œåˆ†æˆä¸¤ç§ï¼šæµ…æ‹·è´ï¼ˆShallow copiesï¼‰å’Œæ·±æ‹·è´ï¼ˆDeep copiesï¼‰ã€‚å­¦è¿‡ C è¯­è¨€çš„åŒå­¦åº”è¯¥çŸ¥é“åŒºåˆ†è¿™ä¸¤ç§æ“ä½œçš„åŒºåˆ«å…¶å®å¾ˆç®€å•ï¼š æµ…æ‹·è´ï¼ˆShallow copiesï¼‰: æŒ‡é’ˆæ‹·è´ï¼ŒæŒ‡å‘çš„è¿˜æ˜¯åŒä¸€å—å†…å®¹çš„åœ°å€æ·±æ‹·è´ï¼ˆDeep copiesï¼‰: å†…å®¹æ‹·è´ ä½†æ˜¯åœ¨ Objective-C é‡Œé¢å¯¹äº Copy çš„å®ç°è¿˜æ˜¯è·Ÿ C è¯­è¨€çš„æœ‰ç‚¹å·®åˆ«ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Apple çš„å®˜æ–¹æ–‡æ¡£ç»™å‡ºçš„ä¸€å¼ å›¾ï¼š é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹å‡ºæµ…æ‹·è´è¿‡åï¼ŒArray 1 å’Œ Array 2 çš„å…ƒç´ éƒ½æ˜¯ç›¸åŒçš„æŒ‡é’ˆåœ°å€ï¼ŒæŒ‡å‘ç›¸åŒçš„å†…å®¹ï¼›æ·±æ‹·è´è¿‡åï¼Œå†…å®¹è¢«æ‹·è´ä¸€ä»½æ–°çš„å‡ºæ¥ï¼ŒArray 2 çš„å…ƒç´ çš„æŒ‡é’ˆåœ°å€éƒ½å’Œ Array 1 ä¸ä¸€æ ·ï¼Œå› ä¸º Array2 çš„å…ƒç´ çš„æŒ‡é’ˆåœ°å€éƒ½æŒ‡å‘æ–°çš„å†…å®¹ã€‚ immutable å’Œ mutable å¯¹è±¡çš„æ‹·è´åœ¨ Objective-C ä¸­ä¸€èˆ¬ä¼šç”¨ copy æˆ– mutableCopy è¿›è¡Œæ‹·è´æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è§‚å¯ŸæŒ‡é’ˆå˜åŒ–æ¥ç¡®å®šè¿™ä¸¤ç§æ‹·è´æ“ä½œæ˜¯æµ…å¤åˆ¶è¿˜æ˜¯æ·±å¤åˆ¶ã€‚ immutable å¯¹è±¡çš„å¤åˆ¶æ“ä½œ 1234567NSString * aName = @&quot;å¸•å¸•&quot;;NSString * bName = [aName copy];NSMutableString * cName = [aName mutableCopy];NSLog(@&quot;aName çš„æŒ‡é’ˆï¼š%p&quot;, aName);NSLog(@&quot;bName çš„æŒ‡é’ˆï¼š%p&quot;, bName);NSLog(@&quot;cName çš„æŒ‡é’ˆï¼š%p&quot;, cName); è¾“å‡ºçš„ç»“æœï¼š 123aName çš„æŒ‡é’ˆï¼š0x103d34070bName çš„æŒ‡é’ˆï¼š0x103d34070cName çš„æŒ‡é’ˆï¼š0x600000250dd0 mutable å¯¹è±¡çš„å¤åˆ¶æ“ä½œ 1234567NSMutableString * aName = [NSMutableString stringWithString:@&quot;å¸•å¸•&quot;];NSString * bName = [aName copy];NSMutableString * cName = [aName mutableCopy];NSLog(@&quot;aName çš„æŒ‡é’ˆï¼š%p&quot;, aName);NSLog(@&quot;bName çš„æŒ‡é’ˆï¼š%p&quot;, bName);NSLog(@&quot;cName çš„æŒ‡é’ˆï¼š%p&quot;, cName); è¾“å‡ºçš„ç»“æœï¼š 123aName çš„æŒ‡é’ˆï¼š0x60000025e150bName çš„æŒ‡é’ˆï¼š0x600000222900cName çš„æŒ‡é’ˆï¼š0x60000025e450 é€šè¿‡ä¸Šé¢ä¸¤ä¸ªä¾‹å­ä»¥åŠå®ƒä»¬çš„è¾“å‡ºç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸‹é¢è¿™ä¸ªè¡¨æ ¼ï¼š imutable å¯¹è±¡ mutable å¯¹è±¡ copy æµ…å¤åˆ¶ æ·±å¤åˆ¶ mutableCopy æ·±å¤åˆ¶ æ·±å¤åˆ¶ ä¸Šé¢çš„è§„åˆ™å¯¹é›†åˆå¯¹è±¡ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼šNSArray å’Œ NSMutableArrayï¼ŒNSDictionary å’Œ NSMutableDictionaryï¼ŒNSSet å’Œ NSMutableSet å•å±‚æ·±å¤åˆ¶ï¼ˆone-level-deepï¼‰123456789101112NSMutableString * aString = [NSMutableString stringWithString:@&quot;\bHello&quot;]NSMutableArray * aArray = [NSMutableArray arrayWithObjects:aString, nil];NSArray * bArray = [aArray copy];NSMutableString * bString = bArray[0];[bString appendString:@&quot; \bå¸•å¸•&quot;]; NSLog(@&quot;aArray çš„æŒ‡é’ˆï¼š%p&quot;, aName);NSLog(@&quot;bArray çš„æŒ‡é’ˆï¼š%p&quot;, bName);NSLog(@&quot;aArray \b\u001d\bç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: %pï¼Œ\b\bå†…å®¹ï¼š%@&quot;, aArray[0], aArray[0]);NSLog(@&quot;bArray ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: %pï¼Œ\b\bå†…å®¹ï¼š%@&quot;, bArray[0], bArray[0]); è¾“å‡ºç»“æœï¼š 1234aArray çš„æŒ‡é’ˆï¼š0x60000025d9a0bArray çš„æŒ‡é’ˆï¼š0x60000002cf60aArray \b\u001d\bç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: 0x60000025d880ï¼Œ\b\bå†…å®¹ï¼š\bHello \bå¸•å¸•bArray ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: 0x60000025d880ï¼Œ\b\bå†…å®¹ï¼š\bHello \bå¸•å¸• ä» aArray åˆ° bArray çš„ copy æ“ä½œä¹‹åï¼Œå®ƒä»¬çš„æŒ‡é’ˆåœ°å€å‘ç”Ÿäº†å˜åŒ–ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„ç†è§£è¿™æ˜¯æ·±æ‹·è´ã€‚æ·±æ‹·è´ä¼šæŠŠ aArray çš„å…ƒç´ éƒ½æ‹·è´ä¸€ä»½ï¼Œé‚£ä¸ºä»€ä¹ˆæ”¹å˜ bArray çš„å…ƒç´ çš„å€¼ä¼šå¯¼è‡´ aArray çš„å…ƒç´ çš„å€¼ä¹Ÿå‘ç”Ÿäº†å˜åŒ–å‘¢ï¼Ÿ å®Œå…¨æ·±å¤åˆ¶é‚£æˆ‘ä»¬è¦å¦‚ä½•åšåˆ°çœŸæ­£çš„æ·±å¤åˆ¶å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç®€å•çš„æŠŠä¸Šé¢çš„ä»£ç æ”¹ä¸€ä¸‹ï¼š 1234567891011121314NSMutableString * aString = [NSMutableString stringWithString:@&quot;\bHello&quot;]NSMutableArray * aArray = [NSMutableArray arrayWithObjects:aString, nil];// åªéœ€è¦æ”¹åŠ¨è¿™ä¸€è¡Œä»£ç NSArray *bArray = [NSKeyedUnarchiver unarchiveObjectWithData:[NSKeyedArchiver archivedDataWithRootObject:aArray]];NSMutableString * bString = bArray[0];[bString appendString:@&quot; \bå¸•å¸•&quot;]; NSLog(@&quot;aArray çš„æŒ‡é’ˆï¼š%p&quot;, aName);NSLog(@&quot;bArray çš„æŒ‡é’ˆï¼š%p&quot;, bName);NSLog(@&quot;aArray \b\u001d\bç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: %pï¼Œ\b\bå†…å®¹ï¼š%@&quot;, aArray[0], aArray[0]);NSLog(@&quot;bArray ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: %pï¼Œ\b\bå†…å®¹ï¼š%@&quot;, bArray[0], bArray[0]); è¾“å‡ºç»“æœï¼š 1234aArray çš„æŒ‡é’ˆï¼š0x600000259cb0bArray çš„æŒ‡é’ˆï¼š0x600000030ac0aArray \b\u001d\bç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: 0x604000452120ï¼Œ\b\bå†…å®¹ï¼š\bHellobArray ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: 0x604000452780ï¼Œ\b\bå†…å®¹ï¼š\bHello \bå¸•å¸• åªè¦å…ˆå¯¹é›†åˆå¯¹è±¡åˆ†åˆ«ç”¨ NSKeyedArchiver å’Œ NSKeyedUnarchiver å°±å¯ä»¥çœŸæ­£å®Œæˆå¯¹ä¸€ä¸ªé›†åˆå¯¹è±¡çš„æ·±å¤åˆ¶ã€‚ Copy å’Œ å†…å­˜ç®¡ç†ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ Objective-C é‡Œé¢å¯¹äº Copy çš„å®ç°è¿˜æ˜¯è·Ÿ C è¯­è¨€çš„æœ‰ç‚¹å·®åˆ«ï¼Œé‚£å·®åˆ«åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿå†…å­˜ä¸­åšå¤åˆ¶æ“ä½œæ˜¯å¾ˆè€—è´¹èµ„æºçš„ï¼Œè€Œæˆ‘ä»¬éƒ½çŸ¥é“ Objective-C é«˜æ•ˆçš„ä¸€ä¸ªåŸå› åœ¨äºå®ƒçš„å†…å­˜ç®¡ç†æœºåˆ¶æ˜¯å¼•ç”¨è®¡æ•°ã€‚æˆ‘ä»¬å‰é¢åˆ†æçš„æ·±æ‹·è´æ˜¯å¯¹å†…å®¹çš„æ‹·è´ï¼Œè¿™ä¸€ç‚¹è·Ÿ C è¯­è¨€çš„ä¸€æ ·ã€‚C è¯­è¨€çš„æµ…æ‹·è´æ˜¯æŒ‡é’ˆçš„æ‹·è´ï¼Œå®ƒä¾æ—§åšäº†ä¸€æ¬¡å¤åˆ¶æ“ä½œã€‚è€Œåœ¨ Objective-C ä¸­ï¼Œæµ…æ‹·è´å…¶å®åªæ˜¯å¼•ç”¨è®¡æ•°çš„å¢åŠ ï¼Œä¸ä¿¡çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š 123456NSArray * aArray = [NSArray arrayWithObjects:@&quot;å¸•å¸•&quot;, nil];NSLog(@&quot;aArray çš„æŒ‡é’ˆï¼š%pï¼Œ\b\bå¼•ç”¨è®¡æ•°ï¼š%ld&quot;, aArray, CFGetRetainCount((__bridge CFTypeRef)(aArray)));NSArray * bArray = [aArray copy];NSLog(@&quot;aArray çš„æŒ‡é’ˆï¼š%pï¼Œ\b\bå¼•ç”¨è®¡æ•°ï¼š%ld&quot;, aArray, CFGetRetainCount((__bridge CFTypeRef)(aArray)));NSMutableArray * cArray = [aArray mutableCopy];NSLog(@&quot;aArray çš„æŒ‡é’ˆï¼š%pï¼Œ\b\bå¼•ç”¨è®¡æ•°ï¼š%ld&quot;, aArray, CFGetRetainCount((__bridge CFTypeRef)(aArray))); è¾“å‡ºç»“æœï¼š 123aArray çš„æŒ‡é’ˆï¼š0x604000443ba0ï¼Œ\b\bå¼•ç”¨è®¡æ•°ï¼š2aArray çš„æŒ‡é’ˆï¼š0x604000443ba0ï¼Œ\b\bå¼•ç”¨è®¡æ•°ï¼š3aArray çš„æŒ‡é’ˆï¼š0x604000443ba0ï¼Œ\b\bå¼•ç”¨è®¡æ•°ï¼š3 ä¸ºä»€ä¹ˆ aArray åˆšå‡ºæ¥çš„æ—¶å€™çš„å¼•ç”¨è®¡æ•°æ˜¯ 2ï¼Ÿå› ä¸º [NSArray arrayWithObjects:@&quot;å¸•å¸•&quot;, nil] æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„å¼•ç”¨è®¡æ•°å°±æ˜¯ 1ï¼›ç„¶åæˆ‘ä»¬åˆå®šä¹‰äº† aArray æ¥å¼•ç”¨è¿™ä¸ªå¯¹è±¡ï¼Œæ­¤æ—¶å®ƒçš„å¼•ç”¨è®¡æ•°å°±å¢åŠ äº† 1ï¼Œå˜æˆäº† 2ï¼›ä¹‹åæˆ‘ä»¬å¯¹ aArray è¿›è¡Œäº† copy æ“ä½œï¼Œå‘ç°å®ƒçš„å¼•ç”¨è®¡æ•°å˜æˆäº† 3ï¼Œæ‰€ä»¥è¿™é‡Œçš„ copy æ“ä½œå…¶å®ç›¸å½“äº retaionï¼›æœ€æœ‰æˆ‘ä»¬å¯¹ aArray è¿›è¡Œäº† mutableCopy æ“ä½œï¼Œæ­¤æ—¶å®ƒçš„å¼•ç”¨è®¡æ•°è¿˜æ˜¯ 3ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™è¿›è¡Œäº†å†…å®¹å¤åˆ¶ã€‚ æ‰€ä»¥åœ¨ Objective-C ä¸­å¯¹ä¸€ä¸ª imutable å¯¹è±¡è¿›è¡Œçš„ copyï¼ˆæµ…å¤åˆ¶ï¼‰æ“ä½œï¼Œå…¶å®éƒ½åªä¼šå¼•èµ·å¼•ç”¨è®¡æ•°çš„å˜åŒ–ï¼Œè€Œä¸ä¼šåœ¨å†…å­˜ä¸­åšå‡ºä»»ä½•æ‹·è´æ“ä½œï¼ŒåŒ…æ‹¬æŒ‡é’ˆæ‹·è´ã€‚ NSCopying å’Œ NSMutableCopyingå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯¹å…¶è¿›è¡Œ copy æ“ä½œçš„è¯ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼š 123456789// Person@interface Person: NSObject@property (nonatomic, copy) NSString * name;@end@implementation Person@endPerson * aPerson = [Person new];Person * bPerson = [aPerson copy]; Xcode ç›´æ¥å¥”æºƒäº†ï¼š 12// å´©æºƒ*** Terminating app due to uncaught exception &apos;NSInvalidArgumentException&apos;, reason: &apos;-[Person copyWithZone:]: unrecognized selector sent to instance 0x60000000d5f0&apos; ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯¹ä¸€ä¸ª Person å¯¹è±¡ä½¿ç”¨äº† copyï¼ŒXcode ç¡®æŠ¥çš„æ˜¯æ‰¾ä¸åˆ° copyWithZone: è¿™ä¸ª selector çš„é”™è¯¯ã€‚ è¿™æ˜¯å› ä¸º Objective-C ä¸­è§„å®šï¼Œä¸€ä¸ªå¯¹è±¡å¦‚æœæƒ³è¦ä½¿ç”¨ copy æˆ– mutableCopy çš„æ“ä½œï¼Œå¿…é¡»è¦å®ç° NSCopying æˆ– NSMutableCopying è¿™ä¸¤ä¸ªåè®®ã€‚è¿™ä¸¤ä¸ªåè®®è§„å®šäº†å¯¹è±¡éœ€è¦å®ç° copyWithZone: æˆ– mutableCopyWithZone: è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå› ä¸ºå¯¹ä¸€ä¸ªå¯¹è±¡åš copy æˆ– mutableCopy æœ€åéƒ½ä¼šå»è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•æ¥åšæœ€ç»ˆçš„å®ç°ã€‚ä¸Šé¢ä¾‹å­ä¸­çš„é›†åˆå¯¹è±¡èƒ½å¤Ÿä½¿ç”¨ copy å’Œ mutableCopy æ“ä½œæ˜¯ä¹Ÿå› ä¸ºå®ƒä»¬éƒ½å®ç°äº† NSCopying å’Œ NSMutableCopying åè®®ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å¯¹ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡å®ç° NSCopying åè®®ï¼š 12345678910111213@interface Person: NSObject &lt;NSCopying&gt;@property (nonatomic, copy) NSString * name;@property (nonatomic, strong) NSMutableArray * mArray;@end@implementation Person- (instancetype)copyWithZone:(NSZone *)zone &#123; Person * person = [[self class] new]; person.name = [self.name copy]; person.mArray = [self.mArray mutableCopy]; return person;&#125;@end è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨ [Person copy] äº†ã€‚å½“ç„¶ï¼Œè¿™é‡Œ Person çš„ mArray ä¹Ÿåªæ˜¯å•å±‚æ·±å¤åˆ¶ï¼Œå¦‚æœæƒ³è¦å®ç°å®Œå…¨æ·±å¤åˆ¶çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ NSKeyedArchiver å’Œ NSKeyedUnarchiver æ¥å®Œæˆå¯¹ mArray çš„å®Œå…¨æ·±å¤åˆ¶ã€‚ Block å’Œ Copyç®€å•è¯´ä¸€ä¸‹ï¼Œåœ¨ Objective-C ä¸­ï¼ŒBlock çš„ copy æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ“ä½œã€‚å› ä¸º Block æ˜¯ä¸€ç§ç»“æ„ä½“ï¼Œå®ƒæ— æ³•å®ç° NSCopying æˆ– NSMutableCopying åè®®ï¼Œä½†æ˜¯å®ƒå´å¯ä»¥è°ƒç”¨ copy æ–¹æ³•ã€‚è¿™æ˜¯ç”± Block çš„ç»“æ„ä½“å†³å®šçš„ï¼š Block é‡Œé¢çš„ descriptor æœ‰ copy çš„å‡½æ•°æŒ‡é’ˆï¼Œå½“å¯¹ Block æ‰§è¡Œ copy æ“ä½œæœ€åéƒ½ä¼šé€šè¿‡è¯¥å‡½æ•°æŒ‡é’ˆè¿›è¡ŒçœŸæ­£çš„æ“ä½œã€‚è¿™ä¹Ÿæ˜¯ Blocçœ‹ä¸éœ€è¦å®ç° NSCopying å’Œ NSMutableCopying å°±èƒ½è°ƒç”¨ copy æ–¹æ³•çš„åŸå› ã€‚ å‚è€ƒèµ„æ–™ï¼š https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Collections/Articles/Copying.html https://www.zybuluo.com/MicroCai/note/50592","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://hparis.github.io/blog/categories/æŠ€æœ¯/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://hparis.github.io/blog/tags/iOS/"},{"name":"Objective-C","slug":"Objective-C","permalink":"https://hparis.github.io/blog/tags/Objective-C/"}]},{"title":"å¦‚ä½•åœ¨ iOS ä¸Šè‡ªå®šä¹‰ React Native Component","slug":"å¦‚ä½•åœ¨-iOS-ä¸Šè‡ªå®šä¹‰-React-Native-Component","date":"2018-03-19T17:22:09.000Z","updated":"2018-03-23T08:36:38.931Z","comments":true,"path":"2018/03/20/å¦‚ä½•åœ¨-iOS-ä¸Šè‡ªå®šä¹‰-React-Native-Component/","link":"","permalink":"https://hparis.github.io/blog/2018/03/20/å¦‚ä½•åœ¨-iOS-ä¸Šè‡ªå®šä¹‰-React-Native-Component/","excerpt":"","text":"å½“æˆ‘ä»¬è¦åœ¨ iOS ç«¯å®ç°ä¸€ä¸ª React Native å¯ç”¨çš„ Componentï¼Œæ¯”å¦‚ï¼š 1&lt;MapView onRegionChange=&#123;(event) =&gt; &#123;&#125;&#125; zoomLevel=&#123;2&#125; /&gt; é‚£ä¹ˆæˆ‘ä»¬åŸºæœ¬ä¸Šå°±æ˜¯è¦è§£å†³ä¸‹é¢è¿™ä¸‰ä¸ªé—®é¢˜ï¼š å¦‚ä½•æŠŠ iOS ä¸Šçš„ UI æš´éœ²ç»™ React Native ç«¯ï¼Ÿ å¦‚ä½•åœ¨ React Native ç»™ iOS çš„ UI ä¼ å€¼ï¼Ÿ å¦‚ä½•åœ¨ React Native ä¸­å“åº” iOS çš„äº‹ä»¶ï¼Ÿ è¿™ä¸‰ä¸ªé—®é¢˜å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£æ‰¾åˆ°ç­”æ¡ˆã€‚ å¦‚ä½•æŠŠ iOS ä¸Šçš„ UI æš´éœ²ç»™ React Native ç«¯é¦–å…ˆä½ éœ€è¦åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª RCTViewManager çš„å­ç±»ï¼š 1234567891011121314151617181920212223// RNTMapManager.m#import &lt;MapKit/MapKit.h&gt;#import &lt;React/RCTViewManager.h&gt;// ç»§æ‰¿ RCTViewManager@interface RNTMapManager : RCTViewManager@end@implementation RNTMapManager// è°ƒç”¨ RCT_EXPORT_MODULE æš´éœ²è¯¥ç±»çš„åå­—ç»™ React Native ä½¿ç”¨ã€‚å¦‚æœä½ æƒ³è‡ªå®šä¹‰// æš´éœ²ç»™ React Native çš„åå­—æ—¶ï¼Œä½ éœ€è¦ RCT_EXPORT_MODULE(YOUR_CUSTOM_NAME)ã€‚RCT_EXPORT_MODULE()// ç”±äº RCTViewManager æ˜¯ NSObjectï¼Œæ‰€ä»¥è¿™é‡Œå¿…é¡»éœ€è¦å®ç°è¯¥æ–¹æ³•æ¥å‘Šè¯‰// React Native å»ä½¿ç”¨å“ªä¸ª UIView- (UIView *)view&#123; return [MKMapView new];&#125;@end è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ React Native ä½¿ç”¨ MapView äº†ï¼š 1234567891011121314151617// MapView.jsimport &#123; requireNativeComponent &#125; from &apos;react-native&apos;;// requireNativeComponent ä¼šè‡ªåŠ¨æŠŠ iOS ä¸Šçš„ RNTMapManager è§£ææˆ RNTMapã€‚// å¦‚æœå»æ‰ iOS ä¸Šçš„ Manager åç¼€ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Ÿå—¯ï¼Œæ²¡æœ‰ä»»ä½•å½±å“ã€‚module.exports = requireNativeComponent(&apos;RNTMap&apos;, null);// MyApp.jsimport MapView from &apos;./MapView.js&apos;;...render() &#123; return &lt;MapView /&gt;;&#125; å¦‚ä½•åœ¨ React Native ç»™ iOS çš„ UI ä¼ å€¼å¦‚æœéœ€è¦ä¼ å€¼ç»™ iOS ä¸Šçš„ UIï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨å¦å¤–ä¸€ä¸ªå®ï¼š 1RCT_EXPORT_VIEW_PROPERTY(zoomEnabled, BOOL) è¿™æ—¶å€™å°±å¯ä»¥åœ¨ React Native ä¸Šä½¿ç”¨äº†ï¼š 1&lt;MapView zoomEnable=&#123;true&#125; /&gt; è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRCT_EXPORT_VIEW_PROPERTY æ‰€æš´éœ²çš„å±æ€§å¿…é¡»æ˜¯ä¹‹å‰æˆ‘ä»¬è¯´çš„ UIViewï¼ˆå³ç»§æ‰¿äº RCTViewManager å¹¶é€šè¿‡ - (UIView *)view; è¿”å›çš„ Viewï¼‰å·²ç»å­˜åœ¨çš„å±æ€§ã€‚ é™¤äº†ä¸Šé¢çš„å® RCT_EXPORT_VIEW_PROPERTY å¯ä»¥æš´éœ²å±æ€§ç»™ React Native ä½¿ç”¨ä¹‹å¤–è¿˜æœ‰ä¸‹é¢ 5 ç§ï¼ˆè¿™é‡Œå…ˆæŒ–ä¸ªå‘ï¼Œå›å¤´ç ”ç©¶ä¸€ä¸‹å†è¯´è¯´ä¸‹é¢äº”ç§çš„ä½œç”¨å’ŒåŒºåˆ«ï¼‰ï¼š RCT_REMAP_VIEW_PROPERTY RCT_CUSTOM_VIEW_PROPERTY RCT_EXPORT_SHADOW_PROPERTY RCT_REMAP_SHADOW_PROPERTY RCT_CUSTOM_SHADOW_PROPERTY å¦‚ä½•åœ¨ React Native ä¸­å“åº” iOS çš„äº‹ä»¶è¦æƒ³åœ¨ React Native ä¸­å“åº” iOS çš„äº‹ä»¶ï¼Œåªéœ€è¦æš´éœ²ç”¨ RCTBubblingEventBlock æˆ– RCTDirectEventBlock å®šä¹‰çš„å±æ€§å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920// RNTMapView.h#import &lt;MapKit/MapKit.h&gt;#import &lt;React/RCTComponent.h&gt;// ç”±äº MKMapView æ²¡æœ‰ä»»ä½• `RCTBubblingEventBlock` æˆ– `RCTDirectEventBlock` æ‰€å®šä¹‰çš„// å±æ€§ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å®šä¹‰ MKMapView çš„å­ç±» RNTMapView@interface RNTMapView: MKMapView// éœ€è¦æš´éœ²ç»™ React Native çš„äº‹ä»¶å±æ€§@property (nonatomic, copy) RCTBubblingEventBlock onRegionChange;@end// RNTMapView.m#import &quot;RNTMapView.h&quot;@implementation RNTMapView@end ç„¶åæˆ‘ä»¬éœ€è¦åœ¨ RCTViewManager ä¸­æš´éœ² onRegionChange ç»™ React Native ä½¿ç”¨ï¼š 123456789101112131415161718192021// RNTMapManager.m#import &lt;MapKit/MapKit.h&gt;#import &lt;React/RCTViewManager.h&gt;#import &quot;RNTMapView.h&quot;@interface RNTMapManager : RCTViewManager &lt;MKMapViewDelegate&gt;@end@implementation RNTMapManagerRCT_EXPORT_MODULE()// æš´éœ² RNTMapView ä¸­çš„ `onRegionChange` å±æ€§RCT_EXPORT_VIEW_PROPERTY(onRegionChange, RCTBubblingEventBlock)- (UIView *)view &#123; // è¿™é‡Œéœ€è¦è¿”å› RNTMapView è€Œä¸æ˜¯ MKMapView return [RNTMapView new];&#125;@end é‡è¦çš„äº‹è¯´ä¸‰éï¼šä½¿ç”¨ RCTBubblingEventBlock æˆ– RCTDirectEventBlock æ‰€å®šä¹‰çš„äº‹ä»¶éƒ½å¿…é¡»åŠ ä¸Šå‰ç¼€ onï¼Œå¦åˆ™ React Native æ— æ³•æ¥æ”¶åˆ°äº‹ä»¶ä½¿ç”¨ RCTBubblingEventBlock æˆ– RCTDirectEventBlock æ‰€å®šä¹‰çš„äº‹ä»¶éƒ½å¿…é¡»åŠ ä¸Šå‰ç¼€ onï¼Œå¦åˆ™ React Native æ— æ³•æ¥æ”¶åˆ°äº‹ä»¶ä½¿ç”¨ RCTBubblingEventBlock æˆ– RCTDirectEventBlock æ‰€å®šä¹‰çš„äº‹ä»¶éƒ½å¿…é¡»åŠ ä¸Šå‰ç¼€ onï¼Œå¦åˆ™ React Native æ— æ³•æ¥æ”¶åˆ°äº‹ä»¶","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://hparis.github.io/blog/categories/æŠ€æœ¯/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://hparis.github.io/blog/tags/iOS/"},{"name":"RN","slug":"RN","permalink":"https://hparis.github.io/blog/tags/RN/"}]},{"title":"Raspberry PI åŸºæœ¬ä½¿ç”¨","slug":"Raspberry-PI-åŸºæœ¬ä½¿ç”¨","date":"2018-03-05T22:04:56.000Z","updated":"2018-03-23T08:45:00.633Z","comments":true,"path":"2018/03/06/Raspberry-PI-åŸºæœ¬ä½¿ç”¨/","link":"","permalink":"https://hparis.github.io/blog/2018/03/06/Raspberry-PI-åŸºæœ¬ä½¿ç”¨/","excerpt":"","text":"1. ä¿è¯ Raspberry PI èƒ½å¤Ÿåœ¨å¤–ç½‘ä½¿ç”¨12// åœ¨ä½ çš„ Raspberry PI ä¸Šä½¿ç”¨ autossh æ¥å®ç°ä¸æ‰çº¿çš„åå‘ä»£ç†ï¼šautossh -M 5678 -fNR 2018:localhost:22 root@54.219.12.213 12// åœ¨ä½ çš„å¤–ç½‘æœåŠ¡å™¨ï¼ˆæ¯”å¦‚ä¸Šé¢ä¾‹å­ä¸­çš„ï¼š54.219.12.213ï¼‰ä¸Šå¯ä»¥ä½¿ç”¨ ssh ç™»å½•ä½ çš„ Raspberry PIssh -p 2018 pi@127.0.0.1","categories":[{"name":"Raspberry PI","slug":"Raspberry-PI","permalink":"https://hparis.github.io/blog/categories/Raspberry-PI/"}],"tags":[{"name":"Raspberry PI","slug":"Raspberry-PI","permalink":"https://hparis.github.io/blog/tags/Raspberry-PI/"}]},{"title":"redux ä¹‹é¡µé¢è·³è½¬","slug":"redux-ä¹‹é¡µé¢è·³è½¬","date":"2018-02-26T17:48:56.000Z","updated":"2018-03-23T08:45:29.506Z","comments":true,"path":"2018/02/27/redux-ä¹‹é¡µé¢è·³è½¬/","link":"","permalink":"https://hparis.github.io/blog/2018/02/27/redux-ä¹‹é¡µé¢è·³è½¬/","excerpt":"","text":"æœ€è¿‘æ­£åœ¨ç”¨ React Native é‡æ„æ•´ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬ç”¨äº† react-native-navigation è¿™ä¸ªåº“æ¥ä½œä¸ºé¡¹ç›®çš„å¯¼èˆªæ§åˆ¶å™¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¹³å¸¸ä¼šæŠŠé¡µé¢è·³è½¬é€»è¾‘çš„æ—¶å€™æ”¾åœ¨ Screen é‡Œé¢çš„ï¼Œæ¯”å¦‚: 12345678910111213class FirstScreen extends React.Component &#123; // ç‚¹å‡»äº‹ä»¶ _someAction = () =&gt; &#123; this.props.navigator.push(&#123; screen: 'example.SecondScreen', &#125;); &#125; render = () =&gt; &#123; ... &#125;&#125; ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸Šé¢çš„å†™æ³•æ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯ç›´åˆ°æˆ‘ä»¬ç¢°åˆ°è¿™æ ·ä¸€ä¸ªéœ€æ±‚çš„æ—¶å€™å°±æŠ“çäº†ï¼šç‚¹å‡»ä¸€ä¸ª PDF æ–‡ä»¶ï¼Œå¦‚æœ PDF æ–‡ä»¶æ²¡æœ‰ä¸‹è½½å°±å…ˆå»ä¸‹è½½ï¼Œä¸‹è½½å®Œæˆä¹‹åè‡ªåŠ¨è·³è½¬åˆ° PDF é˜…è¯»å™¨ã€‚ç”±äºç”¨äº† redux ä¹‹åï¼Œæˆ‘ä»¬å°±å¢åŠ ä¸€ä¸ª finished çš„ state æ¥åˆ¤æ–­æ˜¯å¦å·²ç»ä¸‹è½½å®Œæˆã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031class ExampleScreen extends React.Component &#123; componentWillReceiveProps = (nextProps) =&gt; &#123; // è¿™é‡Œåˆ¤æ–­ä¸‹è½½çŠ¶æ€æ˜¯å¦å·²å®Œæˆï¼Œå®Œæˆçš„è¯å°±å»è·³è½¬ if (nextProps.finished === true) &#123; // è¿™é‡Œéœ€è¦é‡ç½®ä¸€ä¸‹çŠ¶æ€ï¼Œä¸ç„¶å…¶ä»– state å‘ç”Ÿå˜åŒ–ä¼šå¤šæ¬¡è§¦å‘é¡µé¢çš„è·³è½¬ this.props.dispatch(resetFinished()); this.props.navigator.push(&#123; screen: 'example.PDFScreen', &#125;); &#125; &#125; // ç‚¹å‡»äº‹ä»¶ _someAction = () =&gt; &#123; // openPDF() è¿™ä¸ª action ä¼šè‡ªåŠ¨å»ä¸‹è½½ PDF æ–‡ä»¶ï¼Œç„¶åä¿®æ”¹ finished çš„çŠ¶æ€ this.props.dispatch(openPDF()); &#125; render = () =&gt; &#123; ... &#125;&#125;const mapStateToProps = state =&gt; &#123; return &#123; finished: state.finished &#125;&#125;;export default connect(mapStateToProps)(ExampleScreen); ä¸Šé¢çš„åšæ³•æ˜¯å¯ä»¥å®ç°æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä½†æ˜¯è¿™ç§å†™æ³•å¾ˆè›‹ç–¼ã€‚å› ä¸ºå½“ä½ åœ¨è°ƒç”¨ç”¨ openPDF() çš„æ—¶å€™ï¼Œä½ ä»¥ä¸ºåé¢çš„äº‹ä¸éœ€è¦ä½ æ“å¿ƒï¼Œç„¶åè¿™ä¸ªæ—¶å€™æœ‰äººå‘Šè¯‰ä½ è¿˜éœ€è¦åœ¨å…¶ä»–åœ°æ–¹å¢åŠ ä¸€ä¸ªä¸­é—´çŠ¶æ€å»è¡¥å…… openPDF() çš„åç»­é€»è¾‘å¤„ç†ã€‚ ç»è¿‡è®¨è®ºä¹‹åï¼Œæˆ‘ä»¬å†³å®šæ”¹æˆç”¨ callback çš„æ–¹å¼æ¥å®ç°ï¼š 12345678910111213141516class ExampleScreen extends React.Component &#123; // ç‚¹å‡»äº‹ä»¶ _someAction = () =&gt; &#123; // openPDF() æ˜¯ä¸€ä¸ªå¼‚æ­¥ action this.props.dispatch(openPDF(callback: () =&gt; &#123; this.props.navigator.push(&#123; screen: 'example.PDFScreen', &#125;); &#125;)); &#125; render = () =&gt; &#123; ... &#125;&#125; ä½¿ç”¨ callback çš„å¥½å¤„å°±æ˜¯å»æ‰äº†ä¸€ä¸ªçƒ¦äººçš„ä¸­é—´çŠ¶æ€ï¼Œå¹¶ä¸”ä»é˜…è¯»ä½“éªŒæ¥è¯´å¾ˆå®¹æ˜“è®©è¯»è€…æ˜ç™½è¿™ä¸ªç‚¹å‡»äº‹ä»¶åœ¨å¹²ä»€ä¹ˆã€‚ä½†æ˜¯åœ¨ redux çš„ action æ–¹æ³•ä¸­å¢åŠ ä¸€ä¸ª callback çš„è°ƒç”¨ï¼Œçœ‹èµ·æ¥ä¹Ÿæœ‰ç‚¹ä¸ä¼¦ä¸ç±»çš„ã€‚è™½ç„¶æˆ‘è®¤ä¸º callback å’Œå…¶ä»–å‚æ•°å…·æœ‰ç›¸åŒçš„æ³•å¾‹åœ°ä½ã€‚ å…¶å®æœ€å¥½çš„å®ç°æ˜¯ï¼Œè¿™ä¸ªç‚¹å‡»äº‹ä»¶åº”è¯¥è¿é¡µé¢çš„è·³è½¬é€»è¾‘ä¹Ÿä¸éœ€è¦å¤„ç†ï¼š 1234567891011class ExampleScreen extends React.Component &#123; // ç‚¹å‡»äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶åªåšä¸€ä»¶äº‹å°±æ˜¯å» dispatch ä¸€ä¸ª openPDF() çš„ action _someAction = () =&gt; &#123; this.props.dispatch(openPDF()); &#125; render = () =&gt; &#123; ... &#125;&#125; åƒä¸Šé¢è¿™ç§å®ç°ï¼Œæˆ‘ä»¬ä¹Ÿå°±åªèƒ½åœ¨ openPDF() é‡ŒåŠ¨æ‰‹è„šäº†ï¼š 123456789// action.jsexport const openPDF = await () =&gt; &#123; return dispatch =&gt; &#123; // å¼‚æ­¥ä¸‹è½½ PDF async downloadPDF(); // å®Œæˆä¹‹åé€šè¿‡ router å»å®ç°é¡µé¢è·³è½¬ dispatch(openRouter('PDFScreen')); &#125;;&#125; è¿™é‡Œå°±ä¸å†è¯¦ç»†è¯´ router çš„å®ç°ç»†èŠ‚äº†ï¼Œå› ä¸ºç½‘ä¸Šæœ‰å¾ˆå¤šç°æˆçš„èµ„æ–™ã€‚ï¼ˆPS: ä¸»è¦æ˜¯æˆ‘ä¹Ÿè¿˜æ²¡çœ‹åˆ°è¿™ä¸€å—ï¼‰ ä»é¡µé¢ï¼ˆScreenï¼‰çš„è§’åº¦æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºè¿™æ ·çš„å¤„ç†æ˜¯æœ€åˆé€‚çš„ã€‚å› ä¸º Screen åªéœ€è¦å…³æ³¨æœ¬é¡µé¢çš„ state å’Œ actionï¼Œè‡³äºè·³è½¬çš„é€»è¾‘äº¤ç»™åé¢çš„ action æ¥å¤„ç†æ˜¯æœ€å¥½çš„ã€‚","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://hparis.github.io/blog/categories/æŠ€æœ¯/"}],"tags":[{"name":"RN","slug":"RN","permalink":"https://hparis.github.io/blog/tags/RN/"},{"name":"redux","slug":"redux","permalink":"https://hparis.github.io/blog/tags/redux/"}]},{"title":"Swift High-Performance Tip 1ï¼šArray å’Œ ContiguousArray","slug":"Swift-High-Performance-Tip 1ï¼šArrayå’ŒContiguousArray","date":"2017-09-05T15:30:56.000Z","updated":"2018-03-23T08:42:53.310Z","comments":true,"path":"2017/09/05/Swift-High-Performance-Tip 1ï¼šArrayå’ŒContiguousArray/","link":"","permalink":"https://hparis.github.io/blog/2017/09/05/Swift-High-Performance-Tip 1ï¼šArrayå’ŒContiguousArray/","excerpt":"","text":"Array æ˜¯éšæœºå­˜å‚¨çš„ï¼ˆrandom-accessï¼‰é›†åˆç±»å‹ã€‚ ContiguousArray æ˜¯è¿ç»­å­˜å‚¨ï¼ˆcontiguously storedï¼‰çš„æ•°ç»„ï¼Œå¹¶ä¸”ä¸å…è®¸å’Œ NSArray è¿›è¡Œæ¡¥æ¥çš„ã€‚ å½“æˆ‘ä»¬çš„æ•°ç»„å…ƒç´ æ˜¯ Class æˆ– @objc protocol ç±»å‹çš„è¯ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸éœ€è¦åœ¨ Objective-C ä¸­ä½¿ç”¨è¯¥æ•°ç»„çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ€å¥½ä½¿ç”¨ ContiguousArrayã€‚è¿™æ˜¯å› ä¸º Array éœ€è¦é¢å¤–çš„èµ„æºæ¥å¤„ç†è·Ÿ NSArray çš„æ¡¥æ¥åŠŸèƒ½ï¼Œä½†æ˜¯ ContiguousArray åˆ™ä¸éœ€è¦ï¼Œæ‰€ä»¥ ContiguousArray æ¯” Array çš„æ•ˆç‡è¦é«˜ã€‚ 1234567class A &#123;&#125;// ä¸è¦ç”¨Array: let array = Array&lt;A&gt;()let contiguousArray = ContiguousArray&lt;A&gt;() å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯å®˜æ–¹æ–‡æ¡£è¯´å¦‚æœæ•°ç»„å…ƒç´ ä¸æ˜¯ Class å’Œ @objc protocol ç±»å‹çš„è¯ï¼ŒArray å’Œ ContiguousArray çš„æ•ˆç‡æ˜¯ä¸€æ ·çš„ã€‚ï¼ˆæˆ‘çŒœæµ‹æ˜¯å› ä¸ºå¦‚æœ Array çš„å…ƒç´ éƒ½æ˜¯ Struct ç±»å‹çš„è¯ï¼Œå®ƒå°±ä¸éœ€è¦æ¶ˆè€—èµ„æºæ¥å¤„ç†æ¡¥æ¥çš„é—®é¢˜äº†ã€‚ï¼‰ Efficiency is equivalent to that of Array, unless Element is a class or @objc protocol type, in which case using ContiguousArray may be more efficient. ä½†æ˜¯ @Paul Hudson åœ¨ä»–çš„ã€ŠPro Swiftã€‹ä¸­è¯´ä»–å‘ç°å³ä½¿æ•°ç»„å…ƒç´ æ˜¯ Struct ç±»å‹çš„è¯ï¼ŒContiguousArray ä¹Ÿè¦æ¯” Array æ›´å¿«ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä»–ç»™å‡ºçš„ä¾‹å­ï¼š 123456789101112let array2 = Array&lt;Int&gt;(1...1000000)let array3 = ContiguousArray&lt;Int&gt;(1...1000000)var start = CFAbsoluteTimeGetCurrent()array2.reduce(0, combine: +)var end = CFAbsoluteTimeGetCurrent() - startprint(\"Took \\(end) seconds\")start = CFAbsoluteTimeGetCurrent()array3.reduce(0, combine: +)end = CFAbsoluteTimeGetCurrent() - startprint(\"Took \\(end) seconds\") ç»è¿‡æˆ‘çš„æµ‹è¯•ï¼Œä¸Šé¢çš„ä»£ç ä¸­ ContiguousArray åªç”¨äº†0.19ç§’è€Œ Array ç”¨äº†0.38ç§’ï¼Œæ‰€ä»¥ ContiguousArray ç¡®å®è¦æ¯” Array å¿«ã€‚ å¦‚æœå¤§å®¶æƒ³åœ¨æ€§èƒ½ä¸Šæœ‰æ‰€æå‡çš„è¯ï¼Œå»ºè®®å¤§å®¶å¯ä»¥ç”¨ ContiguousArray è¯•ä¸€è¯•ã€‚","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://hparis.github.io/blog/categories/æŠ€æœ¯/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://hparis.github.io/blog/tags/iOS/"},{"name":"Swift","slug":"Swift","permalink":"https://hparis.github.io/blog/tags/Swift/"}]},{"title":"Shell Tip","slug":"Shell-Tip","date":"2017-09-05T15:30:56.000Z","updated":"2018-04-09T03:12:39.696Z","comments":true,"path":"2017/09/05/Shell-Tip/","link":"","permalink":"https://hparis.github.io/blog/2017/09/05/Shell-Tip/","excerpt":"","text":"è®°å½•æ—¥å¸¸ä¸­ç”¨åˆ°çš„ä¸€äº› Bash è„šæœ¬ï¼Œç»å¸¸æ›´æ–° Tip 1 : ä¿®æ”¹æ–‡ä»¶é‡Œé¢çš„å†…å®¹æ—©ä¸Šäº§å“æœ‰ä¸€ä¸ªå°éœ€æ±‚å°±æ˜¯æŠŠå·¥ç¨‹ä¸­çš„æ‰€æœ‰ç½‘é¡µçš„æ ‡é¢˜ä¿®æ”¹ä¸ºé»‘ç±³æµé‡é€šï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®ç° 1$ find . -name '*.html' -print0 | xargs -0 sed -i '' -e 's/&lt;title&gt;.*&lt;\\/title&gt;/&lt;title&gt;é»‘ç±³æµé‡é€š&lt;\\/title&gt;/g' find æŸ¥æ‰¾å‘½ä»¤ï¼Œå¯ä»¥ç”¨ man find æŸ¥çœ‹æ›´å¤šçš„ä¿¡æ¯ . ä»£è¡¨å½“å‰ç›®å½• -name find å‘½ä»¤çš„å‚æ•°ï¼Œè¡¨ç¤ºè¦æŸ¥æ‰¾çš„æ–‡ä»¶å -print0 æ˜¯ä¸€ç§ä¸æ¢è¡Œçš„è¾“å‡ºæ ¼å¼ï¼Œä»¥ ASCII NUL å­—ç¬¦ï¼ˆä¹Ÿå°±æ˜¯\\0ï¼‰ä½œä¸ºåˆ†éš”ç¬¦ã€‚ä¸Šé¢çš„ä¾‹å­å¯èƒ½æ˜¯ a.html\\0b.html\\0c.html | è¿™æ˜¯ä¸€ä¸ªç®¡é“ç¬¦ï¼Œè¡¨ç¤ºæŠŠå‰é¢å‘½ä»¤çš„è¾“å‡ºä½œä¸ºåé¢å‘½ä»¤çš„è¾“å…¥ xargs æ˜¯ç”¨æ¥æ„é€ è¾“å…¥å‚æ•°ï¼Œå¹¶ä¸”å¾ªç¯æ‰§è¡Œæ¯ä¸€ä¸ªå‚æ•° -0 è¡¨ç¤ºè®© xargs ä½¿ç”¨ ASCII NUL æ¥åˆ†éš”å‚æ•°ã€‚ä¸Šé¢çš„ä¾‹å­å°†è¢«åˆ†éš”æˆ a.html b.html c.html ä¸‰ä¸ªå‚æ•°ä¾æ¬¡æ‰§è¡Œ sed è¿™æ˜¯ä¸€ä¸ªæµç¼–è¾‘å™¨ï¼Œå¦‚æœä¼ çš„æ˜¯æ–‡ä»¶åä¼šæŠŠæ–‡ä»¶å†…å®¹è¯»å…¥å†…å­˜ï¼Œå¦‚æœåªæ˜¯æ™®é€šå­—ç¬¦ä¸²å°±ä¼šæŠŠå­—ç¬¦ä¸²è¯»å…¥å†…å­˜ -i è¡¨ç¤ºè¦æŠŠåŸæ¥çš„æ–‡ä»¶å†…å®¹åšä¸€æ¬¡å¤‡ä»½ï¼Œåé¢çš„ &#39;&#39; æ˜¯è¡¨ç¤ºè¦å¤‡ä»½çš„æ–‡ä»¶åå­—ï¼Œå¦‚æœæ²¡æœ‰æ–‡ä»¶åå­—å°±è¡¨ç¤ºä¸éœ€è¦å¤‡ä»½ -e è¡¨ç¤ºåé¢çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼Œéœ€è¦è¢«æ‰§è¡Œ s/old/new/g è¿™ä¸ªæ˜¯ç”¨æ¥æ›¿æ¢å­—ç¬¦ä¸²çš„å‘½ä»¤ Tip 2 : æŸ¥æ‰¾æ–‡ä»¶çš„å†…å®¹æŠŠåŒ¹é…çš„æ–‡ä»¶å†…å®¹çš„ç›¸å…³æ–‡ä»¶åˆ—å‡ºæ¥ 1$ find . -name '*.html' -print0 | xargs -0 grep 'PATTERN' Tip 3 : è§£å†³ Homebrew çš„æƒé™é—®é¢˜æŸ¥çœ‹ Homebrew çš„æ‰€æœ‰æƒ 1$ ls -al `which brew` æŠŠ Homebrew çš„ç”¨æˆ·å’Œåˆ†ç»„ä¿®æ”¹ä¸º root å’Œ wheel 1$ sudo chown root:wheel `which brew` æœ€åè¿˜åŸ Homebrew çš„æƒé™ï¼ˆå®‰å…¨ï¼‰ 1$ sudo chown : `chown brew` Tip 4 : åˆ©ç”¨ Shell ç”Ÿæˆç”Ÿæˆ ICON12345678910111213141516171819202122232425262728#!/bin/sh#æ­¤è„šæœ¬æ˜¯ç”¨æ¥ç”Ÿæˆ iPhone å’Œ iPad æ‰€éœ€ icon çš„ä¸åŒå°ºå¯¸çš„ï¼Œæœ€å¥½æ˜¯å‡†å¤‡ä¸€å¼  1024x1024 çš„ Icon å›¾ç‰‡filename=\"icon.png\"dirname=\"icon\"name_array=(\"Icon-20.png\" \"Icon-20@2x.png\" \"Icon-20@3x.png\"\"Icon-29.png\" \"Icon-29@2x.png\" \"Icon-29@3x.png\"\"Icon-40.png\" \"Icon-40@2x.png\" \"Icon-40@3x.png\"\"Icon-60@2x.png\" \"Icon-60@3x.png\"\"Icon-76.png\" \"Icon-76@2x.png\"\"Icon-83.5@2x.png\")size_array=(\"20\" \"40\" \"80\"\"29\" \"58\" \"87\"\"40\" \"80\" \"120\"\"120\" \"180\"\"76\" \"152\"\"167\")mkdir $dirnamefor ((i=0;i&lt;$&#123;#name_array[@]&#125;;++i)); do m_dir=$dirname/$&#123;name_array[i]&#125; cp $filename $m_dir sips -Z $&#123;size_array[i]&#125; $m_dirdone Tip5 : ä½¿ç”¨ Python å…±äº«å½“å‰ç›®å½•åˆ©ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æš‚æ—¶å¼€å¯ä¸€ä¸ªç«¯å£å·ä¸º 8000 çš„ HTTP æœåŠ¡ï¼Œå…¶ä»–äººåªéœ€è¦åœ¨æµè§ˆå™¨è¾“å…¥ http://ip-address:8000 å³å¯æµè§ˆå…±äº«ç›®å½•ä¸‹çš„æ–‡ä»¶ 1$ python -m SimpleHTTPServer Tip6 : åŠ å¯†å’Œè§£å¯†æ–‡ä»¶ åŠ å¯† 1$ tar czf - &#123;SRC_DIR&#125; | openssl des3 -salt -k \"&#123;KEY&#125;\" -out &#123;DIST_PACKAGE&#125;.tar.gz ç¤ºä¾‹ï¼š ç›®å½•å paris_codeï¼Œç§˜é’¥ meta#comï¼Œè¾“å‡ºåŒ… paris_code_20161008.tar.gz 1$ tar czf - paris_code | openssl des3 -salt -k \"meta#com\" -out paris_code_20161008.tar.gz è§£å¯† ç¬¬ä¸€æ­¥ï¼šè·å–ä»£ç å‹ç¼©æ–‡ä»¶åŒ… ä¸‹è½½åœ°å€ http://XXXX.com/paris_code_20161008.tar.gz ç¬¬äºŒæ­¥ï¼šè§£å¯†æ–‡ä»¶ï¼ˆOS X / Linux onlyï¼‰ åœ¨ Terminal è¿›å…¥å‹ç¼©æ–‡ä»¶åŒ…åŒçº§ç›®å½•ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š 1$ openssl des3 -d -k \"meta#com\" -salt -in paris_code_20161008.tar.gz | tar xzf - Tip7: iOS æ‰“åŒ…å‘½ä»¤12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788echo \"----------------\"echo \"Begin Build!\"PROJECT_NAME=\"orbit\"BUILD_DATE=\"$(date +'%Y%m%d')\"BUNDLE_ID=\"com.meta.paris\"cd $&#123;WORKSPACE&#125;#/usr/local/bin/npm installif [ -d \"$&#123;WORKSPACE&#125;/build\" ]; then if ls $&#123;WORKSPACE&#125;/build/**/*.ipa 1&gt; /dev/null 2&gt;&amp;1; then rm -rf $&#123;WORKSPACE&#125;/build/**/*.ipa; fi; if ls $&#123;WORKSPACE&#125;/build/**/*.xcarchive 1&gt; /dev/null 2&gt;&amp;1; then rm -rf $&#123;WORKSPACE&#125;/build/**/*.xcarchive; fi;else mkdir $&#123;WORKSPACE&#125;/build; fi;echo \"è®¡ç®—ä»Šå¤©çš„ Build Version\"if [ -d \"$&#123;WORKSPACE&#125;/build/$&#123;BUILD_DATE&#125;\" ]; then #å¦‚æœä¸åŠ ä¸Šé¢çš„ if, Jenkins æ— æ³•ç›´æ¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤â“ BUILD_DATE_COUNT=$(ls $&#123;WORKSPACE&#125;/build | grep \"^$&#123;BUILD_DATE&#125;\" -c) if [ $&#123;BUILD_DATE_COUNT&#125; -lt 10 ]; then BUILD_DATE_COUNT=\"0$&#123;BUILD_DATE_COUNT&#125;\" fi; BUILD_VERSION=\"$&#123;BUILD_DATE&#125;$&#123;BUILD_DATE_COUNT&#125;\"else BUILD_VERSION=$&#123;BUILD_DATE&#125;fi;echo \"ä»Šå¤©çš„ Build Version æ˜¯ $&#123;BUILD_VERSION&#125;\"if [ -d \"$&#123;WORKSPACE&#125;/build/$&#123;BUILD_VERSION&#125;\" ]; then rm -rf $&#123;WORKSPACE&#125;/build/$&#123;BUILD_VERSION&#125;; fi;mkdir $&#123;WORKSPACE&#125;/build/$&#123;BUILD_VERSION&#125;;if [ -d \"$&#123;WORKSPACE&#125;/Enterprise.plist\" ]; then rm $&#123;WORKSPACE&#125;/Enterprise.plist; fi;#http://www.matrixprojects.net/p/xcodebuild-export-options-plist/Enterprise='&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;&lt;plist version=\"1.0\"&gt;&lt;dict&gt; &lt;key&gt;teamID&lt;/key&gt; &lt;string&gt;&lt;/string&gt; &lt;key&gt;method&lt;/key&gt; &lt;string&gt;app-store&lt;/string&gt; &lt;key&gt;uploadSymbols&lt;/key&gt; &lt;true/&gt; &lt;key&gt;uploadBitcode&lt;/key&gt; &lt;false/&gt;&lt;/dict&gt;&lt;/plist&gt;'echo $&#123;Enterprise&#125; &gt; $&#123;WORKSPACE&#125;/Enterprise.plistsed -i '' 's/ProvisioningStyle = Automatic;/ProvisioningStyle = Manual;/g' \\$&#123;WORKSPACE&#125;/$&#123;PROJECT_NAME&#125;.xcodeproj/project.pbxprojsed -i '' 's/DEVELOPMENT_TEAM = .*;/DEVELOPMENT_TEAM = \"\";/g' \\$&#123;WORKSPACE&#125;/$&#123;PROJECT_NAME&#125;.xcodeproj/project.pbxproj#åŠ¨æ€ç”Ÿæˆ Build Versionsed -i '' \"/&lt;key&gt;CFBundleVersion&lt;\\/key&gt;/&#123;N;s/&lt;string&gt;.*&lt;\\/string&gt;/&lt;string&gt;$&#123;BUILD_VERSION&#125;&lt;\\/string&gt;/g;&#125;\" \\$&#123;WORKSPACE&#125;/$&#123;PROJECT_NAME&#125;/$&#123;PROJECT_NAME&#125;-Info.plistxcodebuild -workspace $&#123;WORKSPACE&#125;/$&#123;PROJECT_NAME&#125;.xcworkspace \\-scheme $&#123;PROJECT_NAME&#125; -sdk iphoneos \\build CODE_SIGN_IDENTITY=\"iPhone Distribution: Beijing PS Technology Co., Ltd.\" \\PROVISIONING_PROFILE=\"\" \\-configuration Release clean archive \\-archivePath $&#123;WORKSPACE&#125;/build/$&#123;BUILD_VERSION&#125;/$&#123;PROJECT_NAME&#125;.xcarchivexcodebuild -exportArchive -exportOptionsPlist $&#123;WORKSPACE&#125;/Enterprise.plist \\-archivePath $&#123;WORKSPACE&#125;/build/$&#123;BUILD_VERSION&#125;/$&#123;PROJECT_NAME&#125;.xcarchive \\-exportPath $&#123;WORKSPACE&#125;/build/$&#123;BUILD_VERSION&#125;/echo \"----------------\"echo \"Build successfully!\"echo \"Begin Upload to itunes...\"#Use [shenzhen](https://github.com/nomad/shenzhen) to upload the ipa file to itunes connect./usr/local/bin/ipa distribute:itunesconnect -f $&#123;WORKSPACE&#125;/build/$&#123;BUILD_VERSION&#125;/$&#123;PROJECT_NAME&#125;.ipa -a YourAppleID -p YourPassword -i $&#123;BUNDLE_ID&#125; --uploadecho \"Upload successfully!\" Tip8: é‡ç½® iOS æ¨¡æ‹Ÿå™¨ç›¸ä¿¡å„ä½åœ¨åš iOS å¼€å‘çš„åŒå­¦éƒ½ä¼šç¢°åˆ°æ¨¡æ‹Ÿå™¨ä¸Šå„ç§ç¥å¥‡çš„ç°è±¡ï¼Œé€šè¿‡é‡ç½® iOS æ¨¡æ‹Ÿå™¨åŸºæœ¬ä¸Šå¯ä»¥è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ï¼š 123456// é€€å‡ºå½“å‰çš„æ‰€æœ‰æ¨¡æ‹Ÿå™¨$ osascript -e 'tell application \"iOS Simulator\" to quit'$ osascript -e 'tell application \"Simulator\" to quit'// æ¸…æ‰ä¹‹å‰ä½¿ç”¨æ¨¡æ‹Ÿå™¨äº§ç”Ÿçš„æ‰€æœ‰å†…å®¹$ xcrun simctl erase all","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://hparis.github.io/blog/categories/æŠ€æœ¯/"}],"tags":[{"name":"tip","slug":"tip","permalink":"https://hparis.github.io/blog/tags/tip/"}]},{"title":"Swift High-Performance Tip 2ï¼šfinal å’Œ private(fileprivate)","slug":"Swift-High-Performance-Tip 2ï¼šfinalå’Œprivate(fileprivate)","date":"2017-09-05T15:30:56.000Z","updated":"2018-03-23T08:43:01.021Z","comments":true,"path":"2017/09/05/Swift-High-Performance-Tip 2ï¼šfinalå’Œprivate(fileprivate)/","link":"","permalink":"https://hparis.github.io/blog/2017/09/05/Swift-High-Performance-Tip 2ï¼šfinalå’Œprivate(fileprivate)/","excerpt":"","text":"Dynamic dispatch means that program has to determine at run time which method or property is being referred to and then perform an indirect call or indirect access. æˆ‘ä»¬éƒ½çŸ¥é“ Swift çš„ class æ˜¯å¯ä»¥è¢«ç»§æ‰¿ï¼Œfunction å’Œ property æ˜¯å¯ä»¥è¢«é‡å†™çš„ï¼Œè€Œè¿™å°±æ„å‘³ç€ Swift éœ€è¦ dynamic dispatch è¿™ç§æœºåˆ¶æ¥å®Œæˆè¿™äº›åŠŸèƒ½ã€‚Swift çš„ dynamic dispatch é¦–å…ˆä¼šå† method table æŸ¥æ‰¾æ–¹æ³•ï¼Œç„¶åé—´æ¥è°ƒç”¨ã€‚å¾ˆæ˜æ˜¾è¿™ç§æ–¹å¼è¦æ¯”ç›´æ¥è°ƒç”¨çš„æ•ˆç‡æ…¢ï¼Œå¹¶ä¸”ç”¨é—´æ¥è°ƒç”¨çš„æ–¹å¼è¿˜ä¼šé˜»æ­¢ç¼–è¯‘å™¨çš„ä¸€äº›ä¼˜åŒ–æ— æ³•å®ç°ã€‚ é‚£ä¹ˆåº”è¯¥æ€ä¹ˆä¼˜åŒ–å‘¢ï¼Ÿ å½“æˆ‘ä»¬æ˜ç¡®çš„çŸ¥é“ classã€functionã€property æ˜¯ä¸éœ€è¦ overriddenï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ final å’Œ private(fileprivate) è¿™äº›å…³é”®å­—å‡å°‘åŠ¨æ€æ´¾å‘çš„å‘ç”Ÿï¼Œä»è€Œæœ‰æ•ˆçš„æé«˜æ•ˆç‡ã€‚ åœ¨ Swift ä¸­ï¼Œå¦‚æœè¢« final æˆ– private(fileprivate) ä¿®é¥°çš„ classã€functionã€property æ˜¯ä¸èƒ½ overriddenï¼Œå¹¶ä¸”è°ƒç”¨è¿™äº› classã€functionã€property çš„æ—¶å€™ä¸å†é€šè¿‡ dynamic dispatch å»é—´æ¥è°ƒç”¨ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨ã€‚ æ‰€ä»¥ï¼Œé€šè¿‡åœ¨å¿…è¦çš„ä»£ç ä¸­ä½¿ç”¨ final æˆ– private(fileprivate) è¿™äº›å…³é”®å­—è¿›è¡Œä¼˜åŒ–çš„è¯ï¼Œå°†å¯ä»¥æœ‰æ•ˆæé«˜çš„æ•ˆç‡ã€‚ Whole Module Optimization Swift çš„ classã€functionã€property çš„é»˜è®¤æƒé™éƒ½æ˜¯ internal ï¼Œé™¤éæˆ‘ä»¬æ˜ç¡®çš„åŠ ä¸Š public æˆ– private(fileprivate) å…³é”®å­—æ‰èƒ½æ”¹å˜å®ƒä»¬çš„é»˜è®¤æƒé™ã€‚ ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ Module çš„æ—¶å€™éƒ½æ˜¯å¯¹é‡Œé¢çš„æºæ–‡ä»¶è¿›è¡Œå•ç‹¬ç¼–è¯‘ï¼Œè¿™æ ·çš„è¯ç¼–è¯‘å™¨å°±æ— æ³•ç¡®åˆ‡çš„çŸ¥é“è¢« internal ä¿®é¥°çš„ classã€functionã€property ç©¶ç«Ÿæœ‰æ²¡æœ‰è¢« overriddenã€‚ä¸€æ—¦æˆ‘ä»¬å¼€å¯ Whole Module Optimization çš„ä¼˜åŒ–é€‰é¡¹ï¼Œç¼–è¯‘å™¨å°±ä¼šåŒæ—¶å¯¹æ•´ä¸ª Module çš„æ‰€æœ‰æºæ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œè¿™ä¸ªæ—¶å€™ç¼–è¯‘å™¨å°±å¯ä»¥çŸ¥é“å“ªäº›è¢« internal ä¿®é¥°çš„ classã€functionã€property æ²¡æœ‰è¢« overriddenï¼Œä»è€ŒæŠŠå®ƒä»¬çš„æƒé™ä» internal ä¿®æ”¹ä¸º finalã€‚è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å‡å°‘ dynamic dispatch çš„å‘ç”Ÿä»è€Œæé«˜æ•ˆç‡ã€‚ å¼€å¯ç¼–è¯‘ä¼˜åŒ–é€‰é¡¹çš„æ­¥éª¤å¦‚ä¸‹ï¼šXcode -&gt; Build Settings -&gt; Swift Compiler -&gt; Optimization Levelã€‚ å‚è€ƒæ–‡çŒ® https://www.reddit.com/r/iOSProgramming/comments/3atu5w/does_swift_use_dynamic_method_dispatch_or_a/ https://developer.apple.com/swift/blog/?id=27 https://github.com/apple/swift/blob/3ef6c79e3c591cf31b8a853b1357e1b8c5771252/docs/OptimizationTips.rst#whole-module-optimizations","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://hparis.github.io/blog/categories/æŠ€æœ¯/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://hparis.github.io/blog/tags/iOS/"},{"name":"Swift","slug":"Swift","permalink":"https://hparis.github.io/blog/tags/Swift/"}]},{"title":"åˆæ­¥äº†è§£ GCD","slug":"åˆæ­¥äº†è§£GCD","date":"2017-09-05T15:30:56.000Z","updated":"2018-04-16T08:00:54.841Z","comments":true,"path":"2017/09/05/åˆæ­¥äº†è§£GCD/","link":"","permalink":"https://hparis.github.io/blog/2017/09/05/åˆæ­¥äº†è§£GCD/","excerpt":"","text":"GCD ç®€ä»‹GCD(Grand Central Dispatch) æ˜¯è‹¹æœæä¾›çš„ä¸€å¥—å¤šçº¿ç¨‹ç¼–ç¨‹æŠ€æœ¯ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœè®©ä½ ç¼–å†™ä¸€ä¸ªå¯ä»¥é«˜æ•ˆçš„è·‘åœ¨ä¸åŒè®¡ç®—æœºã€ä¸åŒå†…æ ¸çš„åº”ç”¨ç¨‹åºï¼Œä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿä½ è¦çœ‹çœ‹ç¡¬ä»¶æ˜¯ä»€ä¹ˆï¼Œçœ‹çœ‹æœ‰æœ‰å¤šå°‘ä¸ªå†…æ ¸ï¼Œæƒ³æƒ³ç”¨ä»€ä¹ˆç®—æ³•ï¼Œæƒ³æƒ³åœ¨ä»€ä¹ˆæ—¶å€™å»åˆ‡æ¢çº¿ç¨‹â€¦æ€»ä¹‹ï¼Œä½ è¦åšçš„ä¸œè¥¿å¤šäº†å»äº†ã€‚è€Œ GCD å¸®æˆ‘ä»¬å±è”½äº†è¿™äº›æŠ€æœ¯ç»†èŠ‚ï¼Œä½†æ˜¯å¦‚æœè¦ç”¨å¥½ GCD çš„è¯ï¼Œè¿˜æ˜¯è¦å¤šäº†è§£ä¸€äº›çŸ¥è¯†ç‚¹ã€‚ Dispatch å¯¹è±¡å’Œå†…å­˜ç®¡ç†åœ¨ Objective-C é‡Œé¢ï¼Œæ‰€æœ‰çš„ dispatch å¯¹è±¡éƒ½æ˜¯ Objective-C å¯¹è±¡ï¼Œæ‰€ä»¥ä»–ä»¬åŒæ ·é€‚ç”¨å¼•ç”¨æŠ€æœ¯çš„å†…å­˜ç®¡ç†ã€‚å¦‚æœä½ æ˜¯ä½¿ç”¨ ARC çš„è¯ï¼Œdispatch å¯¹è±¡ä¼šå‘æ™®é€šçš„ Objective-C å¯¹è±¡ä¸€æ ·è‡ªåŠ¨è¿›è¡Œ retain å’Œ release æ“ä½œï¼›å¦‚æœä½ æ˜¯ä½¿ç”¨ MRCï¼Œè¦è®°ä½ä½¿ç”¨ dispatch_retain å’Œ dispatch_release æ¥è¿›è¡Œç®¡ç†ã€‚ å¸¸ç”¨ APIdispatch_queue_tï¼ˆè°ƒåº¦é˜Ÿåˆ—ï¼‰1public func dispatch_queue_create(label: UnsafePointer&lt;Int8&gt;, _ attr: dispatch_queue_attr_t!) -&gt; dispatch_queue_t! åœ¨ GCD ä¸­åªèƒ½é€šè¿‡ä¸Šé¢çš„ API æ¥åˆ›å»ºè°ƒåº¦é˜Ÿåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºå„ç§å„æ ·çš„ Block å½¢å¼çš„ä»»åŠ¡å¹¶ç”±è¯¥è°ƒåº¦é˜Ÿåˆ—æ¥å†³å®šå¦‚ä½•å»æ‰§è¡Œè¿™äº› Block ä»»åŠ¡ã€‚ä¸Šé¢åˆ›å»ºè°ƒåº¦é˜Ÿåˆ—çš„å‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼š label: è¿™ä¸ªå‚æ•°æ˜¯ç”¨æ¥ç»™ä½ åˆ›å»ºçš„è°ƒåº¦é˜Ÿåˆ—è¿›è¡Œå‘½åçš„ï¼Œç‰¹åˆ«æ˜¯åœ¨è°ƒè¯•çš„æ—¶å€™ä½ å¯ä»¥é€šè¿‡è¯¥å‚æ•°æ¥åˆ¤æ–­æ˜¯å“ªä¸ªè°ƒåº¦é˜Ÿåˆ—çš„ä»»åŠ¡åœ¨æ‰§è¡Œã€‚ attr: è¿™ä¸ªå‚æ•°åªæœ‰ DISPATCH_QUEUE_SERIAL å’Œ DISPATCH_QUEUE_CONCURRENT ä¸¤ç§å€¼ï¼ˆåœ¨ Objective-C ä¸­è¿™ä¸ªå‚æ•°å¯ä»¥ä¸º NULLï¼Œè¿™ä¸ªæ—¶å€™é»˜è®¤æ˜¯ DISPATCH_QUEUE_SERIALï¼‰ã€‚DISPATCH_QUEUE_SERIAL æ˜¯å‘Šè¯‰è°ƒåº¦é˜Ÿåˆ—ä»¥ä¸²è¡Œçš„æ–¹å¼å»æ‰§è¡Œä»»åŠ¡ï¼ŒDISPATCH_QUEUE_CONCURRENT æ˜¯å‘Šè¯‰è°ƒåº¦é˜Ÿåˆ—ä»¥å¹¶å‘çš„æ–¹å¼å»æ‰§è¡Œä»»åŠ¡ã€‚ å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ¥è·å–ç³»ç»Ÿå·²ç»åˆ›å»ºå¥½çš„è°ƒåº¦é˜Ÿåˆ—ï¼š 12// è·å–å…¨å±€é˜Ÿåˆ—public func dispatch_get_global_queue(identifier: Int, _ flags: UInt) -&gt; dispatch_queue_t! 12// è·å–ä¸»çº¿ç¨‹çš„com.apple.main-thread (serial)é˜Ÿåˆ—public func dispatch_get_main_queue() -&gt; dispatch_queue_t! æ³¨æ„ï¼Œæ‰€æœ‰ pending çŠ¶æ€çš„ Block ä»»åŠ¡éƒ½ä¼šæŒæœ‰è¯¥è°ƒåº¦é˜Ÿåˆ—çš„å¼•ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æ˜¾ç¤ºçš„å»æŒæœ‰è°ƒåº¦é˜Ÿåˆ—ï¼Œè€Œè°ƒåº¦é˜Ÿåˆ—ä¼šåœ¨æ‰€æœ‰çš„ Block ä»»åŠ¡éƒ½ä» pending å˜ä¸º finished ä¹‹åæ‰ä¼šè¢«é‡Šæ”¾ã€‚ æ€»ä¹‹ï¼Œç°åœ¨å¤§å®¶è¦çŸ¥é“çš„æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠä¸åŒçš„ Blockä»»åŠ¡æäº¤åˆ°è°ƒåº¦é˜Ÿåˆ—ï¼Œå…·ä½“çš„ç»†èŠ‚å’Œå®ç°çœ‹çœ‹åé¢å†…å®¹ã€‚ dispatch_sync å’Œ dispatch_asyncï¼ˆåŒæ­¥å’Œå¼‚æ­¥ï¼‰123456789101112let queue = dispatch_queue_create(\"com.PS.Queue\", DISPATCH_QUEUE_SERIAL) // åˆ›å»ºè°ƒåº¦é˜Ÿåˆ—print(\"Begin Sync\")// åŒæ­¥è°ƒç”¨dispatch_sync(queue) &#123; // Blockä»»åŠ¡ print(\"Execute Block Task1\") &#125;dispatch_sync(queue) &#123; // Blockä»»åŠ¡ print(\"Execute Block Task2\") &#125;print(\"After Sync\") è¿™æ®µä»£ç çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 1234Begin SyncExecute Block Task1Execute Block Task2After Sync ä¸Šé¢çš„ä¾‹å­å°±æ˜¯æˆ‘ä»¬å¹³å¸¸å¯¹ dispatch_sync çš„ç”¨æ³•ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ª Block ä»»åŠ¡æ‰§è¡Œä¹‹åæ‰ä¼šæ‰§è¡Œç¬¬äºŒä¸ª Block ä»»åŠ¡ã€‚dispatch_sync éœ€è¦ç­‰å¾… Blockçš„ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åï¼Œæ‰èƒ½ç»§ç»­å¾€åæ‰§è¡Œã€‚ä½†æ˜¯ä½¿ç”¨ dispatch_sync çš„æ—¶å€™ï¼Œæœ‰å‡ ç‚¹æ˜¯éœ€è¦æ³¨æ„çš„ï¼š å½“è°ƒç”¨ dispatch_sync æ–¹æ³•çš„æ—¶å€™ï¼Œç³»ç»Ÿé»˜è®¤æƒ…å†µä¸‹ä¼šåœ¨å½“å‰çº¿ç¨‹å»æ‰§è¡Œè°ƒåº¦é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼Œåªæœ‰åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹æ‰ä¼šæŠŠè°ƒåº¦é˜Ÿåˆ—çš„ä»»åŠ¡åˆ†é…åˆ°å…¶ä»–çº¿ç¨‹å»æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬å°±çŸ¥é“ï¼Œçº¿ç¨‹å’Œè°ƒåº¦é˜Ÿåˆ—å¹¶ä¸æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚è‡³äºä¸ºä»€ä¹ˆé»˜è®¤æƒ…å†µä¸‹ä¼šåœ¨å½“å‰çº¿ç¨‹å»æ‰§è¡Œè°ƒåº¦é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼Œæˆ‘çš„çŒœæµ‹æ˜¯ä¸ºäº†æ€§èƒ½ã€‚å¤§å®¶æƒ³ä¸€æƒ³ï¼Œdispatch_sync ä¼šåŒæ­¥æ‰§è¡Œ Blockä»»åŠ¡ï¼Œ Blockä»»åŠ¡æ²¡æœ‰ç»“æŸçš„æƒ…å†µä¸‹ï¼Œåé¢çš„ä»£ç æ˜¯æ— æ³•æ‰§è¡Œçš„ã€‚åŸºäºè¿™æ ·ä¸€ä¸ªåŒæ­¥çš„æœºåˆ¶ï¼ŒGCD è¿˜æœ‰å¿…è¦å…ˆæŠŠå½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œç„¶åå»åˆ›å»ºæ–°çº¿ç¨‹ï¼Œç„¶ååˆ‡æ¢åˆ°æ–°çš„çº¿ç¨‹å»æ‰§è¡Œè°ƒåº¦é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼Œç„¶åå†æŠŠçº¿ç¨‹åˆ‡æ¢åˆ°å½“å‰çº¿ç¨‹ï¼Œç„¶åå†è®©å½“å‰çº¿ç¨‹æ¢å¤ä¹ˆï¼Ÿç»“è®ºæ˜¯æ²¡æœ‰å¿…è¦ã€‚ ä½ ä¸èƒ½å¤Ÿåœ¨å½“å‰çš„ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—çš„ä»»åŠ¡é‡Œé¢å»æ·»åŠ æ–°çš„ä»»åŠ¡åˆ°å½“å‰çš„è°ƒåº¦é˜Ÿåˆ—é‡Œé¢ï¼Œå¦åˆ™ä¼šé€ æˆæ­»é”ã€‚è¿™å¥è¯æ€ä¹ˆç†è§£å‘¢ï¼Œæˆ‘ä»¬æ¥æ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š 123456789101112131415// ä¾‹1let queue = dispatch_queue_create(\"com.PS.Queue\", DISPATCH_QUEUE_SERIAL) // åˆ›å»ºä¸²è¡Œçš„è°ƒåº¦é˜Ÿåˆ—// åŒæ­¥è°ƒç”¨dispatch_sync(queue) &#123; // Block1 print(\"Begin Execute Block Task1\") dispatch_sync(queue) &#123; // Block2 print(\"Execute Block Task2\") &#125; print(\"End Execute Block Task1\")&#125;// ä¾‹1çš„ç»“æœBegin Execute Block Task1 ä¸ºä»€ä¹ˆ Block1 åé¢çš„ print å’Œ Block2 çš„ print éƒ½ä¸æ‰§è¡Œäº†å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“è¢« DISPATCH_QUEUE_SERIAL å£°æ˜çš„è°ƒåº¦é˜Ÿåˆ—æ˜¯ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—ï¼Œä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡æ˜¯åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼Œå¹¶ä¸”å½“å‰ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œä¸‹ä¸€ä¸ªä»»åŠ¡ä¹Ÿæ— æ³•æ‰§è¡Œã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ä¼šå…ˆè¾“å‡º Block1 ä¸­çš„ Begin Execute Block Task1ï¼Œç„¶åè¿™ä¸ªæ—¶å€™å†æŠŠ Block2 æ·»åŠ åˆ°åŒä¸€ä¸ªä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—ä¸­å»ã€‚è¿™ä¸ªæ—¶å€™çš„ Block1 è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œå®ƒéœ€è¦ç­‰ dispatch_sync çš„ Block2 æ‰§è¡Œå®Œæˆä¹‹åæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œè€Œ Block2 åˆå¿…é¡»ç­‰å¾… Block1 æ‰§è¡Œå®Œæˆä¹‹åæ‰èƒ½æ‰§è¡Œï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±é€ æˆ Block1 ç­‰ç€ Block2ï¼ŒBlock2 ç­‰ç€ Block1 çš„æ­»é”ã€‚ æˆ‘ä»¬å†æŠŠè°ƒåº¦é˜Ÿåˆ—å±æ€§æ”¹ä¸º DISPAT_QUEUE_CONCURRENTï¼Œç„¶åå†çœ‹çœ‹æ‰§è¡Œç»“æœæ˜¯ä»€ä¹ˆï¼š 123456789101112// ä¾‹2let queue = dispatch_queue_create(\"com.PS.Queue\", DISPATCH_QUEUE_SERIAL) // åˆ›å»ºä¸²è¡Œçš„è°ƒåº¦é˜Ÿåˆ—// åŒæ­¥è°ƒç”¨dispatch_sync(queue) &#123; // Block1 print(\"Begin Execute Block Task1\") dispatch_sync(queue) &#123; // Block2 print(\"Execute Block Task2\") &#125; print(\"End Execute Block Task1\")&#125; 1234// ä¾‹2çš„ç»“æœBegin Execute Block Task1Execute Block Task2End Execute Block Task1 è¢« DISPATCH_QUEUE_CONCURRENT å£°æ˜çš„å¹¶å‘è°ƒåº¦é˜Ÿåˆ—å°±æ²¡æœ‰è¿™ç§æ­»é”çš„é—®é¢˜ã€‚å¹¶å‘è°ƒåº¦é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡æ˜¯ä¸ä¼šéœ¸å èµ„æºä¸æ”¾çš„ï¼Œæ¯ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡æ®µä¹‹åä¼šæŠŠèµ„æºäº¤å‡ºæ¥ç»™åˆ«çš„ä»»åŠ¡å»æ‰§è¡Œã€‚æ‰€ä»¥ä¾‹2ä¸­çš„ Block1 è™½ç„¶éœ€è¦ç­‰å¾… Block2 æ‰§è¡Œå®Œæˆä¹‹åæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯å½“ Block1 åœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯å¯ä»¥æŠŠèµ„æºé‡Šæ”¾å‡ºæ¥äº¤ç»™ Block2 å»æ‰§è¡Œï¼ŒBlock2 æ‰§è¡Œå®Œæˆä¹‹å Block1 å°±å¯ä»¥ç»§ç»­æ‰§è¡Œäº†ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¸ä¼šé€ æˆæ­»é”æ¥ã€‚ å†æ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ä¼šä¸ä¼šé€ æˆæ­»é”ï¼š 12345override func viewDidLoad() &#123; dispatch_sync(dispatch_get_main_queue()) &#123; print(\"Excute Block Task\") &#125;&#125; ç­”æ¡ˆæ˜¯ä¼šçš„ã€‚ç»™å¤§å®¶ä¸€ç‚¹æç¤ºï¼Œä¸»çº¿ç¨‹çš„é»˜è®¤è°ƒåº¦é˜Ÿåˆ—æ˜¯ä¸²è¡Œï¼ˆDISPATCH_QUEUE_SERIALï¼‰çš„ï¼ŒviewDidLoad() æ˜¯åœ¨ä¸»çº¿ç¨‹çš„è°ƒåº¦é˜Ÿåˆ— com.apple.main-thread (serial) æ‰§è¡Œçš„ã€‚ ä¸Šé¢çš„ä¾‹å­ä¸»è¦æ˜¯å¸Œæœ›å¤§å®¶ç†è§£ä¸²è¡Œå’Œå¹¶å‘çš„æ¦‚å¿µï¼ŒåŒæ—¶è¦æ˜ç™½é€ æˆæ­»é”çš„åŸå› ã€‚è€Œè¦è§£å†³æ­»é”ä¸€èˆ¬å¯ä»¥ç”¨ DISPATCH_QUEUE_CONCURRENT æˆ–æ¥ä¸‹æ¥æˆ‘ä»¬è¦è®²çš„ dispatch_async æ¥è§£å†³ã€‚ é€šè¿‡å¯¹ dispatch_sync çš„äº†è§£ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ dispatch_async å¾ˆå¿«çš„å†™å‡ºå¼‚æ­¥ä»£ç ï¼š 123456789101112let queue = dispatch_queue_create(\"com.PS.Queue\", DISPATCH_QUEUE_SERIAL) // åˆ›å»ºè°ƒåº¦é˜Ÿåˆ—print(\"Begin Async\")// å¼‚æ­¥è°ƒç”¨dispatch_async(queue) &#123; // Block1 print(\"Execute Block Task1\") &#125;dispatch_async(queue) &#123; // Block2 print(\"Execute Block Task2\") &#125;print(\"After Async\") è¿™ä¸ªä¾‹å­çš„ç»“æœæœ‰å¥½å‡ ç§ï¼š 12345// ç»“æœ1Begin AsyncAfter AsyncExecute Block Task1ExEcute Block Task2 12345// ç»“æœ2Begin AsyncExecute Block Task1ExEcute Block Task2After Async ä¸Šé¢åªæ˜¯åˆ—å‡ºæ¥ä¸¤ç§å¯èƒ½ï¼Œä½†å®é™…ä¸Šè¿˜æœ‰å…¶ä»–çš„å¯èƒ½ã€‚å½“æˆ‘ä»¬è°ƒç”¨ dispatch_async çš„æ—¶å€™ï¼Œå®ƒæ€»æ˜¯ä¼šåœ¨ Block ä»»åŠ¡è¢«æäº¤ä¹‹åé©¬ä¸Šè¿”å›ï¼Œè€Œä¸ä¼šå‚»å‚»çš„ç­‰å¾… Block ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚ç”±äºä¸Šé¢åˆ›å»ºçš„æ˜¯ä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¿è¯ Block1 è¦æ¯” Block2 ä¼˜å…ˆæ‰§è¡Œï¼Œä½†æ˜¯ After Async å°±æ— æ³•ç¡®å®šæ˜¯åœ¨ Block1 çš„å‰åè¿˜æ˜¯ Block2 çš„å‰åã€‚ å¦‚æœæˆ‘ä»¬æŠŠä¸Šé¢çš„ DISPATCH_QUEUE_SERIAL æ”¹æˆ DISPATCH_QUEUE_CONCURRENTï¼Œé‚£æˆ‘ä»¬å°±æ— æ³•ç¡®å®š After Asyncã€Block1 å’Œ Block2 è¿™ä¸‰è€…çš„æ‰§è¡Œé¡ºåºäº†ã€‚ æˆ‘ä»¬åˆšæ‰è¯´åˆ°ç”¨ dispatch_async å¯ä»¥è§£å†³æ­»é”çš„é—®é¢˜ï¼Œé‚£å®ƒæ˜¯æ€ä¹ˆè§£å†³çš„å‘¢ï¼Ÿ 1234567891011let queue = dispatch_queue_create(\"com.PS.Queue\", DISPATCH_QUEUE_SERIAL) // åˆ›å»ºä¸²è¡Œçš„è°ƒåº¦é˜Ÿåˆ—// å¼‚æ­¥è°ƒç”¨dispatch_async(queue) &#123; // Block1 print(\"Begin Execute Block Task1\") dispatch_async(queue) &#123; // Block2 print(\"Execute Block Task2\") &#125; print(\"End Execute Block Task1\")&#125; ä¸Šé¢çš„ä¾‹å­ä¼šä¼˜å…ˆè¾“å‡º Block1 çš„ Begin Execute Block Task1 ä¹‹åï¼Œé€šè¿‡ dispatch_async æŠŠ Block2 æäº¤åˆ°ä¸²è¡Œé˜Ÿåˆ—é‡Œé¢ï¼Œç„¶ååˆé©¬ä¸Šè¿”å›åˆ° Block1 å»è¾“å‡º End Execute Block Task1ï¼Œè¿™ä¸ªæ—¶å€™çš„ Block1 å°±ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥å°±å¼€å§‹æ‰§è¡Œ Block2ã€‚æ‰€ä»¥ä¸Šé¢çš„ä»£ç æ˜¯ä¸ä¼šé€ æˆæ­»é”çš„ï¼Œè™½ç„¶ä¸Šé¢çš„ä¾‹å­ä¹Ÿæ˜¯åˆ›å»ºäº†ä¸€ä¸ªä¸²è¡Œè°ƒåº¦é˜Ÿåˆ—ï¼Œä½†æ˜¯è¯¥è°ƒåº¦é˜Ÿåˆ—åªæ˜¯ä¿è¯äº† Block1 è¦æ¯” Block2 ä¼˜å…ˆæ‰§è¡Œã€‚ dispatch_onceå†™è¿‡ Objective-C çš„äººéƒ½çŸ¥é“ï¼Œdispatch_once ä¸€èˆ¬ä¼šè¢«ç”¨æ¥åˆ›å»ºå•ä¾‹å¯¹è±¡ï¼š 12345678910@implementation Single+ (Single *)sharedInstance &#123; static Single * _single = nil; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; _single = [[Single alloc] init]; &#125;); return _single; &#125;@end è¿™æ˜¯ç”±äº dispatch_once æ˜¯çº¿ç¨‹å®‰å…¨ä¸”åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥æ‰ä¼šè¢«ç”¨æ¥ä½œä¸ºå•ä¾‹çš„å®ç°ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ dispatch_once_t å¿…é¡»æ˜¯é™æ€çš„æˆ–å…¨å±€çš„æ‰èƒ½ä¿è¯ dispatch_once çš„ Block åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç ç”¨äº† static æ¥ä¿®é¥° dispatch_once_tã€‚ dispatch_apply1public func dispatch_apply(iterations: Int, _ queue: dispatch_queue_t!, _ block: (Int) -&gt; Void) å…¶ä¸­çš„ interations æ˜¯è¡¨æ˜è¦æ‰§è¡Œå¤šå°‘æ¬¡ blockï¼Œblock ä¸­çš„ Int æ˜¯è¯¥ Block è¢«æ‰§è¡Œçš„åºå·ã€‚è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™è¦æ³¨æ„è¯¥æ–¹æ³•è·Ÿ dispatch_sync ä¸€æ ·ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ³¨æ„åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨è¯¥æ–¹æ³•ã€‚ dispatch_after1public func dispatch_after(when: dispatch_time_t, _ queue: dispatch_queue_t, _ block: dispatch_block_t) è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™éœ€è¦æ³¨æ„çš„æ˜¯ when è¿™ä¸ªå‚æ•°ï¼Œä½ éœ€è¦é€šè¿‡ dispatch_time æˆ– dispatch_walltime æ¥åˆ›å»ºã€‚å¹¶ä¸”è¯¥æ–¹æ³•æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå¹¶ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚ ä¸€èˆ¬çš„å†™æ³•å¦‚ä¸‹ï¼š 123dispatch_after(dispatch_time(DISPATCH_TIME_NOW, Int64(5 * NSEC_PER_SEC)), queue) &#123; print(\"5s \\(NSThread.currentThread())\")&#125; dispatch_group_tdispatch_group_t æ˜¯ç”¨æ¥åšèšåˆåŒæ­¥çš„ï¼Œå®ƒå¯ä»¥ç”¨æ¥è·Ÿè¸ªä½ æäº¤çš„æ‰€æœ‰ä»»åŠ¡ï¼ˆå³ä½¿æ˜¯åœ¨ä¸åŒçš„è°ƒåº¦é˜Ÿåˆ—ä¹Ÿå¯ä»¥ï¼‰çš„å®ŒæˆçŠ¶æ€ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹ dispatch group çš„ä¸€äº›å¸¸è§ç”¨æ³•ï¼š 1234567891011121314151617181920212223// åˆ›å»º dispatch_group_t å¯¹è±¡let group = dispatch_group_create()// åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—let serialQueue = dispatch_queue_create(\"Serial Queue\", DISPATCH_QUEUE_SERIAL)// æäº¤ä¸¤ä¸ª Block ä»»åŠ¡åˆ° serialQueueï¼ŒåŒæ—¶å…³è” serialQueue å’Œ group çš„å…³ç³»dispatch_group_async(group, serialQueue) &#123; print(\"Execute Block1 within Serial Queue\")&#125;dispatch_group_async(group, serialQueue) &#123; print(\"Execute Block2 within Serial Queue\")&#125;// åˆ›å»ºå¹¶å‘é˜Ÿåˆ—ï¼Œå¹¶æäº¤ Block ä»»åŠ¡ï¼ŒåŒæ—¶å…³è”è¯¥å¹¶å‘é˜Ÿåˆ—å’Œ group çš„å…³ç³»dispatch_group_async(group, dispatch_queue_create(\"Concurrent Queue\", DISPATCH_QUEUE_CONCURRENT)) &#123; print(\"Execute Block within Concurrent Queue\")&#125;// ä¸‹é¢çš„ä»£ç åªæœ‰å½“å‰é¢è¢«å…³è”åˆ° group çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆä¹‹åæ‰ä¼šè¢«è§¦å‘dispatch_group_notify(group, dispatch_queue_create(\"Finished\")) &#123; print(\"Finished\")&#125; æ³¨æ„ï¼Œå…³è”åˆ° group çš„æ–¹æ³•åªæœ‰ dispatch_group_async è€Œæ²¡æœ‰ dispatch_group_syncã€‚ ä½†æ˜¯è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬å…³è”ä¸€ä¸ªæ™®é€šçš„ä»»åŠ¡ï¼š 12345678910111213141516// åˆ›å»º dispatch_group_t å¯¹è±¡let group = dispatch_group_create()// ä½¿ç”¨ dispatch_group_enter å’Œ dispatch_group_leave çš„è¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦è°ƒç”¨// dispatch_group_async ä¹Ÿèƒ½å…³è”ä¸€ä¸ªä»»åŠ¡åˆ° group ä¸Šdispatch_group_enter(group)self.executeTask &#123; // æ‰§è¡Œä»£ç  dispatch_group_leave(group)&#125;// ä¸‹é¢çš„ä»£ç åªæœ‰å½“å‰é¢è¢«å…³è”åˆ° group çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆä¹‹åæ‰ä¼šè¢«è§¦å‘dispatch_group_notify(group, dispatch_queue_create(\"Finished\")) &#123; print(\"Finished\")&#125; ä½¿ç”¨ dispatch_group_enter å’Œ dispatch_group_leave çš„æ—¶å€™ï¼Œå®ƒä»¬å¿…é¡»æˆåŒæˆå¯¹å‡ºç°ï¼Œå¦åˆ™ dispatch_group_notify æ˜¯ä¸ä¼šè¢«è°ƒç”¨çš„ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜è¦äº†è§£ä¸€ä¸‹ dispatch_group_waitï¼š 1public func dispatch_group_wait(group: dispatch_group_t, _ timeout: dispatch_time_t) -&gt; Int dispatch_group_wait å¯ä»¥æŒ‡å®šä¸€ä¸ª timeout çš„å‚æ•°ï¼Œå½“ group çš„ä»»åŠ¡æ²¡æœ‰åœ¨è§„å®šçš„æ—¶é—´å†…å®Œæˆï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªéé›¶çš„å€¼ï¼Œå½“ group çš„ä»»åŠ¡èƒ½å¤Ÿåœ¨è§„å®šçš„æ—¶é—´å†…å®Œæˆå°±è¿”å›0ã€‚åŒæ—¶ï¼Œå¤§å®¶è¦æ³¨æ„è¿™ä¸ªæ–¹æ³•ä¼šæŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œæ‰€ä»¥åœ¨ä¸»çº¿ç¨‹çš„æ—¶å€™è¦æ…é‡ä½¿ç”¨è¯¥æ–¹æ³•ã€‚ dispatch_barrier_tæˆ‘ä»¬å…ˆæ¥è¯•æƒ³ä¸€ä¸ªåœºæ™¯ï¼Œå‡å¦‚ç°åœ¨æœ‰å¤šä¸ªçº¿ç¨‹è¦å»è¯»å–ä¸€ä»½æ–‡ä»¶çš„å†…å®¹ï¼ŒåŒæ—¶åˆæœ‰å…¶ä»–çº¿ç¨‹æƒ³è¦å»æ›´æ–°è¯¥æ–‡ä»¶çš„å†…å®¹ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½ä¼šå‘ç”Ÿä½ è¯»é”™æ–‡ä»¶å†…å®¹çš„ç°è±¡ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰è¯»å†™æ“ä½œéƒ½æ”¾åˆ°æˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„ä¸²è¡Œé˜Ÿåˆ—å»æ‰§è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬éƒ½çŸ¥é“åŒæ—¶æœ‰å¤šä¸ªçº¿ç¨‹å»è¯»å–ä¸€ä»½æ–‡ä»¶å†…å®¹æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ ä½¿ç”¨ dispatch barrier å¯ä»¥è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼š 1234567891011121314// åˆ›å»ºæ“ä½œæ–‡ä»¶çš„å¹¶å‘é˜Ÿåˆ—let queue = dispatch_queue_create(\"File\", DISPATCH_QUEUE_CONCURRENT)dispatch_async(queue) &#123; // Read1&#125;dispatch_async(queue) &#123; // Read2&#125;dispatch_barrier_async(queue) &#123; // Write&#125;dispatch_async(queue) &#123; // Read3&#125; é€šè¿‡ dispatch_barrier_async æˆ– dispatch_barrier_sync æäº¤çš„ä»»åŠ¡ä¼šç­‰å¾…å½“å‰é˜Ÿåˆ—é‡Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰ä¼šæ‰§è¡Œï¼Œå¹¶ä¸”å…¶ä»–è¿˜æ²¡æœ‰æ‰§è¡Œçš„ä»»åŠ¡éƒ½å¿…é¡»ç­‰å¾…æäº¤åˆ° dispatch barrier çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰ä¼šå¼€å§‹æ‰§è¡Œã€‚æ‰€ä»¥ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå½“ Write ä»»åŠ¡è¢«æäº¤çš„æ—¶å€™ï¼Œå¦‚æœå½“å‰é˜Ÿåˆ—ä¸­åªæœ‰ Read1 åœ¨æ‰§è¡Œï¼Œé‚£ä¹ˆ Write ä¼šç­‰å¾… Read1 æ‰§è¡Œå®Œæˆä¹‹åæ‰ä¼šæ‰§è¡Œï¼ŒRead2 å’Œ Read3 éƒ½å¿…é¡»ç­‰å¾… Write æ‰§è¡Œå®Œä¹‹åæ‰ä¼šæ‰§è¡Œã€‚å¦å¤–ï¼Œä¸Šé¢çš„ä»£ç ä¸­åˆ›å»ºçš„æ˜¯å¹¶å‘é˜Ÿåˆ—ï¼Œå› ä¸ºå¦‚æœæ˜¯ä¸²è¡Œé˜Ÿåˆ—çš„è¯å°±æ²¡æœ‰å¿…è¦ç”¨ dispatch barrier äº†ã€‚ dispatch_semaphore_tdispatch semaphore æ˜¯ä¸€ä¸ªæ•ˆç‡éå¸¸é«˜çš„ä¼ ç»Ÿè®¡æ•°ä¿¡å·é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å¯ä»¥ç”¨è¿™ä¸ªæ¥æ§åˆ¶æœ€å¤§çš„å¹¶å‘æ•°é‡ã€‚ 1234567891011121314151617// åˆ›å»ºåˆå§‹å€¼ä¸º2çš„ä¿¡å·é‡ï¼Œæœ€å¤§å¹¶å‘æ•°é‡ä¸º2let semaphore = dispatch_semaphore_create(2)// åˆ›å»ºå¹¶å‘é˜Ÿåˆ—let queue = dispatch_queue_create(\"Semaphore\", DISPATCH_QUEUE_CONCURRENT)// åˆ›å»º100ä¸ªå¹¶å‘ä»»åŠ¡for index in 1...100 &#123; // è¿™ä¸ªæ–¹æ³•ä¼šè¿›è¡Œä¿¡å·é‡å‡1çš„æ“ä½œï¼Œå¹¶ä¸”å¦‚æœä¿¡å·é‡å‡1ä¹‹åçš„ç»“æœå°äº0çš„è¯ï¼Œè¯¥æ–¹æ³•ä¼šé€ æˆçº¿ç¨‹çš„æŒ‚èµ·ç›´ // åˆ°è¯¥ä¿¡å·é‡è¿›è¡ŒåŠ 1æ“ä½œæ‰ä¼šæ¢å¤ï¼Œæ‰€ä»¥åœ¨ä¸»çº¿ç¨‹è¦æ³¨æ„è¯¥æ–¹æ³•çš„ä½¿ç”¨ã€‚ // æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•è¦æ”¾åœ¨ dispatch_async å¤–é¢ï¼Œå¦åˆ™ç³»ç»Ÿä¾æ—§ä¼šåˆ›å»ºè¶…è¿‡2ä¸ªçº¿ç¨‹åŒæ—¶æ¥å¤„ç†è¯¥è°ƒåº¦é˜Ÿåˆ— // çš„ä»»åŠ¡ dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER) dispatch_async(queue) &#123; // é‡Šæ”¾èµ„æºï¼Œä¿¡å·é‡å¢åŠ 1 dispatch_semaphore_signal(semaphore) &#125;&#125; å…¶ä»–GCD åœ¨ Swift3 çš„è¯­æ³•è·Ÿç°åœ¨çš„è¯­æ³•ä¸å¤ªä¸€æ ·äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡Œå»äº†è§£ã€‚åœ¨æœªæ¥å¯èƒ½ä¼šè€ƒè™‘æŠŠæœ¬æ–‡ç« çš„ä»£ç éƒ½ç”¨ Swift3 çš„è¯­æ³•æ¥é‡æ–°å†™ä¸€ä¸‹ã€‚","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://hparis.github.io/blog/categories/æŠ€æœ¯/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://hparis.github.io/blog/tags/iOS/"},{"name":"GCD","slug":"GCD","permalink":"https://hparis.github.io/blog/tags/GCD/"}]},{"title":"Vim Tip","slug":"Vim-Tip","date":"2017-09-05T15:30:56.000Z","updated":"2018-03-23T08:43:06.334Z","comments":true,"path":"2017/09/05/Vim-Tip/","link":"","permalink":"https://hparis.github.io/blog/2017/09/05/Vim-Tip/","excerpt":"","text":"1ã€æ›¿æ¢ç¬¬n1è¡Œåˆ°ç¬¬n2è¡Œçš„å†…å®¹1:n1,n2/origin/replace/g 2ã€æ›¿æ¢æ•´ä¸ªæ–‡ä»¶çš„å†…å®¹1:%s/origin/replace/g 3ã€ç§»åŠ¨n1-n2è¡Œ(åŒ…æ‹¬n1,n2)åˆ°n3è¡Œä¹‹ä¸‹1n1,n2 m n3 4ã€å¤åˆ¶n1-n2è¡Œ(åŒ…æ‹¬n1,n2)åˆ°n3è¡Œä¹‹ä¸‹1:n1,n2 co n3 5ã€åˆ é™¤æ–‡ä»¶çš„ç©ºè¡Œ1:g/^$/d 6ã€åœ¨æ–‡æœ¬ä¸­æ’å…¥ä¸€ä¸ª1åˆ°100çš„åºåˆ—ï¼ˆæ¥è‡ªæ± è€å¸ˆã€Šè¯´ï¼Œè°æ‰æ˜¯æœ€å¸…çš„ç¼–ç¨‹å·¥å…·ï¼Ÿã€‹ï¼‰1:r!seq 100 7ã€åœ¨å½“å‰çš„æ¯ä¸€è¡Œæ–‡å­—å‰é¢å¢åŠ â€œåºå·. â€ï¼ˆæ¥è‡ªæ± è€å¸ˆã€Šè¯´ï¼Œè°æ‰æ˜¯æœ€å¸…çš„ç¼–ç¨‹å·¥å…·ï¼Ÿã€‹ï¼‰1:let i=1 | g /^/ s//\\=i.\". \"/ | let i+=1 8ã€å½“å‰ç›®å½•ä¸‹ï¼ˆåŒ…æ‹¬å­æ–‡ä»¶å¤¹ï¼‰æ‰€æœ‰åç¼€ä¸º java çš„æ–‡ä»¶ä¸­çš„ apache æ›¿æ¢æˆ eclipseï¼Œé‚£ä¹ˆåœ¨å½“å‰ç›®å½•ä¸‹ä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼šï¼ˆæ¥è‡ªæ± è€å¸ˆã€Šè¯´ï¼Œè°æ‰æ˜¯æœ€å¸…çš„ç¼–ç¨‹å·¥å…·ï¼Ÿã€‹ï¼‰123vim:n **/*.java:argdo %s/apache/eclipse/ge | update","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://hparis.github.io/blog/categories/æŠ€æœ¯/"}],"tags":[{"name":"tip","slug":"tip","permalink":"https://hparis.github.io/blog/tags/tip/"}]},{"title":"include å’Œ import çš„åŒºåˆ«","slug":"includeå’Œimportçš„åŒºåˆ«","date":"2017-09-05T15:30:56.000Z","updated":"2018-03-23T08:42:11.229Z","comments":true,"path":"2017/09/05/includeå’Œimportçš„åŒºåˆ«/","link":"","permalink":"https://hparis.github.io/blog/2017/09/05/includeå’Œimportçš„åŒºåˆ«/","excerpt":"","text":"ä»Šå¤©æˆ‘ä»¬æ¥äº†è§£ä¸‹é¢è¿™å‡ ç§åŒ…å«æ–‡ä»¶çš„æ–¹å¼æœ‰ä»€ä¹ˆç‰¹ç‚¹å’ŒåŒºåˆ«ï¼š 12345#include \"fiel\"#include &lt;file&gt;#import \"file\"#import &lt;file&gt;@import Module ä¸€ã€#includeå­¦è¿‡ C è¯­è¨€çš„äººéƒ½çŸ¥é“ï¼Œ#include å…¶å®æ˜¯ä¸€ä¸ªé¢„å¤„ç†å‘½ä»¤ã€‚å®ƒä¼šåœ¨é¢„å¤„ç†çš„æ—¶å€™ç®€å•çš„æŠŠè¢« #include åŒ…å«çš„æ–‡ä»¶å†…å®¹è¿›è¡Œå¤åˆ¶ç²˜è´´ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼š 1234// A.hvoid sampleA() &#123; // A code&#125; 123456// B.h#include \"A.h\"void sampleB() &#123; // B code&#125; æˆ‘ä»¬ä½¿ç”¨ gcc -E B.h å‘½ä»¤æ¥çœ‹çœ‹ç»è¿‡é¢„å¤„ç†åçš„æ–‡ä»¶å†…å®¹å¤§æ¦‚å¦‚ä¸‹ï¼š 12345678910111213141516# 1 \"B.h\"# 1 \"&lt;built-in&gt;\" 1# 1 \"&lt;built-in&gt;\" 3# 329 \"&lt;built-in&gt;\" 3# 1 \"&lt;command line&gt;\" 1# 1 \"&lt;built-in&gt;\" 2# 1 \"B.h\" 2# 1 \"./A.h\" 1void sampleA() &#123;&#125;# 2 \"B.h\" 2void sampleB() &#123;&#125; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»è¿‡é¢„å¤„ç†ä¹‹åï¼ŒA.h æ–‡ä»¶ä¸­çš„å†…å®¹è¢«ç›´æ¥å¤åˆ¶å¹¶ç²˜è´´åˆ° B.h æ–‡ä»¶ä¸­æ¥ã€‚å¦‚æœæˆ‘ä»¬åœ¨ B.h æ–‡ä»¶ä¸­å¤šæ¬¡åŒ…å«äº† A.h æ–‡ä»¶ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿæ¯”å¦‚ï¼š 1234// A.hvoid sampleA() &#123; // A code&#125; 1234567// B.h#include \"A.h\"#include \"A.h\"void sampleB() &#123; // B code&#125; ç»è¿‡é¢„å¤„ç†ä¹‹åçš„å†…å®¹å¤§æ¦‚å¦‚ä¸‹ï¼š 123456789101112131415161718192021# 1 \"B.h\"# 1 \"&lt;built-in&gt;\" 1# 1 \"&lt;built-in&gt;\" 3# 329 \"&lt;built-in&gt;\" 3# 1 \"&lt;command line&gt;\" 1# 1 \"&lt;built-in&gt;\" 2# 1 \"B.h\" 2# 1 \"./A.h\" 1void sampleA() &#123;&#125;# 2 \"B.h\" 2# 1 \"./A.h\" 1void sampleA() &#123;&#125;# 3 \"B.h\" 2void sampleB() &#123;&#125; A.h æ–‡ä»¶ä¸­çš„ sampleA() å‡½æ•°å‡ºç°äº†ä¸¤æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ©ç”¨å…¶ä»–çš„ä¸€äº›é¢„å¤„ç†å‘½ä»¤æ¥è§„é¿è¿™ç§æƒ…å†µï¼Œçœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼š 12345678// A.h#ifndef FILE_A#define FILE_Avoid sampleA() &#123; // A code&#125;#endif 1234567// B.h#include \"A.h\"#include \"A.h\"void sampleB() &#123; // B code&#125; æˆ‘ä»¬å†æ¥çœ‹çœ‹å¢åŠ äº†è¿™äº›é¢„å¤„ç†å‘½ä»¤ä¹‹åçš„é¢„å¤„ç†æ–‡ä»¶å†…å®¹ï¼š 1234567891011121314151617181920# 1 \"B.h\"# 1 \"&lt;built-in&gt;\" 1# 1 \"&lt;built-in&gt;\" 3# 329 \"&lt;built-in&gt;\" 3# 1 \"&lt;command line&gt;\" 1# 1 \"&lt;built-in&gt;\" 2# 1 \"B.h\" 2# 1 \"./A.h\" 1void sampleA() &#123;&#125;# 2 \"B.h\" 2void sampleB() &#123;&#125; OKï¼Œè¿™å°±æ­£å¸¸äº†ã€‚å¦‚æœæˆ‘ä»¬åœ¨ A.h ä¸­åŒ…å« B.hï¼Œç„¶ååˆåœ¨ B.h ä¸­åŒ…å« A.hï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š 1234567// A.h#include \"B.h\"void sampleA() &#123; // A code&#125;#endif 123456// B.h#include &quot;A.h&quot;void sampleB() &#123; // B code&#125; æˆ‘ä»¬å†æ¥çœ‹çœ‹ç»è¿‡ gcc -E B.h å¤„ç†ä¹‹åçš„æ–‡ä»¶å†…å®¹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364# 1 \"B.h\"# 1 \"&lt;built-in&gt;\" 1# 1 \"&lt;built-in&gt;\" 3# 329 \"&lt;built-in&gt;\" 3# 1 \"&lt;command line&gt;\" 1# 1 \"&lt;built-in&gt;\" 2# 1 \"B.h\" 2# 1 \"./A.h\" 1# 1 \"./B.h\" 1# 1 \"./A.h\" 1# 1 \"./B.h\" 1......# 1 \"./A.h\" 1# 1 \"./B.h\" 1In file included from ./B.h:1:In file included from ./A.h:1:In file included from ./B.h:1:In file included from ./A.h:1:......In file included from ./B.h:1:In file included from ./A.h:1:./A.h:1:10: error: #include nested too deeply#include \"B.h\" ^void sampleA() &#123;&#125;# 2 \"./B.h\" 2void sampleB() &#123;&#125;# 2 \"./A.h\" 2void sampleA() &#123;&#125;# 2 \"./B.h\" 2void sampleB() &#123;&#125;# 2 \"./A.h\" 2void sampleA() &#123;&#125;......# 2 \"./A.h\" 2void sampleA() &#123;&#125;# 2 \"./B.h\" 2void sampleB() &#123;&#125;1 error generated. æˆ‘ä»¬å‘ç° A.h å’Œ B.h é‡å¤å‡ºç°ï¼Œè¿™æ˜¯å› ä¸ºè¿™ä¸ªæ—¶å€™ A.h å’Œ B.h æ–‡ä»¶äº’ç›¸å¼•ç”¨å¯¼è‡´çš„ã€‚ä»ç†è®ºä¸Šæ¥è®²ï¼Œè¿™ä¸ªæ—¶å€™ä¼šæ— é™å¾ªç¯ä¸‹å»ï¼Œç›´è‡³ä¸–ç•Œç»ˆç»“ã€‚åœ¨è¿™é‡Œæœ€åä¼šå‡ºç°ä¸€å¥ 1 error generated.çš„æç¤ºæ˜¯ gcc å¼ºè¡Œä¸­æ–­äº†è¿™ä¸ªé¢„å¤„ç†çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰èƒ½çœ‹åˆ°è¿™æ ·çš„ç»“æœã€‚é‚£æˆ‘ä»¬å¯ä»¥æ€ä¹ˆåšï¼Ÿå½“ç„¶æ˜¯åˆ©ç”¨å‰é¢è¯´çš„é¢„å¤„ç†å‘½ä»¤æ¥é¿å…å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚çœ‹ä¸‹é¢çš„ä»£ç ï¼š 12345678910// A.h#ifndef FILE_A#define FILE_A#include \"B.h\"void sampleA() &#123; // A code&#125;#endif 12345678910// B.h#ifndef FILE_B#define FILE_B#include \"A.h\"void sampleB() &#123; // B code&#125;#endif è¿™ä¸ªæ—¶å€™ä½¿ç”¨ gcc -E B.h å°±å¯ä»¥æ­£å¸¸çš„è¿›è¡Œé¢„å¤„ç†ï¼Œæœ€åçš„ç»“æœå¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425# 1 \"B.h\"# 1 \"&lt;built-in&gt;\" 1# 1 \"&lt;built-in&gt;\" 3# 329 \"&lt;built-in&gt;\" 3# 1 \"&lt;command line&gt;\" 1# 1 \"&lt;built-in&gt;\" 2# 1 \"B.h\" 2# 1 \"./A.h\" 1# 1 \"./B.h\" 1# 5 \"./A.h\" 2void sampleA() &#123;&#125;# 5 \"./B.h\" 2void sampleB() &#123;&#125; æ‰€ä»¥Cç¨‹åºå‘˜æ€»æ˜¯éœ€è¦é€šè¿‡å„ç§æ‰‹æ®µï¼ˆæ¯”å¦‚ï¼š#pragma onceï¼‰æ¥é˜²èŒƒæ­¤ç±»äº‹ä»¶çš„å‘ç”Ÿã€‚ äºŒã€#importæˆ‘ä»¬åœ¨æ–‡ä»¶ä¸­é€šè¿‡#importæ¥å¯¼å…¥ iAd Frameworkï¼š ç¼–è¯‘æŠ¥é”™ï¼š éœ€è¦é‡æ–°å¯¼å…¥å’Œé“¾æ¥ Frameworkï¼š ç¼–è¯‘æˆåŠŸï¼š ä»ä¸Šé¢çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å°±çŸ¥é“åœ¨ Objective-C é¡¹ç›®ä¸­ä½¿ç”¨ #import éœ€è¦æ³¨æ„å¯¼å…¥å’Œé“¾æ¥ Frameworkï¼Œå¦åˆ™æ˜¯ä¼šæŠ¥é”™çš„ã€‚ é¢„å¤„ç†å™¨åœ¨ç¢°åˆ° #import å‘½ä»¤çš„æ—¶å€™ï¼Œå®ƒä¼šé‡‡ç”¨é€’å½’çš„æ–¹å¼æŠŠè¢«æ‰€æœ‰å¤´æ–‡ä»¶çš„å†…å®¹å¤åˆ¶å¹¶ç²˜è´´åˆ°å½“å‰æ–‡ä»¶ä¸­ï¼Œå¦‚æœæ–‡ä»¶ä¾èµ–å±‚æ¬¡æ¯”è¾ƒæ·±å°±ä¼šé€ æˆé¢„å¤„ç†åçš„æ–‡ä»¶å†…å®¹ä½“ç§¯å¤§å¹…åº¦å˜å¤§ã€‚ æ¯”å¦‚å¯¼å…¥ UIKit çš„æ—¶å€™åªéœ€è¦ä¸€è¡Œä»£ç ï¼š 1#import &lt;UIKit/UIKit.h&gt; é¢„å¤„ç†ä¹‹åä¼šå˜æˆ200å¤šè¡Œï¼ˆUIKit.h æ–‡ä»¶æœ‰200å¤šè¡Œä»£ç ï¼‰ï¼š 1234567#import &lt;UIKit/UIKitDefines.h&gt;#if __has_include(&lt;UIKit/UIAccelerometer.h&gt;)#import &lt;UIKit/UIAccelerometer.h&gt;.....#import &lt;UIKit/UIRegion.h&gt;#endif æ¥ä¸‹æ¥è¿˜éœ€è¦é€’å½’çš„æŠŠæ¯ä¸ªå¤´æ–‡ä»¶çš„å†…å®¹å±•å¼€ï¼Œæœ€åçš„ç»“æœå°±æ˜¯ä¸€è¡Œä»£ç å˜æˆè¶…è¿‡11000è¡Œä»£ç ã€‚å¦‚æœæœ‰å¤šä¸ªæ–‡ä»¶éƒ½åŒ…å«æ¥ UIKit çš„å¤´æ–‡ä»¶ï¼Œè¿™æ ·å°±ä¼šè®©æ¯ä¸ªæ–‡ä»¶çš„ä½“ç§¯éƒ½ä¼šå˜å¾—å¾ˆå¤§ï¼Œç¼–è¯‘è¿‡ç¨‹ä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šæ…¢ã€‚è¿™ç§é€’å½’çš„æ–¹å¼ä¼šè®©é¡¹ç›®çš„ç¼–è¯‘æ—¶é—´å˜æˆï¼šM source files + N headers =&gt; M x N compile timeã€‚ æ‰€ä»¥è¿™ä¸ªæ—¶å€™æœ‰ä¸€ä¸ªä¼˜åŒ–æ–¹æ³•å°±æ˜¯æŠŠé¡¹ç›®ä¸­é¢‘ç¹è¢«å¼•ç”¨çš„æ–‡ä»¶æ”¾åˆ° PCHï¼ˆPre-Compile Headerï¼‰æ–‡ä»¶ä¸­ã€‚PCH ä¼šè¢«ç¼–è¯‘ä¸€æ¬¡å¹¶ä¸”ä¼šè¢«ç¼“å­˜ï¼Œè¿™å°±å¯ä»¥ç¼©çŸ­ç¼–è¯‘æ—¶é—´ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦åœ¨ä¸åŒçš„æ–‡ä»¶é‡Œé¢æ·»åŠ importè¯­æ³•ã€‚ å½“ç„¶ï¼ŒPCH ä¹Ÿæœ‰è‡ªå·±çš„ç¼ºç‚¹ï¼š ç»´æŠ¤è´Ÿæ‹…ï¼šéšç€é¡¹ç›®å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œæˆ‘ä»¬å°±ä¼šä¸åœçš„å¾€PCHæ–‡ä»¶åŠ å…¥å†…å®¹ï¼Œå†…å®¹ä¸€æ—¦å˜å¤šå°±ä¼šå˜å¾—ä¸å¥½ç»´æŠ¤ã€‚ï¼ˆè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¹³å¸¸åœ¨é¡¹ç›®ä¸­è¦é¿å…åœ¨ ViewController åšå¤ªå¤šäº‹æƒ…çš„ï¼Œè¦ç ”ç©¶ MVVMçš„ç¼˜æ•…ã€‚ï¼‰ å‘½åç©ºé—´æ±¡æŸ“ æœ€åï¼Œç»™å¤§å®¶æä¾›ä¸€ä¸ªä¾‹å­çœ‹çœ‹ #import ç¼–è¯‘å‡ºæ¥ä¹‹åçš„æ–‡ä»¶å†…å®¹ï¼š 1234567// A.h#import \"B.h\" void sampleA() &#123; // A code&#125;#endif 1234567// B.h#import \"A.h\"#import \"A.h\"void sampleB() &#123; // B code&#125; ä½¿ç”¨ gcc -E B.h è¿›è¡Œé¢„å¤„ç†ä¹‹åçš„å†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516171819# 1 \"B.h\"# 1 \"&lt;built-in&gt;\" 1# 1 \"&lt;built-in&gt;\" 3# 329 \"&lt;built-in&gt;\" 3# 1 \"&lt;command line&gt;\" 1# 1 \"&lt;built-in&gt;\" 2# 1 \"B.h\" 2# 1 \"./A.h\" 1void sampleA() &#123;&#125;# 2 \"./B.h\" 2void sampleB() &#123;&#125; æˆ‘ä»¬åœ¨B.hä¸­æœ‰ä¸¤ä¸ª #import â€œA.hâ€ï¼Œä½†æ˜¯è¿™äº›å†…å®¹è·Ÿæˆ‘ä»¬ä¹‹å‰åœ¨ A.h å’Œ B.h æ–‡ä»¶ä¸­ä½¿ç”¨ #include å’Œå…¶ä»–é¢„å¤„ç†å‘½ä»¤ä¹‹åçš„å¤„ç†ç»“æœå¾ˆç›¸ä¼¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ˜ç™½äº† #import å¤§æ¦‚åšäº†ä»€ä¹ˆäº‹ã€‚ ä¸‰ã€@importåœ¨2012å¹´çš„ LLVM å¤§ä¼šä¸Šï¼Œè‹¹æœçš„ Doug Gregor é¦–æ¬¡æå‡ºäº† Objective-C ä¸­çš„ Moduleã€‚ä½¿ç”¨ @import æ–¹å¼å¯¼å…¥æœ‰å‡ ä¸ªå¥½å¤„ï¼š ä¸éœ€è¦åƒ #import ä¸€æ ·å¾—æ‰‹åŠ¨å»é“¾æ¥ Frameworkï¼Œ@importä¼šè‡ªåŠ¨å»é“¾æ¥ @import å·¥ä½œæ–¹å¼å’Œ PCH å¾ˆåƒï¼Œä½†æ˜¯ @import è¦æ¯” PCH çš„æ•ˆç‡é«˜å‡ºè®¸å¤š @import å¯¼å…¥ Modul ä¼˜åŒ–æ–‡ä»¶ä½“ç§¯å˜å¤§ã€ç¼–è¯‘é€Ÿåº¦å˜æ…¢çš„é—®é¢˜ å¯ä»¥éƒ¨åˆ†å¯¼å…¥ï¼ˆ@import Framework.Aï¼‰æˆ–å…¨éƒ¨å¯¼å…¥ï¼ˆ@import Frameworkï¼‰ æ‰€ä»¥ï¼Œå»ºè®®å¤§å®¶å°½é‡ä½¿ç”¨ @import æ¥å¯¼å…¥æ–‡ä»¶ã€‚å¦‚æœä½ ä»¥å‰çš„é¡¹ç›®ç”¨çš„æ˜¯ #importï¼Œé‚£ä¹ˆä½ ä¹Ÿä¸éœ€è¦æ‹…å¿ƒï¼Œæˆ‘ä»¬åªé€šè¿‡ Build Settings å¼€å¯ Modules é€‰é¡¹ï¼ˆçœ‹ä¸‹å›¾ï¼‰ï¼Œ#import å’Œ #include ä¼šè‡ªåŠ¨è¢«æ˜ å°„æˆ @importï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦æ›´æ”¹åŸæ¥çš„ä»£ç ä¹Ÿèƒ½äº«å— @importå¸¦æ¥çš„å¥½å¤„ã€‚ è¯¦ç»†å†…å®¹å¯ä»¥çœ‹çœ‹è‹¹æœ2013å¹´çš„ Advances in Objective-Cï¼Œé‡Œé¢å°±è¯¦ç»†ä»‹ç»äº† Moduleã€‚ å››ã€æ–‡ä»¶è·¯å¾„æ¥ä¸‹æ¥æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ #include å’Œ #include â€œfileâ€ï¼š #include \\: è¡¨ç¤ºç¼–è¯‘å™¨ä¼šç›´æ¥åˆ°ç³»ç»Ÿè®¾å®šçš„ç›®å½•ä¸‹å¯»æ‰¾æŒ‡å®šçš„æ–‡ä»¶ã€‚ #include â€œfileâ€: è¡¨ç¤ºç¼–è¯‘å™¨ä¼šåˆ°å½“å‰çš„ç›®å½•ä¸‹å¯»æ‰¾æŒ‡å®šçš„æ–‡ä»¶ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™ä¼šå»ç³»ç»Ÿè®¾å®šçš„ç›®å½•ä¸‹å¯»æ‰¾æŒ‡å®šçš„æ–‡ä»¶ã€‚ å‚è€ƒæ–‡çŒ®ï¼š https://gcc.gnu.org/onlinedocs/cpp/Include-Syntax.html http://stackoverflow.com/questions/18947516/import-vs-import-ios-7 https://www.raywenderlich.com/49850/whats-new-in-objective-c-and-foundation-in-ios-7","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://hparis.github.io/blog/categories/æŠ€æœ¯/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://hparis.github.io/blog/tags/iOS/"}]},{"title":"RAC å’Œå†…å­˜ç®¡ç†","slug":"RACå’Œå†…å­˜ç®¡ç†","date":"2017-09-05T15:30:56.000Z","updated":"2018-03-23T08:43:22.223Z","comments":true,"path":"2017/09/05/RACå’Œå†…å­˜ç®¡ç†/","link":"","permalink":"https://hparis.github.io/blog/2017/09/05/RACå’Œå†…å­˜ç®¡ç†/","excerpt":"","text":"æœ€è¿‘åœ¨ç”¨ RAC çš„æ—¶å€™å‘ç°è‡ªå·±å¯¹å†…å­˜ç®¡ç†è¿˜æ˜¯æœ‰äº›å›°æƒ‘ï¼Œäºæ˜¯è‡ªå·±å†™äº†ä¸€äº›ä»£ç æ¥éªŒè¯è‡ªå·±çš„ä¸€äº›ç†è§£ã€‚åœ¨ä¸€å¼€å§‹æ¥è§¦ RAC çš„æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“ RAC å¯¹äº block éƒ½æ˜¯ copy èµ‹å€¼çš„ã€‚ 1234567@implementation RACSignal#pragma mark Lifecycle+ (RACSignal *)createSignal:(RACDisposable * (^)(id&lt;RACSubscriber&gt; subscriber))didSubscribe &#123; return [RACDynamicSignal createSignal:didSubscribe];&#125; 123456789@implementation RACDynamicSignal#pragma mark Lifecycle+ (RACSignal *)createSignal:(RACDisposable * (^)(id&lt;RACSubscriber&gt; subscriber))didSubscribe &#123; RACDynamicSignal *signal = [[self alloc] init]; signal-&gt;_didSubscribe = [didSubscribe copy]; return [signal setNameWithFormat:@\"+createSignal:\"];&#125; åœ¨åˆ›å»º RACSingal çš„æ—¶å€™ä¼šè°ƒç”¨å…¶å­ç±» RACDynamicSignal å»åˆ›å»ºï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ° RACDynamicSignal å¯¹ didSuscribe è¿™ä¸ª block æ˜¯è¿›è¡Œäº† copyã€‚æ‰€ä»¥å¤§å®¶å¯èƒ½ä¼šè¢«è¦æ±‚æ³¨æ„å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œäºæ˜¯å¤§å®¶éƒ½ç”¨ @weakify(target) å’Œ @strongify(target) æ¥é¿å…å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚é‚£æ˜¯ä¸æ˜¯æ‰€æœ‰ç”¨åˆ° RAC çš„åœ°æ–¹éƒ½éœ€è¦ä½¿ç”¨è¿™äº›å®æ¥é¿å…å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œä¸å°½ç„¶ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªï¼š 1234// åœºæ™¯1[RACObserve(self, title) subscribeNext:^(id x) &#123; NSLog(@\"%@\", x);&#125;]; æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å¯¹æ¯”ä»¥ä¸‹çš„å‡ ç§ç”¨æ³•ï¼š 12345678910111213141516171819202122232425262728@interface ViewController()@property (strong, nonatomic) ViewModel * viewModel;@end@implementation ViewController- (void)viewDidiLoad &#123; [super viewDidLoad]; self.viewModel = [ViewModel new]; // åœºæ™¯2 dispatch_async(dispatch_get_main_queue(), ^&#123; self.title = @\"ä½ å¥½\"; &#125;); // åœºæ™¯3 [self.viewModel.titleSignal subscribeNext:^(NSString * title) &#123; self.title = title; &#125;]; // åœºæ™¯4 [RACObserve(self.viewModel, title) subscribeNext:^(NSString * title) &#123; self.title = title; &#125;]; &#125;@end åœºæ™¯2æ˜¯æˆ‘ä»¬å¹³å¸¸éƒ½ä¼šç”¨åˆ°çš„ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿæ²¡æœ‰åœ¨è¿™ç§åœºæ™¯ä¸‹å»è€ƒè™‘å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸º dispatch çš„ block ä¸æ˜¯å±äº self çš„ï¼ˆè‡³äºè¿™ä¸ª block æ˜¯å±äºè°çš„ï¼Œå›å¤´æˆ‘å†æŸ¥ç‚¹èµ„æ–™æˆ–è€…è¯·å„ä½æŒ‡æ•™ï¼‰ï¼Œæ‰€ä»¥å³ä½¿ä½ åœ¨ block ä½¿ç”¨äº† self ä¹Ÿä¸ä¼šæœ‰å¾ªç¯åº”ç”¨çš„é—®é¢˜ã€‚ åœºæ™¯3å¾ˆæ˜æ˜¾æ˜¯æœ‰å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼šself-&gt;viewModel-&gt;titleSignal-&gt;block-&gt;selfï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬ä¸åšå¤„ç†çš„è¯ï¼Œé‚£ä¹ˆ self å°±æ°¸è¿œä¸ä¼šè¢«é‡Šæ”¾ã€‚æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ä½¿ç”¨ @weakify(self) å’Œ @strongify(self)ï¼š 123456// åœºæ™¯3@weakify(self);[self.viewModel.titleSignal subscribeNext:^(NSString * title) &#123; @strongify(self); self.title = title;&#125;]; åœºæ™¯4åœ¨æˆ‘ä»¬çœ‹æ¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºè¿™é‡Œçœ‹èµ·æ¥åªæœ‰ singal-&gt;block-&gt;self çš„å¼•ç”¨ï¼Œå®ƒä»¬ä¹‹é—´å¹¶æ²¡æœ‰é€ æˆå¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ RACObserve çš„å®ç°ï¼š 12345678910#define RACObserve(TARGET, KEYPATH) \\(&#123; \\_Pragma(\"clang diagnostic push\") \\_Pragma(\"clang diagnostic ignored \\\"-Wreceiver-is-weak\\\"\") \\__weak id target_ = (TARGET); \\[target_ rac_valuesForKeyPath:@keypath(TARGET, KEYPATH) observer:self]; \\_Pragma(\"clang diagnostic pop\") \\&#125;)- (RACSignal *)rac_valuesForKeyPath:(NSString *)keyPath observer:(__weak NSObject *)observer; å…¶å®ï¼Œçœ‹åˆ°è¿™é‡Œä½ ä¼šè®¤ä¸ºè¿™é‡Œåªæ˜¯è°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª Signalï¼Œè€Œä¸”è¿™ä¸ª Signal ä¹Ÿå¹¶ä¸å±äºä»»ä½•å¯¹è±¡ã€‚æˆ‘ä»¬å†æ¥çœ‹çœ‹å…·ä½“çš„å®ç°æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ 1234567891011121314151617181920212223242526272829303132333435363738394041424344- (RACSignal *)rac_valuesAndChangesForKeyPath:(NSString *)keyPath options:(NSKeyValueObservingOptions)options observer:(__weak NSObject *)weakObserver &#123; NSObject *strongObserver = weakObserver; keyPath = [keyPath copy]; NSRecursiveLock *objectLock = [[NSRecursiveLock alloc] init]; objectLock.name = @\"org.reactivecocoa.ReactiveCocoa.NSObjectRACPropertySubscribing\"; __weak NSObject *weakSelf = self; RACSignal *deallocSignal = [[RACSignal zip:@[ self.rac_willDeallocSignal, strongObserver.rac_willDeallocSignal ?: [RACSignal never] ]] doCompleted:^&#123; // Forces deallocation to wait if the object variables are currently // being read on another thread. [objectLock lock]; @onExit &#123; [objectLock unlock]; &#125;; &#125;]; return [[[RACSignal createSignal:^ RACDisposable * (id&lt;RACSubscriber&gt; subscriber) &#123; // Hold onto the lock the whole time we're setting up the KVO // observation, because any resurrection that might be caused by our // retaining below must be balanced out by the time -dealloc returns // (if another thread is waiting on the lock above). [objectLock lock]; @onExit &#123; [objectLock unlock]; &#125;; __strong NSObject *observer __attribute__((objc_precise_lifetime)) = weakObserver; __strong NSObject *self __attribute__((objc_precise_lifetime)) = weakSelf; if (self == nil) &#123; [subscriber sendCompleted]; return nil; &#125; return [self rac_observeKeyPath:keyPath options:options observer:observer block:^(id value, NSDictionary *change, BOOL causedByDealloc, BOOL affectedOnlyLastComponent) &#123; [subscriber sendNext:RACTuplePack(value, change)]; &#125;]; &#125;] takeUntil:deallocSignal] setNameWithFormat:@\"%@ -rac_valueAndChangesForKeyPath: %@ options: %lu observer: %@\", self.rac_description, keyPath, (unsigned long)options, strongObserver.rac_description];&#125; é‡ç‚¹è§‚å¯Ÿ deallocSignal å’Œ [signal takeUntile:deallocSignal]ï¼Œæˆ‘ä»¬æŠŠ deallocSignal å•ç‹¬æ‹¿å‡ºæ¥çœ‹çœ‹ï¼š 1234567891011RACSignal *deallocSignal = [[RACSignal zip:@[ self.rac_willDeallocSignal, strongObserver.rac_willDeallocSignal ?: [RACSignal never] ]] doCompleted:^&#123; // Forces deallocation to wait if the object variables are currently // being read on another thread. [objectLock lock]; @onExit &#123; [objectLock unlock]; &#125;;&#125;]; è¿™é‡Œçš„ deallocSignal æ˜¯åªæœ‰åœ¨ self å’Œ strongObserve éƒ½å°†è¦å‘ç”Ÿ dealloc çš„æ—¶å€™æ‰ä¼šè§¦å‘çš„ã€‚å³ç”¨ RACObserve åˆ›å»ºçš„ä¿¡å·åªæœ‰åœ¨å…¶ target å’Œ observe éƒ½å‘ç”Ÿ dealloc çš„æ—¶å€™æ‰ä¼šè¢« disposable (è¿™ä¸ªå¥½åƒæ˜¯ RAC ç”¨æ¥é”€æ¯è‡ªå·±èµ„æºçš„ä¸œè¥¿)ã€‚ä¸æ˜ç™½çš„ç«¥é‹ï¼Œæˆ‘ä»¬å›å¤´æ¥åˆ†æä¸€ä¸‹åœºæ™¯4çš„ä»£ç ï¼š 1234// åœºæ™¯4[RACObserve(self.viewModel, title) subscribeNext:^(NSString * title) &#123; self.title = title;&#125;]; ç”¨ RACObserve åˆ›å»ºçš„ä¿¡å·çœ‹èµ·æ¥åªè¦å‡ºäº†å‡½æ•°ä½“å…¶èµ„æºåº”è¯¥å°±ä¼šè¢«å›æ”¶ï¼Œä½†æ˜¯è¿™ä¸ªä¿¡å·å…¶å®æ˜¯åªæœ‰åœ¨ self.viewModel.rac_willDeallocSignal å’Œ self.rac_willDeallocSignal éƒ½å‘ç”Ÿçš„æƒ…å†µä¸‹æ‰ä¼šè¢«é‡Šæ”¾ã€‚æ‰€ä»¥åœºæ™¯4çš„å¼•ç”¨å…³ç³»çœ‹èµ·æ¥åªæœ‰ signal-&gt;block-&gt;selfï¼Œä½†æ˜¯è¿™ä¸ª signal åªæœ‰åœ¨ self.rac_willDeallocSignal çš„æ—¶å€™æ‰ä¼šè¢«é‡Šæ”¾ã€‚æ‰€ä»¥è¿™é‡Œå¦‚æœä¸æ‰“æ–­è¿™ç§å…³ç³»çš„è¯å°±ä¼šé€ æˆå¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œæ­£ç¡®åšæ³•åº”è¯¥æ˜¯ï¼š 123456// åœºæ™¯4@weakify(self);[RACObserve(self.viewModel, title) subscribeNext:^(NSString * title) &#123; @strongify(self); self.title = title;&#125;]; æœ€åï¼Œåœ¨è¯´ä¸€ä¸ªç‰¹åˆ«éœ€è¦æ³¨æ„çš„ï¼Œå°±æ˜¯ UITableViewCell å’Œ UICollectionViewCell å¤ç”¨å’Œ RAC çš„é—®é¢˜ã€‚ 123456789101112131415- (NSInteger)tableView:(nonnull UITableView *)tableView numberOfRowsInSection:(NSInteger)section &#123; return 1000;&#125;- (UITableViewCell *)tableView:(nonnull UITableView *)tableView cellForRowAtIndexPath:(nonnull NSIndexPath *)indexPath &#123; UITableViewCell * cell = [tableView dequeueReusableCellWithIdentifier:@\"TableViewCell\"]; @weakify(self); [RACObserve(cell.textLabel, text) subscribeNext:^(id x) &#123; @strongify(self); NSLog(@\"%@\", self); &#125;]; return cell;&#125; æˆ‘ä»¬çœ‹åˆ°è¿™é‡Œçš„ RACObserve åˆ›å»ºçš„ Signal å’Œ self ä¹‹é—´å·²ç»å»æ‰äº†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„ã€‚ä½†æ˜¯ç»“åˆä¹‹å‰æˆ‘ä»¬å¯¹ RACObserve çš„ç†è§£å†ä»”ç»†åˆ†æä¸€ä¸‹ï¼Œè¿™é‡Œçš„ Signal åªè¦ self æ²¡æœ‰è¢« dealloc çš„è¯å°±ä¸ä¼šè¢«é‡Šæ”¾ã€‚è™½ç„¶æ¯æ¬¡ UITableViewCell éƒ½ä¼šè¢«é‡ç”¨ï¼Œä½†æ˜¯æ¯æ¬¡é‡ç”¨è¿‡ç¨‹ä¸­åˆ›å»ºçš„ä¿¡å·ç¡®å®æ— æ³•è¢« disposableã€‚é‚£æˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ 123456789101112131415- (NSInteger)tableView:(nonnull UITableView *)tableView numberOfRowsInSection:(NSInteger)section &#123; return 1000;&#125;- (UITableViewCell *)tableView:(nonnull UITableView *)tableView cellForRowAtIndexPath:(nonnull NSIndexPath *)indexPath &#123; UITableViewCell * cell = [tableView dequeueReusableCellWithIdentifier:@\"TableViewCell\"]; @weakify(self); [[RACObserve(cell.textLabel, text) takeUntil:cell.rac_prepareForReuseSignal] subscribeNext:^(id x) &#123; @strongify(self); NSLog(@\"%@\", self); &#125;]; return cell;&#125; æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨cellé‡Œé¢åˆ›å»ºçš„ä¿¡å·åŠ ä¸Š takeUntil:cell.rac_prepareForReuseSignalï¼Œè¿™ä¸ªæ˜¯è®© cell åœ¨æ¯æ¬¡é‡ç”¨çš„æ—¶å€™éƒ½å» disposable åˆ›å»ºçš„ä¿¡å·ã€‚ ä»¥ä¸Šæ‰€è¯´çš„å…³äºå†…å­˜çš„ä¸œè¥¿æˆ‘éƒ½ç”¨ Instrument çš„ Allocations éªŒè¯è¿‡äº†ï¼Œä½†æ˜¯ä¾æ—§å»ºè®®å¤§å®¶è‡ªå·±ä¹Ÿå»è¯•è¯•ã€‚","categories":[{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://hparis.github.io/blog/categories/æŠ€æœ¯/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://hparis.github.io/blog/tags/iOS/"},{"name":"RAC","slug":"RAC","permalink":"https://hparis.github.io/blog/tags/RAC/"}]}]}