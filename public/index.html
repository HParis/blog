<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hparis.github.io","root":"/blog/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚">
<meta property="og:type" content="website">
<meta property="og:title" content="å¸•å¸•&#39;s Blog">
<meta property="og:url" content="https://hparis.github.io/blog/index.html">
<meta property="og:site_name" content="å¸•å¸•&#39;s Blog">
<meta property="og:description" content="å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="å¸•å¸•">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://hparis.github.io/blog/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>å¸•å¸•'s Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">å¸•å¸•'s Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">è®°å½•ç‚¹ç‚¹æ»´æ»´</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://hparis.github.io/blog/2019/09/28/UIScrollView-%E7%9A%84%E5%81%8F%E7%A7%BB%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="å¸•å¸•">
      <meta itemprop="description" content="å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¸•å¸•'s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2019/09/28/UIScrollView-%E7%9A%84%E5%81%8F%E7%A7%BB%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">UIScrollView çš„åç§»é—®é¢˜</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-09-27 17:40:01" itemprop="dateCreated datePublished" datetime="2019-09-27T17:40:01Z">2019-09-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 07:08:33" itemprop="dateModified" datetime="2022-04-20T07:08:33Z">2022-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="è¢«æ§åˆ¶çš„-UIScrollView"><a href="#è¢«æ§åˆ¶çš„-UIScrollView" class="headerlink" title="è¢«æ§åˆ¶çš„ UIScrollView"></a>è¢«æ§åˆ¶çš„ UIScrollView</h2><p>åœ¨ UIViewController ä¸­æœ‰ä¸ªå±æ€§ï¼š<code>automaticallyAdjustsScrollViewInsets</code>ï¼Œè¿™ä¸ªå±æ€§æ˜¯ç”¨æ¥æ§åˆ¶ UIScrollView çš„åç§»è¡Œä¸ºçš„ã€‚</p>
<blockquote>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>The default value of this property is <code>true</code>, which lets container view controllers know that they should adjust the scroll view insets of this view controllerâ€™s view to account for screen areas consumed by a status bar, search bar, navigation bar, toolbar, or tab bar. Set this property to <code>false</code> if your view controller implementation manages its own scroll view inset adjustments.</td>
</tr>
<tr>
<td></td>
</tr>
</tbody></table>
</blockquote>
<p>å®˜æ–¹æ–‡æ¡£çš„æ„æ€å½“åœ¨ UIViewController ä¸Šæ·»åŠ   UIScrollView çš„æ—¶å€™ï¼Œä¼šæ ¹æ®å½“å‰é¡µé¢çš„ status barã€ search barã€navigation barã€toolbar æˆ– tab bar æ¥ä¿®æ”¹ UIScrollView çš„å†…å®¹åŒºåŸŸã€‚ä½†æ˜¯è¿™ä¸ªé˜¶æ®µçš„ UIViewController æ¯”è¾ƒè ¢ï¼Œä¸ç®¡ä»»ä½•æƒ…å†µä¸‹éƒ½ä¼šä¿®æ”¹ UIScrollView çš„åç§»é‡ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸ª UINavigationControllerï¼Œç„¶åæ·»åŠ ä¸€ä¸ª UIScrollViewï¼Œç„¶ååœ¨ UIScrollView ä¸Šé¢æ·»åŠ ä¸€ä¸ªçº¢è‰²çš„æ–¹å—ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> scrollView <span class="operator">=</span> <span class="type">UIScrollView</span>()</span><br><span class="line">scrollView.backgroundColor <span class="operator">=</span> .blue</span><br><span class="line">scrollView.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">// è¿™é‡Œå¼ºåˆ¶è®¾ç½® contentSize åªæ˜¯ä¸ºäº†è®© scrollView èƒ½æ»šåŠ¨èµ·æ¥</span></span><br><span class="line">scrollView.contentSize <span class="operator">=</span> <span class="type">CGSize</span>.<span class="keyword">init</span>(width: view.frame.size.width, height: <span class="number">1000</span>)</span><br><span class="line">view.addSubview(scrollView)</span><br><span class="line"><span class="comment">// âš ï¸ è¿™é‡Œæ˜¯ç›´æ¥è·Ÿ view çš„ topAnchor äº§ç”Ÿçº¦æŸ</span></span><br><span class="line">scrollView.topAnchor.constraint(equalTo: view.topAnchor).isActive <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">scrollView.bottomAnchor.constraint(equalTo: view.bottomAnchor).isActive <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">scrollView.leftAnchor.constraint(equalTo: view.leftAnchor).isActive <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">scrollView.rightAnchor.constraint(equalTo: view.rightAnchor).isActive <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> redView <span class="operator">=</span> <span class="type">UIView</span>()</span><br><span class="line">redView.backgroundColor <span class="operator">=</span> .red</span><br><span class="line">redView.translatesAutoresizingMaskIntoConstraints <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">scrollView.addSubview(redView)</span><br><span class="line">redView.centerXAnchor.constraint(equalTo: scrollView.centerXAnchor).isActive <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">redView.topAnchor.constraint(equalTo: scrollView.topAnchor).isActive <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">redView.widthAnchor.constraint(equalToConstant: <span class="number">100</span>).isActive <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">redView.heightAnchor.constraint(equalToConstant: <span class="number">100</span>).isActive <span class="operator">=</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<img src="https://i.imgur.com/OnQDx7E.png" alt="å›¾ä¸€ï¼šiOS 10 æ¨¡æ‹Ÿå™¨æ•ˆæœ" style="zoom:50%;" />



<p>å½“æˆ‘ä»¬æŠŠ UIScrollView çš„ topAnchor ä¿®æ”¹ä¸ºè·Ÿ UIViewController çš„ topLayoutGuide å‘ç”Ÿçº¦æŸï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrollView.topAnchor.constraint(equalTo: topLayoutGuide.bottomAnchor).isActive <span class="operator">=</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>



<img src="https://i.imgur.com/dwklB0X.png" alt="å›¾äºŒï¼šiOS 10 æ¨¡æ‹Ÿå™¨æ•ˆæœ" style="zoom:50%;" />

<p>æˆ‘ä»¬å‘ç°æœ€ç»ˆçš„æ•ˆæœæ˜¯ UIScrollView ä¹Ÿå‘ç”Ÿäº†åç§»ï¼Œè€Œä¸”è¿™ä¸ªåç§»æ˜¯æ ¹æ®ä½ é¡¶éƒ¨çš„ status bar å’Œ navigation bar çš„é«˜åº¦æ¥å†³å®šçš„ã€‚æ‰€ä»¥åœ¨ iOS 10 åŠä»¥ä¸‹çš„ç‰ˆæœ¬çš„æ—¶å€™ï¼Œæ·»åŠ åˆ° UIViewController çš„ UIScrollView æ€»æ˜¯ä¼šå‘ç”Ÿåç§»ã€‚ä½†æ˜¯ä½ å¯ä»¥é€šè¿‡æŠŠåˆšæ‰è¯´çš„é‚£ä¸ªå±æ€§ <code>automaticallyAdjustsScrollViewInsets</code>è®¾ç½®æˆ falseï¼ŒUIViewController å°±ä¸ä¼šè®©ä½ çš„ UIScrollView å‘ç”Ÿåç§»ã€‚ä½†æ˜¯è¿™ä¸ªå±æ€§ä¼šå½±å“åˆ°æ‰€æœ‰æ·»åŠ åˆ° UIViewController ä¸Šçš„ UIScrollViewï¼Œå¦‚æœæœ‰äº›æƒ³è¦å‘ç”Ÿåç§»ï¼Œæœ‰äº›ä¸æƒ³å‘ç”Ÿåç§»çš„æ—¶å€™å°±éœ€è¦æŠŠ <code>automaticallyAdjustsScrollViewInsets</code>è®¾ç½®æˆ falseï¼Œç„¶åé€šè¿‡ä»£ç å•ç‹¬å»ä¸ºæ¯ä¸ª UIScrollView è®¾ç½®ä¸åŒçš„ contentInsetã€‚</p>
<p>è¿™ç§è¢«æ§åˆ¶çš„ç”Ÿæ´»å¾ˆä¸æ˜¯æ»‹å‘³ï¼Œäºæ˜¯éšç€ iOS ç³»ç»Ÿæ¥åˆ° 11 ä¹‹åï¼ŒUIScrollView ç»ˆäºå¤ºå›äº†è‡ªå·±çš„åç§»æ§åˆ¶æƒã€‚UIViewController çš„<code>automaticallyAdjustsScrollViewInsets</code>ç»ˆäºè¢«åºŸå¼ƒäº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ UIScrollView è‡ªå·±çš„<code>contentInsetAdjustmentBehavior</code>ã€‚</p>
<h2 id="è‡ªç”±çš„-UIScrollView"><a href="#è‡ªç”±çš„-UIScrollView" class="headerlink" title="è‡ªç”±çš„ UIScrollView"></a>è‡ªç”±çš„ UIScrollView</h2><blockquote>
<p>This property specifies how the safe area insets are used to modify the content area of the scroll view. The default value of this property is <a href="apple-reference-documentation://hs7dxiWRRh">UIScrollView.ContentInsetAdjustmentBehavior.automatic</a>.</p>
</blockquote>
<p>UIScrollView çš„<code>contentInsetAdjustmentBehavior</code>çš„é»˜è®¤è¡Œä¸ºæ˜¯<code>automatic</code>ï¼Œè¿™å’Œ iOS 10 é»˜è®¤è¡Œä¸ºçš„æœ€å¤§åŒºåˆ«å°±æ˜¯å®ƒä¼šåˆ¤æ–­ UIScrollView æ˜¯è¢«æ·»åŠ åˆ°å“ªä¸ªä½ç½®ï¼Œç„¶åæ ¹æ®è¿™ä¸ªä½ç½®æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä¿®æ”¹ UIScrollView çš„åç§»é‡ã€‚</p>
<p>è¿˜æ˜¯æ‹¿ä¸Šé¢å›¾äºŒçš„æƒ…å†µæ¥è®²ï¼Œåœ¨ iOS 11 åŠ iOS 11 ä¹‹åï¼Œæˆ‘ä»¬è¿˜æ˜¯ç…§æ ·åªä¿®æ”¹  UIScrollView çš„ topAnchorï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrollView.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor).isActive <span class="operator">=</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<img src="https://i.imgur.com/co1D7xr.png" alt="å›¾ä¸‰ï¼šiOS 12 æ¨¡æ‹Ÿå™¨æ•ˆæœ" style="zoom:50%;" />

<p>æ­¤æ—¶æˆ‘ä»¬å‘ç° UIScrollView å¹¶æ²¡æœ‰å‘ç”Ÿåç§»ï¼Œè¿™ä¹Ÿæ˜¯å› ä¸º iOS 11 ä¹‹åå¼•å…¥æ¥ safeArea çš„æ¦‚å¿µä¹‹åå¸¦æ¥çš„ UI æ–¹é¢çš„ä¼˜åŒ–ã€‚</p>
<p><code>contentInsetAdjustmentBehavior</code>è¿˜æœ‰ä¸¤ä¸ªå€¼ï¼Œå…¶ä¸­<code>always</code>å¯¹åº”äº†<code>automaticallyAdjustsScrollViewInsets</code>çš„<code>true</code>,<code>never</code>å¯¹åº”äº†<code>automaticallyAdjustsScrollViewInsets</code>çš„<code>false</code>ã€‚</p>
<p>è‡³äº<code>scrollableAxes</code>ï¼Œå®ƒå…¶å®å°±æ˜¯æ ¹æ® UIScrollView çš„æ»šåŠ¨æ–¹å‘æ¥å†³å®šåœ¨å“ªä¸ªè½´ä¸Šä½¿ç”¨ sa feAreaã€‚</p>
<p>é€šè¿‡<code>contentInsetAdjustmentBehavior</code>æˆ‘ä»¬å°±å¯ä»¥ä¸º UIViewController ä¸Šçš„æ¯ä¸€ä¸ª UIScrollView å®šåˆ¶å®ƒä»¬çš„åç§»è¡Œä¸ºã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://hparis.github.io/blog/2018/11/06/Notification-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="å¸•å¸•">
      <meta itemprop="description" content="å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¸•å¸•'s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/11/06/Notification-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%9F%A5%E8%AF%86%E7%82%B9/" class="post-title-link" itemprop="url">Notification çš„ä¸€äº›çŸ¥è¯†ç‚¹</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-05 17:55:26" itemprop="dateCreated datePublished" datetime="2018-11-05T17:55:26Z">2018-11-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 07:08:33" itemprop="dateModified" datetime="2022-04-20T07:08:33Z">2022-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="é‡å¤æ·»åŠ ç›¸åŒè§‚å¯Ÿè€…"><a href="#é‡å¤æ·»åŠ ç›¸åŒè§‚å¯Ÿè€…" class="headerlink" title="é‡å¤æ·»åŠ ç›¸åŒè§‚å¯Ÿè€…"></a>é‡å¤æ·»åŠ ç›¸åŒè§‚å¯Ÿè€…</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ—¥å¸¸å¼€å‘ä¸­æˆ‘ä»¬å¯¹ NSNotification çš„æ­£å¸¸ç”¨æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰é€šçŸ¥</span></span><br><span class="line"><span class="keyword">let</span> <span class="type">TestNotification</span> <span class="operator">=</span> <span class="type">NSNotification</span>.<span class="type">Name</span>.<span class="keyword">init</span>(<span class="string">&quot;com.papa.test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="type">NotificationCenter</span>.default.addObserver(<span class="keyword">self</span>, selector: <span class="keyword">#selector</span>(<span class="type">Test</span>.test(notification:)), name: <span class="type">TestNotification</span>, object: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨æ„</span></span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="type">NotificationCenter</span>.default.removeObserver(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">test</span>(<span class="params">notification</span>: <span class="type">Notification</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Test&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨åˆšæ‰ä»£ç ä¸­çš„ <code>init</code> æ–¹æ³•é‡Œé¢å¯¹åŒä¸€ä¸ªé€šçŸ¥å¤šæ¬¡æ·»åŠ åŒä¸€ä¸ªè§‚å¯Ÿè€…çš„è¯ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">init</span>() &#123;</span><br><span class="line">    <span class="type">NotificationCenter</span>.default.addObserver(<span class="keyword">self</span>, selector: <span class="keyword">#selector</span>(<span class="type">Test</span>.test(notification:)), name: <span class="type">TestNotification</span>, object: <span class="literal">nil</span>)</span><br><span class="line">    <span class="type">NotificationCenter</span>.default.addObserver(<span class="keyword">self</span>, selector: <span class="keyword">#selector</span>(<span class="type">Test</span>.test(notification:)), name: <span class="type">TestNotification</span>, object: <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€ TestNotification é€šçŸ¥</span></span><br><span class="line"><span class="type">NotificationCenter</span>.default.post(name: <span class="type">TestNotification</span>, object: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>

<p>ç­”æ¡ˆæ˜¯ä¼šè¾“å‡ºï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Test</span></span><br><span class="line"><span class="type">Test</span></span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æˆ‘ä»¬è¦å°½é‡é¿å…é‡å¤æ·»åŠ è§‚å¯Ÿè€…ï¼Œå› ä¸ºè¿™æœ‰å¯èƒ½ä¼šé€ æˆä¸€äº›æœªçŸ¥ç°è±¡çš„å‘ç”Ÿã€‚</p>
<h2 id="é€šçŸ¥ä¸­çš„çº¿ç¨‹é—®é¢˜"><a href="#é€šçŸ¥ä¸­çš„çº¿ç¨‹é—®é¢˜" class="headerlink" title="é€šçŸ¥ä¸­çš„çº¿ç¨‹é—®é¢˜"></a>é€šçŸ¥ä¸­çš„çº¿ç¨‹é—®é¢˜</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰é€šçŸ¥</span></span><br><span class="line"><span class="keyword">let</span> <span class="type">ThreadNotification</span> <span class="operator">=</span> <span class="type">NSNotification</span>.<span class="type">Name</span>.<span class="keyword">init</span>(<span class="string">&quot;com.papa.thread&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Add Observer: <span class="subst">\(Thread.current)</span>&quot;</span>)</span><br><span class="line">        <span class="type">NotificationCenter</span>.default.addObserver(<span class="keyword">self</span>, selector: <span class="keyword">#selector</span>(<span class="type">Test</span>.test(notification:)), name: <span class="type">ThreadNotification</span>, object: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨æ„</span></span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="type">NotificationCenter</span>.default.removeObserver(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">test</span>(<span class="params">notification</span>: <span class="type">Notification</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Receive: <span class="subst">\(Thread.current)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">DispatchQueue</span>.<span class="keyword">init</span>(label: <span class="string">&quot;com.ps.test.queue&quot;</span>).async &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Post: <span class="subst">\(Thread.current)</span>&quot;</span>)</span><br><span class="line">    <span class="type">NotificationCenter</span>.default.post(name: <span class="type">ThreadNotification</span>, object: <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥çœ‹çœ‹è§‚å¯Ÿè€…æ˜¯åœ¨ä»€ä¹ˆçº¿ç¨‹ä¸Šæ¥å—åˆ°é€šçŸ¥çš„:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Add</span> <span class="type">Observer</span>: <span class="operator">&lt;</span><span class="type">NSThread</span>: <span class="number">0x60000147d1c0</span><span class="operator">&gt;</span>&#123;number <span class="operator">=</span> <span class="number">1</span>, name <span class="operator">=</span> main&#125;</span><br><span class="line"><span class="type">Post</span>: <span class="operator">&lt;</span><span class="type">NSThread</span>: <span class="number">0x600001462640</span><span class="operator">&gt;</span>&#123;number <span class="operator">=</span> <span class="number">3</span>, name <span class="operator">=</span> (null)&#125;</span><br><span class="line"><span class="type">Receive</span>: <span class="operator">&lt;</span><span class="type">NSThread</span>: <span class="number">0x600001462640</span><span class="operator">&gt;</span>&#123;number <span class="operator">=</span> <span class="number">3</span>, name <span class="operator">=</span> (null)&#125;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶æˆ‘ä»¬æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­å»æ·»åŠ è§‚å¯Ÿè€…ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬æ˜¯åœ¨å…¶ä»–çº¿ç¨‹ä¸­å»å‘é€é€šçŸ¥çš„ï¼Œæ‰€ä»¥æœ€åæˆ‘ä»¬ä¹Ÿæ˜¯åœ¨å…¶ä»–çº¿ç¨‹ä¸­æ¥æ”¶åˆ°é€šçŸ¥çš„ã€‚</p>
<h2 id="é€šçŸ¥ä¸­çš„é˜»å¡é—®é¢˜"><a href="#é€šçŸ¥ä¸­çš„é˜»å¡é—®é¢˜" class="headerlink" title="é€šçŸ¥ä¸­çš„é˜»å¡é—®é¢˜"></a>é€šçŸ¥ä¸­çš„é˜»å¡é—®é¢˜</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰é€šçŸ¥</span></span><br><span class="line"><span class="keyword">let</span> <span class="type">SleepNotification</span> <span class="operator">=</span> <span class="type">NSNotification</span>.<span class="type">Name</span>.<span class="keyword">init</span>(<span class="string">&quot;com.papa.sleep&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="type">NotificationCenter</span>.default.addObserver(<span class="keyword">self</span>, selector: <span class="keyword">#selector</span>(<span class="type">Test</span>.test(notification:)), name: <span class="type">SleepNotification</span>, object: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨æ„</span></span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="type">NotificationCenter</span>.default.removeObserver(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">@objc</span> <span class="keyword">func</span> <span class="title function_">test</span>(<span class="params">notification</span>: <span class="type">Notification</span>) &#123;</span><br><span class="line">        sleep(<span class="number">3</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> start <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"><span class="type">NotificationCenter</span>.default.post(name: <span class="type">SleepNotification</span>, object: <span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">let</span> end <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ç›¸å·®ï¼š<span class="subst">\(end.timeIntervalSince(start))</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€åç›¸å·®æ—¶é—´å¤§æ¦‚æ˜¯ <code>3s</code> ï¼Œé€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å°±çŸ¥é“å• NotificationCenter å» post ä¸€ä¸ªé€šçŸ¥çš„æ—¶å€™ï¼Œå®ƒä¼šç­‰å¾…è§‚å¯Ÿè€…å¤„ç†å®Œæ”¹é€šçŸ¥ä¹‹åæ‰ä¼šç»§ç»­å¾€åæ‰§è¡Œã€‚æ‰€ä»¥å¹³å¸¸ä½¿ç”¨è¿‡ç¨‹ä¸­æˆ‘ä»¬è¦æ³¨æ„ post æœ‰å¯èƒ½ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://hparis.github.io/blog/2018/05/25/Swift-High-Performance-Tip%203%EF%BC%9A@objc-%E5%92%8C-dynamic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="å¸•å¸•">
      <meta itemprop="description" content="å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¸•å¸•'s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/05/25/Swift-High-Performance-Tip%203%EF%BC%9A@objc-%E5%92%8C-dynamic/" class="post-title-link" itemprop="url">Swift High-Performance Tip 3ï¼š@objc å’Œ dynamic</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-24 18:48:01" itemprop="dateCreated datePublished" datetime="2018-05-24T18:48:01Z">2018-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 07:08:33" itemprop="dateModified" datetime="2022-04-20T07:08:33Z">2022-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="objc"><a href="#objc" class="headerlink" title="@objc"></a>@objc</h3><p>@objc çš„ä½œç”¨æ˜¯ä¸ºäº†è®© Objective-C èƒ½å¤Ÿè°ƒç”¨ Swift çš„ä»£ç ã€‚å…¶ä¸­çš„å…³é”®æ˜¯ @objc ä¼šç”Ÿæˆä¸€æ®µ thunk ä»£ç ï¼ŒObjective-C é€šè¿‡è¿™æ®µ thunk ä»£ç æ¥é—´æ¥è°ƒç”¨ Swift ä»£ç ã€‚å¦‚æœæ˜¯ Swift æ¥è°ƒç”¨è¢« @objc ä¿®é¥°çš„æ–¹æ³•çš„æ—¶å€™ï¼Œæ­¤æ—¶æ˜¯ä¸éœ€è¦ç»è¿‡ thunk ä»£ç å°±èƒ½ç›´æ¥è°ƒç”¨çš„ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æƒ³è±¡ï¼Œå¦‚æœæ–¹æ³•å˜å¾—å¤æ‚æˆ–è€…è¢« @objc ä¿®é¥°çš„æ–¹æ³•æ•°é‡å˜å¾—è¶Šæ¥è¶Šå¤šä¼šå‘ç”Ÿä»€ä¹ˆäº‹ï¼Ÿç­”æ¡ˆå°±æ˜¯ thunk ä»£ç å˜å¾—è¶Šæ¥è¶Šå¤šï¼Œæœ€åä¼šå¯¼è‡´æˆ‘ä»¬çš„åŒ…å¤§å°ä¹Ÿå˜å¾—è¶Šæ¥è¶Šå¤§ã€‚å¹¶ä¸”åŠ¨æ€é“¾æ¥å™¨ï¼ˆdynamic linkerï¼‰è¿˜éœ€è¦æ•´ç†è¿™äº› thunk ä»£ç ï¼Œæœ€åå¯¼è‡´åŠ è½½æ—¶é—´ä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šé•¿ã€‚</p>
<p>åœ¨ Swift3 çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šæ¨æ–­å‡ºä½ çš„æ–¹æ³•ä¸æ˜¯ Swift ä¸“ç”¨çš„ï¼ˆæ¯”å¦‚æœ‰å…ƒç»„ã€ç»“æ„ä½“ï¼‰ï¼Œå°±ä¼šé»˜è®¤ç»™ä½ çš„æ–¹æ³•å¢åŠ  @objc çš„ä¿®é¥°ã€‚è¿™ç§æ–¹å¼å°±å¯¼è‡´äº†åœ¨ Swift3 çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆå¤§é‡çš„ thunk ä»£ç ï¼Œå¹¶ä¸”è¿™å…¶ä¸­çš„å¤§éƒ¨åˆ†ä»£ç éƒ½ä¸ä¼šè¢«ä½¿ç”¨ã€‚æ‰€ä»¥ Swift4 é»˜è®¤æ˜¯ä¸åš @objc çš„æ¨æ–­ï¼Œåªæœ‰æˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ äº† @objc ä¹‹åï¼ŒObjective-C æ‰èƒ½è°ƒç”¨æˆ‘ä»¬çš„ Swift ä»£ç ã€‚ </p>
<h3 id="dynamic"><a href="#dynamic" class="headerlink" title="dynamic"></a>dynamic</h3><p>Swift çš„æ–¹æ³•æ˜¯é€šè¿‡ vtable æ¥è°ƒç”¨çš„ï¼Œä½¿ç”¨ vtable è¦æ¯” Objective-C çš„ runtime æ›´é«˜æ•ˆã€‚</p>
<p>è€Œä½¿ç”¨ dynamic æ¥ä¿®é¥°çš„æ–¹æ³•ï¼Œä»£è¡¨è¿™ä¸ªæ–¹æ³•æ˜¯å¯ä»¥è¢«åŠ¨æ€è°ƒç”¨çš„ã€‚è€Œç”±äºç›®å‰ Swfit è¿˜æ²¡æœ‰å®ç°è‡ªå·±çš„ runtime æœºåˆ¶ï¼Œæ‰€ä»¥åŠ¨æ€è°ƒç”¨åªèƒ½å¤Ÿåœ¨ Objective-C å»è°ƒç”¨ã€‚åœ¨  Swift4 ä½¿ç”¨ dynamic ä¿®é¥°ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šè¦æ±‚ä½ è¿˜éœ€è¦ä½¿ç”¨ @objc å»ä¿®é¥°ã€‚è¿™æ˜¯ä¸ºäº†æ˜ç¡®çš„å‘Šè¯‰ç¼–è¯‘å™¨è¿™ä¸ªæ–¹æ³•æ˜¯ç”± Objective-C çš„ runtime æ¥è°ƒç”¨çš„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸ºäº†å…¼å®¹ä»¥åå¯èƒ½ä¼šå‡ºç°çš„ Swift runtime æœºåˆ¶ã€‚</p>
<p>ç”±äºç›®å‰ä½¿ç”¨ @objc dynamic ä¿®é¥°çš„æ–¹æ³•å¹¶ä¸åœ¨ Swift å®ä¾‹å¯¹è±¡çš„ vtable é‡Œé¢ï¼Œæ‰€ä»¥ Swift æ¥è°ƒç”¨è¯¥æ–¹æ³•çš„æ—¶å€™ä¾æ—§éœ€è¦é€šè¿‡ thunk ä»£ç æ¥è°ƒç”¨ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><img src="https://swiftunboxed.com/images/native-objc-dynamic.png" alt="æ­¤å›¾å‡ºè‡ª https://swiftunboxed.com/interop/objc-dynamic/"></p>
<p>é€šè¿‡ä¸Šå›¾æˆ‘ä»¬çŸ¥é“ï¼š</p>
<blockquote>
<p>é™¤éæ˜ç¡®çš„çŸ¥é“ä¼šåœ¨ Objective-C ä¸­è°ƒç”¨è¿™æ®µä»£ç ï¼Œå¦åˆ™åˆ«ä½¿ç”¨ @objcï¼›<br>é™¤éæ˜ç¡®çš„çŸ¥é“è¯¥æ–¹æ³•éœ€è¦è¢« Objective-C çš„ runtime åŠ¨æ€è°ƒç”¨ï¼Œå¦åˆ™åˆ«ä½¿ç”¨ @objc dynamicã€‚</p>
</blockquote>
<hr>
<p><strong>å‚è€ƒæ–‡çŒ®</strong></p>
<ol>
<li><p><a target="_blank" rel="noopener" href="https://swiftunboxed.com/interop/objc-dynamic/">https://swiftunboxed.com/interop/objc-dynamic/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/apple/swift-evolution/blob/master/proposals/0160-objc-inference.md">https://github.com/apple/swift-evolution/blob/master/proposals/0160-objc-inference.md</a></p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://hparis.github.io/blog/2018/04/19/self-%E5%9C%A8-block-%E4%B8%AD%E7%9A%84%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E5%8F%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="å¸•å¸•">
      <meta itemprop="description" content="å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¸•å¸•'s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/04/19/self-%E5%9C%A8-block-%E4%B8%AD%E7%9A%84%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E5%8F%98%E5%8C%96/" class="post-title-link" itemprop="url">self åœ¨ block ä¸­çš„å¼•ç”¨è®¡æ•°å˜åŒ–</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-04-19 11:34:51" itemprop="dateCreated datePublished" datetime="2018-04-19T11:34:51Z">2018-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 07:08:33" itemprop="dateModified" datetime="2022-04-20T07:08:33Z">2022-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>ç›¸ä¿¡å¤§å®¶åœ¨ Objective-C ä¸­éƒ½ä¼šé€šè¿‡ <code>__waek</code> çš„ä¿®é¥°ç¬¦æ¥ä¿è¯ block å’Œ self ä¸ä¼šäº’ç›¸å¼•ç”¨ï¼Œä»£ç å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__weak typeof(self) weakSelf = self;</span><br><span class="line">self.block = ^&#123;</span><br><span class="line">    __strong typeof(self) strongSelf = self;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ä½ æ€è€ƒè¿‡ self åœ¨è¿™ä¸€æ®µæ—…ç¨‹ä¸­çš„å¼•ç”¨è®¡æ•°å˜åŒ–ä¹ˆï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šé€šè¿‡ä¸‰ä¸ªä¾‹å­æ¥å±•ç¤ºè¿™ä¸€æ®µæ—…ç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// ğŸŒ°1</span><br><span class="line">NSLog(@&quot;Before blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self)));</span><br><span class="line">self.block = ^&#123;</span><br><span class="line">    self;</span><br><span class="line">    NSLog(@&quot;Within blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self)));</span><br><span class="line">&#125;;</span><br><span class="line">self.block();</span><br><span class="line">NSLog(@&quot;After blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self)));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ğŸŒ°2</span><br><span class="line">__weak typeof(self) weakSelf = self;</span><br><span class="line">NSLog(@&quot;Before blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self)));</span><br><span class="line">self.block = ^&#123;</span><br><span class="line">    weakSelf;</span><br><span class="line">    NSLog(@&quot;Within blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(weakSelf)));</span><br><span class="line">&#125;;</span><br><span class="line">self.block();</span><br><span class="line">NSLog(@&quot;After blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self)));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ğŸŒ°3</span><br><span class="line">__weak typeof(self) weakSelf = self;</span><br><span class="line">NSLog(@&quot;Before blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self)));</span><br><span class="line">self.block = ^&#123;</span><br><span class="line">    __strong typeof(self) strongSelf = weakSelf;</span><br><span class="line">    NSLog(@&quot;Within blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(weakSelf)));</span><br><span class="line">&#125;;</span><br><span class="line">self.block();</span><br><span class="line">NSLog(@&quot;After blockï¼š%ld&quot;, CFGetRetainCount((__bridge CFTypeRef)(self)));</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Clang å¯¹ä¸Šé¢çš„ä¸‰ä¸ªä¾‹å­åšä¸€ä¸‹ç¼–è¯‘ï¼Œé€šè¿‡ç¼–è¯‘åçš„ C ä»£ç ï¼ˆæ¥ä¸‹æ¥æ‰€å±•ç¤ºä»£ç éƒ½æ˜¯ç»è¿‡ç®€åŒ–ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡º self çš„å¼•ç”¨è®¡æ•°å˜åŒ–ã€‚</p>
<hr>
<p>ğŸŒ°1 çš„ C ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">// Block ç»“æ„ä½“ã€‚è¿™ä¸ªå¤§å®¶å¯ä»¥é€šè¿‡å…¶ä»–çš„èµ„æ–™å»çœ‹çœ‹ï¼Œæˆ‘ä»¬ä»Šå¤©ä¸»è¦æ˜¯æ¥æ¢å¯»ä¸€ä¸‹ self çš„æ—…ç¨‹ï¼Œè¿™é‡Œå°±ä¸å¯¹ Block æœ¬èº«åšæ›´è¯¦ç»†çš„ä»‹ç»</span><br><span class="line">struct __block_impl &#123;</span><br><span class="line">  void *isa;</span><br><span class="line">  int Flags;</span><br><span class="line">  int Reserved;</span><br><span class="line">  void *FuncPtr;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// ^&#123;&#125; çš„å®ç°</span><br><span class="line">struct __BlockTest__test_block_impl_0 &#123;</span><br><span class="line">    struct __block_impl impl;</span><br><span class="line">    struct __BlockTest__test_block_desc_0* Desc;</span><br><span class="line">    BlockTest *const __strong self;</span><br><span class="line">    __BlockTest__test_block_impl_0(void *fp, struct __BlockTest__test_block_desc_0 *desc, BlockTest *const __strong _self, int flags=0) : self(_self) &#123;</span><br><span class="line">        impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">        impl.Flags = flags;</span><br><span class="line">        impl.FuncPtr = fp;</span><br><span class="line">        Desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// Block æ–¹æ³•</span><br><span class="line">static void __BlockTest__test_block_func_0(struct __BlockTest__test_block_impl_0 *__cself) &#123;</span><br><span class="line">    BlockTest *const __strong self = __cself-&gt;self; // bound by copy</span><br><span class="line">    self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Block çš„ copy æ“ä½œ</span><br><span class="line">static void __BlockTest__test_block_copy_0(struct __BlockTest__test_block_impl_0*dst, struct __BlockTest__test_block_impl_0*src) &#123;_Block_object_assign((void*)&amp;dst-&gt;self, (void*)src-&gt;self, 3/*BLOCK_FIELD_IS_OBJECT*/);&#125;</span><br><span class="line"></span><br><span class="line">// Block çš„ dispose æ“ä½œ</span><br><span class="line">static void __BlockTest__test_block_dispose_0(struct __BlockTest__test_block_impl_0*src) &#123;_Block_object_dispose((void*)src-&gt;self, 3/*BLOCK_FIELD_IS_OBJECT*/);&#125;</span><br><span class="line"></span><br><span class="line">// æè¿° Block çš„ copy å’Œ dispose</span><br><span class="line">static struct __BlockTest__test_block_desc_0 &#123;</span><br><span class="line">    size_t reserved;</span><br><span class="line">    size_t Block_size;</span><br><span class="line">    void (*copy)(struct __BlockTest__test_block_impl_0*, struct __BlockTest__test_block_impl_0*);</span><br><span class="line">    void (*dispose)(struct __BlockTest__test_block_impl_0*);</span><br><span class="line">&#125; __BlockTest__test_block_desc_0_DATA = &#123; 0, sizeof(struct __BlockTest__test_block_impl_0), __BlockTest__test_block_copy_0, __BlockTest__test_block_dispose_0&#125;;</span><br><span class="line"></span><br><span class="line">// æ–¹æ³•ä¸»ä½“</span><br><span class="line">static void _I_BlockTest_test(BlockTest * self, SEL _cmd) &#123;</span><br><span class="line">    ((void (*)(id, SEL, void (*)()))(void *)objc_msgSend)((id)self, sel_registerName(&quot;setBlock:&quot;), ((void (*)())&amp;__BlockTest__test_block_impl_0((void *)__BlockTest__test_block_func_0, &amp;__BlockTest__test_block_desc_0_DATA, self, 570425344)));</span><br><span class="line">    ((void (*(*)(id, SEL))())(void *)objc_msgSend)((id)self, sel_registerName(&quot;block&quot;))();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>åœ¨æ–¹æ³•ä¸»ä½“é‡Œé¢é¦–å…ˆä¼šæ„é€ ä¸€ä¸ª <code>__BlockTest__test_block_impl_0</code> çš„ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“æ•è·äº† selfï¼›</li>
<li><code>__BlockTest__test_block_impl_0</code> çš„æ„é€ å‡½æ•°ä¸­ä½¿ç”¨äº† <code>__strong</code> æ¥æ•è· selfï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“åœ¨æ„é€ çš„æ—¶å€™é»˜è®¤æ˜¯ä½¿ç”¨ <code>__strong</code> æ¥æ•è·å¤–éƒ¨çš„å¯¹è±¡å˜é‡ï¼Œæ­¤æ—¶ self çš„å¼•ç”¨è®¡æ•°åº”è¯¥è¦ +1ï¼›</li>
<li>Block è¢«æ„é€ å‡ºæ¥ä¹‹åéœ€è¦è¢«èµ‹å€¼ç»™ selfï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ ARC æ¨¡å¼ä¸‹æ­¤æ—¶çš„ Block ä¼šæ‰§è¡Œ Copy æ“ä½œï¼Œä» <code>_NSConcreteStackBlock</code> å˜æˆ <code>_NSMallocBlock</code>ï¼›</li>
<li>Block é€šè¿‡ <code>__BlockTest__test_block_desc_0_DATA</code> æ‰¾åˆ° Copy æ–¹æ³•çš„å…·ä½“å®ç° <code>__BlockTest__test_block_copy_0</code>ï¼Œä»ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬çŸ¥é“è¯¥æ–¹æ³•çš„å®ç°æ˜¯é€šè¿‡ <code>_Block_object_assign</code> æ¥å®ç°çš„ï¼ˆå¯¹äºè¿™ä¸ªæ–¹æ³•çš„å®ç°ç»†èŠ‚æš‚æ—¶è¿˜æ²¡æœ‰æ‰¾åˆ°æ›´ç›¸ä¿¡çš„èµ„æ–™ï¼Œæœ‰çŸ¥é“çš„å¯ä»¥éº»çƒ¦å‘Šè¯‰ä¸€ä¸‹ï¼‰ï¼Œé€šè¿‡åå­—æˆ‘ä»¬å¯ä»¥çŒœæµ‹å‡ºè¯¥æ–¹æ³•åªæ˜¯æŠŠæ•è·çš„å˜é‡åœ°å€ç›´æ¥æ‹·è´ä¸€ä»½åˆ°å †å†…å­˜ä¸­ï¼Œä½†æ˜¯ä¸ä¼šå¼•èµ·å¼•ç”¨è®¡æ•°çš„å˜åŒ–ï¼›</li>
<li>å½“ Block è¢«çœŸæ­£æ‰§è¡Œçš„æ—¶å€™ä¼šé€šè¿‡ <code>__block_impl</code> çš„ <code>FuncPtr</code> æ‰¾åˆ°çœŸæ­£çš„å®ç°ä»£ç  <code>__BlockTest__test_block_func_0</code>ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢æœ‰è¿™æ ·ä¸€å¥ä»£ç  <code>BlockTest *const __strong self = __cself-&gt;self</code>ï¼Œå¾ˆæ˜æ˜¾æ­¤æ—¶ self çš„å¼•ç”¨è®¡æ•°ä¼š +1ï¼Œå½“è¯¥ <code>__BlockTest__test_block_func_0</code> æ‰§è¡Œå®Œæ¯•ä¹‹åè¿˜æ˜¯ä¼šé‡Šæ”¾ self çš„ï¼Œæ­¤æ—¶å¼•ç”¨è®¡æ•°ä¼š -1ï¼›</li>
</ol>
<p>ä»ä¸Šé¢çš„åˆ†æè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ç”±äº Block åœ¨æ„é€ çš„æ—¶å€™é»˜è®¤å°±å¯¹æ•è·çš„ self è¿›è¡Œäº†å¼ºå¼•ç”¨ï¼Œå¯¼è‡´ self çš„å¼•ç”¨è®¡æ•° +1ï¼›è€Œåˆç”±äº self æŒæœ‰äº† Blockï¼Œæ‰€ä»¥è¿™é‡Œå°±é€ æˆäº†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ ğŸŒ°2 èƒ½ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p>
<hr>
<p>ğŸŒ°2 çš„ C ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// ^&#123;&#125; ç»“æ„ä½“</span><br><span class="line">struct __BlockTest__test_block_impl_0 &#123;</span><br><span class="line">    struct __block_impl impl;</span><br><span class="line">    struct __BlockTest__test_block_desc_0* Desc;</span><br><span class="line">    BlockTest *const __weak weakSelf;</span><br><span class="line">    __BlockTest__test_block_impl_0(void *fp, struct __BlockTest__test_block_desc_0 *desc, BlockTest *const __weak _weakSelf, int flags=0) : weakSelf(_weakSelf) &#123;</span><br><span class="line">        impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">        impl.Flags = flags;</span><br><span class="line">        impl.FuncPtr = fp;</span><br><span class="line">        Desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// Block æ–¹æ³•</span><br><span class="line">static void __BlockTest__test_block_func_0(struct __BlockTest__test_block_impl_0 *__cself) &#123;</span><br><span class="line">    BlockTest *const __weak weakSelf = __cself-&gt;weakSelf; // bound by copy</span><br><span class="line">    weakSelf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Block çš„ copy æ“ä½œ</span><br><span class="line">static void __BlockTest__test_block_copy_0(struct __BlockTest__test_block_impl_0*dst, struct __BlockTest__test_block_impl_0*src) &#123;_Block_object_assign((void*)&amp;dst-&gt;weakSelf, (void*)src-&gt;weakSelf, 3/*BLOCK_FIELD_IS_OBJECT*/);&#125;</span><br><span class="line"></span><br><span class="line">// Block çš„ dispose æ“ä½œ</span><br><span class="line">static void __BlockTest__test_block_dispose_0(struct __BlockTest__test_block_impl_0*src) &#123;_Block_object_dispose((void*)src-&gt;weakSelf, 3/*BLOCK_FIELD_IS_OBJECT*/);&#125;</span><br><span class="line"></span><br><span class="line">// æè¿° Block çš„ copy å’Œ dispose</span><br><span class="line">static struct __BlockTest__test_block_desc_0 &#123;</span><br><span class="line">    size_t reserved;</span><br><span class="line">    size_t Block_size;</span><br><span class="line">    void (*copy)(struct __BlockTest__test_block_impl_0*, struct __BlockTest__test_block_impl_0*);</span><br><span class="line">    void (*dispose)(struct __BlockTest__test_block_impl_0*);</span><br><span class="line">&#125; __BlockTest__test_block_desc_0_DATA = &#123; 0, sizeof(struct __BlockTest__test_block_impl_0), __BlockTest__test_block_copy_0, __BlockTest__test_block_dispose_0&#125;;</span><br><span class="line"></span><br><span class="line">// æ–¹æ³•ä¸»ä½“</span><br><span class="line">static void _I_BlockTest_test(BlockTest * self, SEL _cmd) &#123;</span><br><span class="line">    __attribute__((objc_ownership(weak))) typeof(self) weakSelf = self;</span><br><span class="line">    ((void (*)(id, SEL, void (*)()))(void *)objc_msgSend)((id)self, sel_registerName(&quot;setBlock:&quot;), ((void (*)())&amp;__BlockTest__test_block_impl_0((void *)__BlockTest__test_block_func_0, &amp;__BlockTest__test_block_desc_0_DATA, weakSelf, 570425344)));</span><br><span class="line">    ((void (*(*)(id, SEL))())(void *)objc_msgSend)((id)self, sel_registerName(&quot;block&quot;))();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>æ–¹æ³•ä¸»ä½“ä¼šå…ˆç”¨ <code>__weak</code> åˆå§‹åŒ–ä¸€ä¸ª weakSelfï¼Œæ­¤æ—¶ self çš„å¼•ç”¨è®¡æ•°æ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼›ä¹‹åä¼šæ„é€ ä¸€ä¸ª<code>__BlockTest__test_block_impl_0</code> çš„ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“æ•è·äº† weakSelfï¼›</li>
<li><code>__BlockTest__test_block_impl_0</code> çš„æ„é€ å‡½æ•°ä¸­ä½¿ç”¨äº† <code>__weak</code> æ¥æ•è· weakSelfï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“æ­¤æ—¶ self çš„å¼•ç”¨è®¡æ•°åº”è¯¥è¦ä¹Ÿæ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼›</li>
<li>ç„¶åæŠŠè¯¥ç»“æ„ä½“èµ‹å€¼ç»™ self.blockï¼Œblock ç»“æ„ä½“è¢«ä»æ ˆå¤åˆ¶åˆ°å †çš„æ—¶å€™ä½¿ç”¨äº† <code>_Block_object_assign</code>ï¼Œæ‰€ä»¥æ­¤æ—¶ self çš„å¼•ç”¨è®¡æ•°ä¸ä¼šå‘ç”Ÿå˜åŒ–</li>
<li>ç„¶å block åœ¨è¢«æ‰§è¡Œçš„æ—¶å€™åšäº†ä¸€ä¸‹ <code>__weak</code> çš„æ“ä½œ <code>BlockTest *const __weak weakSelf = __cself-&gt;weakSelf</code>ï¼Œè¿™æ—¶å€™ self çš„å¼•ç”¨è®¡æ•°ä¹Ÿä¸ä¼šå‘ç”Ÿå˜åŒ–</li>
<li>ç”±äº block å¯¹ weakSelf æ²¡æœ‰å¼ºå¼•ç”¨ï¼Œæ‰€ä»¥åœ¨ block æ‰§è¡Œå®Œæˆä¹‹åä¹Ÿä¸éœ€è¦åšé‡Šæ”¾ weakSelf çš„å·¥ä½œ</li>
</ol>
<p>æ‰€ä»¥ï¼Œåœ¨è¯¥ä¾‹å­ä¸­ block æ— æ³•å¼ºå¼•ç”¨ weakSelfï¼ŒweakSelf çš„å¼•ç”¨è®¡æ•°æ²¡æœ‰å‘ç”Ÿä»»ä½•å˜åŒ–ã€‚ç”±äº self æ²¡æœ‰è¢« block å¼ºåº”ç”¨ï¼Œæ‰€ä»¥å½“ self è¦è¢«é‡Šæ”¾çš„æ—¶å€™ï¼Œblock ä¹Ÿä¼šè¢«é‡Šæ”¾ï¼Œè¿™å°±è§£å†³äº†æˆ‘ä»¬ ğŸŒ°1 ä¸­çš„å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ä½†æ˜¯åœ¨ block æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œself å¯¹è±¡æœ‰å¯èƒ½å·²ç»è¢«é‡Šæ”¾äº†ï¼Œæ­¤æ—¶å¦‚æœä½ è¿˜å»ä½¿ç”¨ weakSelf å°±æœ‰å¯èƒ½é€ æˆå¥”æºƒçš„æƒ…å†µã€‚</p>
<hr>
<p>ğŸŒ°3 çš„ C ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">struct __BlockTest__test_block_impl_0 &#123;</span><br><span class="line">    struct __block_impl impl;</span><br><span class="line">    struct __BlockTest__test_block_desc_0* Desc;</span><br><span class="line">    BlockTest *const __weak weakSelf;</span><br><span class="line">    __BlockTest__test_block_impl_0(void *fp, struct __BlockTest__test_block_desc_0 *desc, BlockTest *const __weak _weakSelf, int flags=0) : weakSelf(_weakSelf) &#123;</span><br><span class="line">        impl.isa = &amp;_NSConcreteStackBlock;</span><br><span class="line">        impl.Flags = flags;</span><br><span class="line">        impl.FuncPtr = fp;</span><br><span class="line">        Desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">static void __BlockTest__test_block_func_0(struct __BlockTest__test_block_impl_0 *__cself) &#123;</span><br><span class="line">    BlockTest *const __weak weakSelf = __cself-&gt;weakSelf; // bound by copy</span><br><span class="line">    __attribute__((objc_ownership(strong))) typeof(self) strongSelf = weakSelf;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static void __BlockTest__test_block_copy_0(struct __BlockTest__test_block_impl_0*dst, struct __BlockTest__test_block_impl_0*src) &#123;_Block_object_assign((void*)&amp;dst-&gt;weakSelf, (void*)src-&gt;weakSelf, 3/*BLOCK_FIELD_IS_OBJECT*/);&#125;</span><br><span class="line"></span><br><span class="line">static void __BlockTest__test_block_dispose_0(struct __BlockTest__test_block_impl_0*src) &#123;_Block_object_dispose((void*)src-&gt;weakSelf, 3/*BLOCK_FIELD_IS_OBJECT*/);&#125;</span><br><span class="line"></span><br><span class="line">static struct __BlockTest__test_block_desc_0 &#123;</span><br><span class="line">    size_t reserved;</span><br><span class="line">    size_t Block_size;</span><br><span class="line">    void (*copy)(struct __BlockTest__test_block_impl_0*, struct __BlockTest__test_block_impl_0*);</span><br><span class="line">    void (*dispose)(struct __BlockTest__test_block_impl_0*);</span><br><span class="line">&#125; __BlockTest__test_block_desc_0_DATA = &#123; 0, sizeof(struct __BlockTest__test_block_impl_0), __BlockTest__test_block_copy_0, __BlockTest__test_block_dispose_0&#125;;</span><br><span class="line"></span><br><span class="line">static void _I_BlockTest_test(BlockTest * self, SEL _cmd) &#123;</span><br><span class="line">    __attribute__((objc_ownership(weak))) typeof(self) weakSelf = self;</span><br><span class="line">    ((void (*)(id, SEL, void (*)()))(void *)objc_msgSend)((id)self, sel_registerName(&quot;setBlock:&quot;), ((void (*)())&amp;__BlockTest__test_block_impl_0((void *)__BlockTest__test_block_func_0, &amp;__BlockTest__test_block_desc_0_DATA, weakSelf, 570425344)));</span><br><span class="line">    ((void (*(*)(id, SEL))())(void *)objc_msgSend)((id)self, sel_registerName(&quot;block&quot;))();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>å‰é¢çš„æ­¥éª¤éƒ½è·Ÿ ğŸŒ°2 ä¸­çš„ä¸€æ ·ï¼Œå…³é”®æ˜¯åœ¨ Block çš„æ–¹æ³•å®ç°é‡Œé¢æœ‰ç‚¹ä¸ä¸€æ ·ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ <code>__BlockTest__test_block_func_0</code>ï¼Œå®ƒé¦–å…ˆè°ƒç”¨äº† <code>BlockTest *const __weak weakSelf = __cself-&gt;weakSelf</code>ï¼Œ æ‰€ä»¥å®ƒæ­¤æ—¶çš„å¼•ç”¨è®¡æ•°ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼›ä½†æ˜¯æ¥ä¸‹æ¥åˆç”¨ <code>objc_ownership(strong)</code> æ¥å¼ºå¼•ç”¨ weakSelfï¼Œæ‰€ä»¥æ­¤æ—¶ self çš„å¼•ç”¨è®¡æ•° +1ã€‚è¿™å°±ä¿è¯äº†åœ¨å‡½æ•°æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼ŒBlock ä¼šä¸€ç›´æŒæœ‰ selfï¼ŒçŸ¥é“ Block æ‰§è¡Œå®Œæ¯•ä¹‹åä¼šé‡Šæ”¾ weakSelfã€‚</p>
<p>æ‰€ä»¥ ğŸŒ°3 å®Œç¾çš„è§£å†³äº†å¾ªç¯åº”ç”¨å’Œç›´æ¥ä½¿ç”¨ <code>__weak</code> å¯èƒ½å¯¼è‡´å¥”æºƒçš„é—®é¢˜ã€‚</p>
<hr>
<p>æœ€åï¼Œè¯´ä¸€ä¸‹å…³äº _Block_object_assign çš„çŒœæƒ³ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_Block_object_assign((void*)&amp;dst-&gt;weakSelf, (void*)src-&gt;weakSelf, 3/*BLOCK_FIELD_IS_OBJECT*/);</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬çŸ¥é“ Block åœ¨æ„é€ çš„æ—¶å€™å°±ä¼šå¯¹æ•è·çš„å˜é‡è¿›è¡Œå†…å­˜ç®¡ç†ï¼ˆå¼ºå¼•ç”¨å’Œå¼±å¼•ç”¨ï¼‰ï¼Œæ‰€ä»¥å½“ Block åœ¨åš Copy æ“ä½œçš„æ—¶å€™å…¶å®æ²¡æœ‰å¿…è¦å¯¹å®ƒæ•è·çš„å˜é‡å†åšä¸€éå†…å­˜ç®¡ç†äº†ã€‚è¿™ä¹Ÿåº”è¯¥æ˜¯ Block çš„ Copy æ“ä½œä½¿ç”¨äº† <code>_Block_object_assign</code> è¿™ç§ä¸ä¼šå¯¼è‡´å¼•ç”¨è®¡æ•°å‘ç”Ÿå˜åŒ–çš„æ–¹å¼æ¥å®ç°çš„åŸå› ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://hparis.github.io/blog/2018/04/02/%E5%A6%82%E4%BD%95%E7%94%A8-Objective-C-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%AD%BB%E9%94%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="å¸•å¸•">
      <meta itemprop="description" content="å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¸•å¸•'s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/04/02/%E5%A6%82%E4%BD%95%E7%94%A8-Objective-C-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%AD%BB%E9%94%81/" class="post-title-link" itemprop="url">å¦‚ä½•ç”¨ Objective-C å®ç°ä¸€ä¸ªæ­»é”</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-04-01 20:29:42" itemprop="dateCreated datePublished" datetime="2018-04-01T20:29:42Z">2018-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 07:08:33" itemprop="dateModified" datetime="2022-04-20T07:08:33Z">2022-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>å½“ç³»ç»Ÿå­˜åœ¨ä¸¤ä¸ªçº¿ç¨‹åŠä»¥ä¸Šçš„æ—¶å€™ï¼ŒåŒæ–¹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹åœæ­¢æ‰§è¡Œï¼Œä»¥è·å¾—ç³»ç»Ÿèµ„æºï¼Œä½†æ˜¯æ²¡æœ‰ä¸€æ–¹æå‰é€€å‡ºçš„æ—¶å€™å°±å«åšæ­»é”ã€‚</p>
</blockquote>
<p>é‚£åœ¨ Objective-C é‡Œé¢å¦‚ä½•å®ç°æ­»é”å‘¢ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">self.lock1 = [NSLock new];</span><br><span class="line">self.lock2 = [NSLock new];</span><br><span class="line">    </span><br><span class="line">dispatch_async(dispatch_queue_create(&quot;com.papa.task1&quot;, DISPATCH_QUEUE_SERIAL), ^&#123;</span><br><span class="line">    [self.lock1 lock];</span><br><span class="line">    NSLog(@&quot;task1 è·å¾— lock1&quot;);</span><br><span class="line">    sleep(2);</span><br><span class="line">    [self.lock2 lock];</span><br><span class="line">    NSLog(@&quot;task1 è·å¾— lock2&quot;);</span><br><span class="line">    [self.lock2 unlock];</span><br><span class="line">    [self.lock1 unlock];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_async(dispatch_queue_create(&quot;com.papa.task2&quot;, DISPATCH_QUEUE_SERIAL), ^&#123;</span><br><span class="line">    [self.lock2 lock];</span><br><span class="line">    NSLog(@&quot;task2 è·å¾— lock2&quot;);</span><br><span class="line">    sleep(2);</span><br><span class="line">    [self.lock1 lock];</span><br><span class="line">    NSLog(@&quot;task2 è·å¾— lock1&quot;);</span><br><span class="line">    [self.lock1 unlock];</span><br><span class="line">    [self.lock2 unlock];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€åæ§åˆ¶å°è¾“å‡ºçš„ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">task2 è·å¾— lock2</span><br><span class="line">task1 è·å¾— lock1</span><br></pre></td></tr></table></figure>

<p>æˆ–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">task2 è·å¾— lock2</span><br><span class="line">task1 è·å¾— lock1</span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆæ˜¯ä¸¤ç§ç»“æœå‘¢ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„<a href="https://hparis.github.io/blog/2017/09/05/%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3GCD/">ã€Œåˆæ­¥äº†è§£ GCDã€</a>ã€‚</p>
<p>ä½†æ˜¯ä¸ç®¡å¦‚ä½•ï¼Œè¿™ä¸¤ç§ç»“æœéƒ½æ²¡æœ‰è¾“å‡º <code>task1 è·å¾— lock2</code> æˆ– <code>task2 è·å¾— lock1</code>ã€‚æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼š</p>
<ul>
<li>task1 è·å¾— lock1ï¼Œç„¶åæ²‰ç¡ 2s</li>
<li>task2 è·å¾— lock2ï¼Œç„¶åæ²‰ç¡ 2s</li>
<li>task1 ç»è¿‡ 2s çš„æ²‰ç¡ä¹‹åæƒ³è¦å»è·å– lock2ï¼Œæ­¤æ—¶å‘ç° lock2 å·²ç»è¢«ä½¿ç”¨ï¼Œé‚£å°±ç»§ç»­ç­‰å¾…</li>
<li>task2 ç»è¿‡ 2s çš„æ²‰ç¡ä¹‹åæƒ³è¦å»è·å– lock1ï¼Œæ­¤æ—¶å‘ç° lock1 å·²ç»è¢«ä½¿ç”¨ï¼Œé‚£å°±ç»§ç»­ç­‰å¾…</li>
<li>task1 åˆè¢«å”¤é†’æƒ³è¦å»è·å– lock2ï¼Œæ­¤æ—¶ lock2 ä¾æ—§æ²¡æœ‰è¢« task2 é‡Šæ”¾ï¼Œåªèƒ½ç»§ç»­ç­‰å¾…</li>
<li>task2 åˆè¢«å”¤é†’æƒ³è¦å»è·å– lock1ï¼Œæ­¤æ—¶ lock1 ä¾æ—§æ²¡æœ‰è¢« task1 é‡Šæ”¾ï¼Œåªèƒ½ç»§ç»­ç­‰å¾…</li>
<li>â€¦</li>
<li>â€¦</li>
</ul>
<p>äºæ˜¯ task1 å’Œ task2 éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œä½†æ˜¯è‡ªå·±ä¹Ÿä¸é€€å‡ºä¹Ÿä¸é‡Šæ”¾èµ„æºï¼Œæœ€ç»ˆå¯¼è‡´æ­»é”çš„äº§ç”Ÿã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥è®¨è®ºå¦å¤–ä¸€ä¸ªä¾‹å­æ˜¯ä¸æ˜¯æ­»é”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// æŸä¸ªæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶</span><br><span class="line">- (void)onClick:(UIEvent *)event &#123;</span><br><span class="line">    dispatch_sync(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        ...    </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ä¸Šé¢è¿™ä¸ªä¾‹å­ä¼šå¯¼è‡´ä¸»çº¿ç¨‹å‘ç”Ÿé˜»å¡çš„ç°è±¡ï¼Œä½†æ˜¯è¿™æ˜¯å› ä¸ºæ­»é”é€ æˆçš„ä¹ˆï¼Ÿ</p>
<blockquote>
<p>Submits a block to a dispatch queue for synchronous execution. Unlike dispatch_async, this function does not return until the block has finished. Calling this function and targeting the current queue results in deadlock.</p>
</blockquote>
<p>åœ¨å®˜æ–¹æ–‡æ¡£é‡Œé¢æ˜ç¡®çš„è¯´äº†ï¼Œè¿™å°±æ˜¯æ­»é”ã€‚æˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ä¾‹å­â€œç¿»è¯‘â€ä¸€ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// é¦–å…ˆè¿›å…¥ onClick çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ­¤æ—¶æ˜¯éœ€è¦åŠ é”çš„</span><br><span class="line">// æŸä¸ªæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶</span><br><span class="line">- (void)onClick:(UIEvent *)event &#123;</span><br><span class="line">    [self.lock1 lock];</span><br><span class="line">    </span><br><span class="line">    // æ­¤æ—¶æˆ‘ä»¬å¯ä»¥è®¤ä¸º dispatch_sync æ˜¯åœ¨è·å– block é‡Œé¢çš„ lock2 </span><br><span class="line">    &#123;</span><br><span class="line">        [self.lock2 lock];</span><br><span class="line">        </span><br><span class="line">        // æ”¾åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œé‚£ä¹ˆå®ƒä¹Ÿéœ€è¦è·å¾— lock1 </span><br><span class="line">        [self.lock1 lock];</span><br><span class="line">        [self.lock1 unlock];</span><br><span class="line">        </span><br><span class="line">        [self.lock2 unlock];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [self.lock1 unlock];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶å®ä¸Šé¢çš„æƒ…å†µå°±æ˜¯ä¸¤ä¸ªä»»åŠ¡éƒ½åœ¨åŒæ—¶ç«äº‰ä¸»çº¿ç¨‹çš„èµ„æºï¼Œå¹¶ä¸”è°éƒ½æ²¡æœ‰é€€å‡ºæœ€ç»ˆå¯¼è‡´æ­»é”çš„äº§ç”Ÿã€‚ä½†æ˜¯è¿™ä¸¤ä¸ªä»»åŠ¡å¹¶ä¸æ˜¯æ™®é€šçš„ä¸¤ä¸ªçº¿ç¨‹åœ¨ç«äº‰èµ„æºï¼Œè€Œæ˜¯éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šï¼Œä¸€ä¸ªåµŒå¥—å¦å¤–ä¸€ä¸ªã€‚è€Œä¸”è¿™ç§ç‰¹æ®Šçš„æƒ…å†µï¼Œåœ¨è¿è¡Œçš„æ—¶å€™ä¼šç›´æ¥å¯¼è‡´å¥”æºƒï¼Œè€Œä¸åƒæˆ‘ä»¬ä¸€å¼€å§‹çš„ä¾‹å­ä¸€æ ·åªæ˜¯åœ¨äº’ç›¸ç­‰å¾…ã€‚ä½†æ˜¯æ—¢ç„¶è‹¹æœæŠŠè¿™ç§æƒ…å†µä¹Ÿç§°ä¸ºæ­»é”ï¼Œé‚£æˆ‘ä»¬å°±å½“åšæ­»é”æ¥çœ‹å¾…ï¼Œæ¯•ç«Ÿä»–ä»¬éƒ½æ˜¯åœ¨ç«äº‰ç³»ç»Ÿèµ„æºã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://hparis.github.io/blog/2018/03/24/%E8%AF%B4%E8%AF%B4-Objective-C-%E4%B8%AD%E7%9A%84-Copy-%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="å¸•å¸•">
      <meta itemprop="description" content="å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¸•å¸•'s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/03/24/%E8%AF%B4%E8%AF%B4-Objective-C-%E4%B8%AD%E7%9A%84-Copy-%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">è¯´è¯´ Objective-C ä¸­çš„ Copy æ“ä½œ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-03-23 16:35:55" itemprop="dateCreated datePublished" datetime="2018-03-23T16:35:55Z">2018-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 07:08:33" itemprop="dateModified" datetime="2022-04-20T07:08:33Z">2022-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="æµ…æ‹·è´ï¼ˆShallow-copiesï¼‰å’Œæ·±æ‹·è´ï¼ˆDeep-copiesï¼‰"><a href="#æµ…æ‹·è´ï¼ˆShallow-copiesï¼‰å’Œæ·±æ‹·è´ï¼ˆDeep-copiesï¼‰" class="headerlink" title="æµ…æ‹·è´ï¼ˆShallow copiesï¼‰å’Œæ·±æ‹·è´ï¼ˆDeep copiesï¼‰"></a>æµ…æ‹·è´ï¼ˆShallow copiesï¼‰å’Œæ·±æ‹·è´ï¼ˆDeep copiesï¼‰</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ Objective-C ä¸­æŠŠ Copy æ“ä½œåˆ†æˆä¸¤ç§ï¼š<code>æµ…æ‹·è´ï¼ˆShallow copiesï¼‰</code>å’Œ<code>æ·±æ‹·è´ï¼ˆDeep copiesï¼‰</code>ã€‚å­¦è¿‡ C è¯­è¨€çš„åŒå­¦åº”è¯¥çŸ¥é“åŒºåˆ†è¿™ä¸¤ç§æ“ä½œçš„åŒºåˆ«å…¶å®å¾ˆç®€å•ï¼š</p>
<blockquote>
<p>æµ…æ‹·è´ï¼ˆShallow copiesï¼‰: æŒ‡é’ˆæ‹·è´ï¼ŒæŒ‡å‘çš„è¿˜æ˜¯åŒä¸€å—å†…å®¹çš„åœ°å€<br>æ·±æ‹·è´ï¼ˆDeep copiesï¼‰: å†…å®¹æ‹·è´</p>
</blockquote>
<p>ä½†æ˜¯åœ¨ Objective-C é‡Œé¢å¯¹äº Copy çš„å®ç°è¿˜æ˜¯è·Ÿ C è¯­è¨€çš„æœ‰ç‚¹å·®åˆ«ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Apple çš„å®˜æ–¹æ–‡æ¡£ç»™å‡ºçš„ä¸€å¼ å›¾ï¼š</p>
<p><img src="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Collections/Art/CopyingCollections_2x.png" alt="Collections Programming Topics"></p>
<p>é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹å‡º<code>æµ…æ‹·è´</code>è¿‡åï¼ŒArray 1 å’Œ Array 2 çš„å…ƒç´ éƒ½æ˜¯ç›¸åŒçš„æŒ‡é’ˆåœ°å€ï¼ŒæŒ‡å‘ç›¸åŒçš„å†…å®¹ï¼›<code>æ·±æ‹·è´</code>è¿‡åï¼Œå†…å®¹è¢«æ‹·è´ä¸€ä»½æ–°çš„å‡ºæ¥ï¼ŒArray 2 çš„å…ƒç´ çš„æŒ‡é’ˆåœ°å€éƒ½å’Œ Array 1 ä¸ä¸€æ ·ï¼Œå› ä¸º Array2 çš„å…ƒç´ çš„æŒ‡é’ˆåœ°å€éƒ½æŒ‡å‘æ–°çš„å†…å®¹ã€‚</p>
<h2 id="immutable-å’Œ-mutable-å¯¹è±¡çš„æ‹·è´"><a href="#immutable-å’Œ-mutable-å¯¹è±¡çš„æ‹·è´" class="headerlink" title="immutable å’Œ mutable å¯¹è±¡çš„æ‹·è´"></a>immutable å’Œ mutable å¯¹è±¡çš„æ‹·è´</h2><p>åœ¨ Objective-C ä¸­ä¸€èˆ¬ä¼šç”¨ copy æˆ– mutableCopy è¿›è¡Œæ‹·è´æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è§‚å¯ŸæŒ‡é’ˆå˜åŒ–æ¥ç¡®å®šè¿™ä¸¤ç§æ‹·è´æ“ä½œæ˜¯<code>æµ…å¤åˆ¶</code>è¿˜æ˜¯<code>æ·±å¤åˆ¶</code>ã€‚</p>
<ul>
<li><p>immutable å¯¹è±¡çš„å¤åˆ¶æ“ä½œ</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NSString * aName = @&quot;å¸•å¸•&quot;;</span><br><span class="line">NSString * bName = [aName copy];</span><br><span class="line">NSMutableString * cName = [aName mutableCopy];</span><br><span class="line"></span><br><span class="line">NSLog(@&quot;aName çš„æŒ‡é’ˆï¼š%p&quot;, aName);</span><br><span class="line">NSLog(@&quot;bName çš„æŒ‡é’ˆï¼š%p&quot;, bName);</span><br><span class="line">NSLog(@&quot;cName çš„æŒ‡é’ˆï¼š%p&quot;, cName);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>  è¾“å‡ºçš„ç»“æœï¼š</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aName çš„æŒ‡é’ˆï¼š0x103d34070</span><br><span class="line">bName çš„æŒ‡é’ˆï¼š0x103d34070</span><br><span class="line">cName çš„æŒ‡é’ˆï¼š0x600000250dd0</span><br></pre></td></tr></table></figure>
</li>
<li><p>mutable å¯¹è±¡çš„å¤åˆ¶æ“ä½œ</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NSMutableString * aName = [NSMutableString stringWithString:@&quot;å¸•å¸•&quot;];</span><br><span class="line">NSString * bName = [aName copy];</span><br><span class="line">NSMutableString * cName = [aName mutableCopy];</span><br><span class="line"></span><br><span class="line">NSLog(@&quot;aName çš„æŒ‡é’ˆï¼š%p&quot;, aName);</span><br><span class="line">NSLog(@&quot;bName çš„æŒ‡é’ˆï¼š%p&quot;, bName);</span><br><span class="line">NSLog(@&quot;cName çš„æŒ‡é’ˆï¼š%p&quot;, cName);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>  è¾“å‡ºçš„ç»“æœï¼š</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aName çš„æŒ‡é’ˆï¼š0x60000025e150</span><br><span class="line">bName çš„æŒ‡é’ˆï¼š0x600000222900</span><br><span class="line">cName çš„æŒ‡é’ˆï¼š0x60000025e450</span><br></pre></td></tr></table></figure></li>
</ul>
<p>é€šè¿‡ä¸Šé¢ä¸¤ä¸ªä¾‹å­ä»¥åŠå®ƒä»¬çš„è¾“å‡ºç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸‹é¢è¿™ä¸ªè¡¨æ ¼ï¼š</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">imutable å¯¹è±¡</th>
<th align="center">mutable å¯¹è±¡</th>
</tr>
</thead>
<tbody><tr>
<td align="center">copy</td>
<td align="center">æµ…å¤åˆ¶</td>
<td align="center">æ·±å¤åˆ¶</td>
</tr>
<tr>
<td align="center">mutableCopy</td>
<td align="center">æ·±å¤åˆ¶</td>
<td align="center">æ·±å¤åˆ¶</td>
</tr>
</tbody></table>
<p>ä¸Šé¢çš„è§„åˆ™å¯¹é›†åˆå¯¹è±¡ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼šNSArray å’Œ NSMutableArrayï¼ŒNSDictionary å’Œ NSMutableDictionaryï¼ŒNSSet å’Œ NSMutableSet</p>
<h2 id="å•å±‚æ·±å¤åˆ¶ï¼ˆone-level-deepï¼‰"><a href="#å•å±‚æ·±å¤åˆ¶ï¼ˆone-level-deepï¼‰" class="headerlink" title="å•å±‚æ·±å¤åˆ¶ï¼ˆone-level-deepï¼‰"></a>å•å±‚æ·±å¤åˆ¶ï¼ˆone-level-deepï¼‰</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">NSMutableString * aString = [NSMutableString stringWithString:@&quot;Hello&quot;]</span><br><span class="line"></span><br><span class="line">NSMutableArray * aArray = [NSMutableArray arrayWithObjects:aString, nil];</span><br><span class="line">NSArray * bArray = [aArray copy];</span><br><span class="line"></span><br><span class="line">NSMutableString * bString = bArray[0];</span><br><span class="line">[bString appendString:@&quot; å¸•å¸•&quot;];</span><br><span class="line">    </span><br><span class="line">NSLog(@&quot;aArray çš„æŒ‡é’ˆï¼š%p&quot;, aName);</span><br><span class="line">NSLog(@&quot;bArray çš„æŒ‡é’ˆï¼š%p&quot;, bName);</span><br><span class="line">NSLog(@&quot;aArray ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: %pï¼Œå†…å®¹ï¼š%@&quot;, aArray[0], aArray[0]);</span><br><span class="line">NSLog(@&quot;bArray ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: %pï¼Œå†…å®¹ï¼š%@&quot;, bArray[0], bArray[0]);</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aArray çš„æŒ‡é’ˆï¼š0x60000025d9a0</span><br><span class="line">bArray çš„æŒ‡é’ˆï¼š0x60000002cf60</span><br><span class="line">aArray ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: 0x60000025d880ï¼Œå†…å®¹ï¼šHello å¸•å¸•</span><br><span class="line">bArray ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: 0x60000025d880ï¼Œå†…å®¹ï¼šHello å¸•å¸•</span><br></pre></td></tr></table></figure>

<p>ä» aArray åˆ° bArray çš„ copy æ“ä½œä¹‹åï¼Œå®ƒä»¬çš„æŒ‡é’ˆåœ°å€å‘ç”Ÿäº†å˜åŒ–ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„ç†è§£è¿™æ˜¯<code>æ·±æ‹·è´</code>ã€‚<code>æ·±æ‹·è´</code>ä¼šæŠŠ aArray çš„å…ƒç´ éƒ½æ‹·è´ä¸€ä»½ï¼Œé‚£ä¸ºä»€ä¹ˆæ”¹å˜ bArray çš„å…ƒç´ çš„å€¼ä¼šå¯¼è‡´ aArray çš„å…ƒç´ çš„å€¼ä¹Ÿå‘ç”Ÿäº†å˜åŒ–å‘¢ï¼Ÿ</p>
<p><img src="https://i.imgur.com/svn3AbQ.png" alt="é›†åˆå¯¹è±¡çš„æ·±æ‹·è´"></p>
<h2 id="å®Œå…¨æ·±å¤åˆ¶"><a href="#å®Œå…¨æ·±å¤åˆ¶" class="headerlink" title="å®Œå…¨æ·±å¤åˆ¶"></a>å®Œå…¨æ·±å¤åˆ¶</h2><p>é‚£æˆ‘ä»¬è¦å¦‚ä½•åšåˆ°çœŸæ­£çš„æ·±å¤åˆ¶å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç®€å•çš„æŠŠä¸Šé¢çš„ä»£ç æ”¹ä¸€ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">NSMutableString * aString = [NSMutableString stringWithString:@&quot;Hello&quot;]</span><br><span class="line"></span><br><span class="line">NSMutableArray * aArray = [NSMutableArray arrayWithObjects:aString, nil];</span><br><span class="line"></span><br><span class="line">// åªéœ€è¦æ”¹åŠ¨è¿™ä¸€è¡Œä»£ç </span><br><span class="line">NSArray *bArray = [NSKeyedUnarchiver unarchiveObjectWithData:[NSKeyedArchiver archivedDataWithRootObject:aArray]];</span><br><span class="line"></span><br><span class="line">NSMutableString * bString = bArray[0];</span><br><span class="line">[bString appendString:@&quot; å¸•å¸•&quot;];</span><br><span class="line">    </span><br><span class="line">NSLog(@&quot;aArray çš„æŒ‡é’ˆï¼š%p&quot;, aName);</span><br><span class="line">NSLog(@&quot;bArray çš„æŒ‡é’ˆï¼š%p&quot;, bName);</span><br><span class="line">NSLog(@&quot;aArray ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: %pï¼Œå†…å®¹ï¼š%@&quot;, aArray[0], aArray[0]);</span><br><span class="line">NSLog(@&quot;bArray ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: %pï¼Œå†…å®¹ï¼š%@&quot;, bArray[0], bArray[0]);</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aArray çš„æŒ‡é’ˆï¼š0x600000259cb0</span><br><span class="line">bArray çš„æŒ‡é’ˆï¼š0x600000030ac0</span><br><span class="line">aArray ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: 0x604000452120ï¼Œå†…å®¹ï¼šHello</span><br><span class="line">bArray ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ: 0x604000452780ï¼Œå†…å®¹ï¼šHello å¸•å¸•</span><br></pre></td></tr></table></figure>

<p>åªè¦å…ˆå¯¹é›†åˆå¯¹è±¡åˆ†åˆ«ç”¨ NSKeyedArchiver å’Œ NSKeyedUnarchiver å°±å¯ä»¥çœŸæ­£å®Œæˆå¯¹ä¸€ä¸ªé›†åˆå¯¹è±¡çš„æ·±å¤åˆ¶ã€‚</p>
<h2 id="Copy-å’Œ-å†…å­˜ç®¡ç†"><a href="#Copy-å’Œ-å†…å­˜ç®¡ç†" class="headerlink" title="Copy å’Œ å†…å­˜ç®¡ç†"></a>Copy å’Œ å†…å­˜ç®¡ç†</h2><p>ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ Objective-C é‡Œé¢å¯¹äº Copy çš„å®ç°è¿˜æ˜¯è·Ÿ C è¯­è¨€çš„æœ‰ç‚¹å·®åˆ«ï¼Œé‚£å·®åˆ«åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿ<br>å†…å­˜ä¸­åšå¤åˆ¶æ“ä½œæ˜¯å¾ˆè€—è´¹èµ„æºçš„ï¼Œè€Œæˆ‘ä»¬éƒ½çŸ¥é“ Objective-C é«˜æ•ˆçš„ä¸€ä¸ªåŸå› åœ¨äºå®ƒçš„å†…å­˜ç®¡ç†æœºåˆ¶æ˜¯<code>å¼•ç”¨è®¡æ•°</code>ã€‚æˆ‘ä»¬å‰é¢åˆ†æçš„<code>æ·±æ‹·è´</code>æ˜¯å¯¹å†…å®¹çš„æ‹·è´ï¼Œè¿™ä¸€ç‚¹è·Ÿ C è¯­è¨€çš„ä¸€æ ·ã€‚C è¯­è¨€çš„<code>æµ…æ‹·è´</code>æ˜¯æŒ‡é’ˆçš„æ‹·è´ï¼Œå®ƒä¾æ—§åšäº†ä¸€æ¬¡å¤åˆ¶æ“ä½œã€‚è€Œåœ¨ Objective-C ä¸­ï¼Œ<code>æµ…æ‹·è´</code>å…¶å®åªæ˜¯å¼•ç”¨è®¡æ•°çš„å¢åŠ ï¼Œä¸ä¿¡çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NSArray * aArray = [NSArray arrayWithObjects:@&quot;å¸•å¸•&quot;, nil];</span><br><span class="line">NSLog(@&quot;aArray çš„æŒ‡é’ˆï¼š%pï¼Œå¼•ç”¨è®¡æ•°ï¼š%ld&quot;, aArray, CFGetRetainCount((__bridge CFTypeRef)(aArray)));</span><br><span class="line">NSArray * bArray = [aArray copy];</span><br><span class="line">NSLog(@&quot;aArray çš„æŒ‡é’ˆï¼š%pï¼Œå¼•ç”¨è®¡æ•°ï¼š%ld&quot;, aArray, CFGetRetainCount((__bridge CFTypeRef)(aArray)));</span><br><span class="line">NSMutableArray * cArray = [aArray mutableCopy];</span><br><span class="line">NSLog(@&quot;aArray çš„æŒ‡é’ˆï¼š%pï¼Œå¼•ç”¨è®¡æ•°ï¼š%ld&quot;, aArray, CFGetRetainCount((__bridge CFTypeRef)(aArray)));</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aArray çš„æŒ‡é’ˆï¼š0x604000443ba0ï¼Œå¼•ç”¨è®¡æ•°ï¼š2</span><br><span class="line">aArray çš„æŒ‡é’ˆï¼š0x604000443ba0ï¼Œå¼•ç”¨è®¡æ•°ï¼š3</span><br><span class="line">aArray çš„æŒ‡é’ˆï¼š0x604000443ba0ï¼Œå¼•ç”¨è®¡æ•°ï¼š3</span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆ aArray åˆšå‡ºæ¥çš„æ—¶å€™çš„å¼•ç”¨è®¡æ•°æ˜¯ 2ï¼Ÿå› ä¸º <code>[NSArray arrayWithObjects:@&quot;å¸•å¸•&quot;, nil]</code> æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„å¼•ç”¨è®¡æ•°å°±æ˜¯ 1ï¼›ç„¶åæˆ‘ä»¬åˆå®šä¹‰äº† aArray æ¥å¼•ç”¨è¿™ä¸ªå¯¹è±¡ï¼Œæ­¤æ—¶å®ƒçš„å¼•ç”¨è®¡æ•°å°±å¢åŠ äº† 1ï¼Œå˜æˆäº† 2ï¼›ä¹‹åæˆ‘ä»¬å¯¹ aArray è¿›è¡Œäº† copy æ“ä½œï¼Œå‘ç°å®ƒçš„å¼•ç”¨è®¡æ•°å˜æˆäº† 3ï¼Œæ‰€ä»¥è¿™é‡Œçš„ copy æ“ä½œå…¶å®ç›¸å½“äº retaionï¼›æœ€æœ‰æˆ‘ä»¬å¯¹ aArray è¿›è¡Œäº† mutableCopy æ“ä½œï¼Œæ­¤æ—¶å®ƒçš„å¼•ç”¨è®¡æ•°è¿˜æ˜¯ 3ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™è¿›è¡Œäº†å†…å®¹å¤åˆ¶ã€‚</p>
<p>æ‰€ä»¥åœ¨ Objective-C ä¸­å¯¹ä¸€ä¸ª imutable å¯¹è±¡è¿›è¡Œçš„ copyï¼ˆæµ…å¤åˆ¶ï¼‰æ“ä½œï¼Œå…¶å®éƒ½åªä¼šå¼•èµ·å¼•ç”¨è®¡æ•°çš„å˜åŒ–ï¼Œè€Œä¸ä¼šåœ¨å†…å­˜ä¸­åšå‡ºä»»ä½•æ‹·è´æ“ä½œï¼ŒåŒ…æ‹¬æŒ‡é’ˆæ‹·è´ã€‚</p>
<h2 id="NSCopying-å’Œ-NSMutableCopying"><a href="#NSCopying-å’Œ-NSMutableCopying" class="headerlink" title="NSCopying å’Œ NSMutableCopying"></a>NSCopying å’Œ NSMutableCopying</h2><p>å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯¹å…¶è¿›è¡Œ copy æ“ä½œçš„è¯ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// Person</span><br><span class="line">@interface Person: NSObject</span><br><span class="line">@property (nonatomic, copy) NSString * name;</span><br><span class="line">@end</span><br><span class="line">@implementation Person</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">Person * aPerson = [Person new];</span><br><span class="line">Person * bPerson = [aPerson copy];</span><br></pre></td></tr></table></figure>

<p>Xcode ç›´æ¥å¥”æºƒäº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å´©æºƒ</span><br><span class="line">*** Terminating app due to uncaught exception &#x27;NSInvalidArgumentException&#x27;, reason: &#x27;-[Person copyWithZone:]: unrecognized selector sent to instance 0x60000000d5f0&#x27;</span><br></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯¹ä¸€ä¸ª Person å¯¹è±¡ä½¿ç”¨äº† copyï¼ŒXcode ç¡®æŠ¥çš„æ˜¯æ‰¾ä¸åˆ° <code>copyWithZone:</code> è¿™ä¸ª selector çš„é”™è¯¯ã€‚</p>
<p>è¿™æ˜¯å› ä¸º Objective-C ä¸­è§„å®šï¼Œä¸€ä¸ªå¯¹è±¡å¦‚æœæƒ³è¦ä½¿ç”¨ copy æˆ– mutableCopy çš„æ“ä½œï¼Œå¿…é¡»è¦å®ç° <code>NSCopying</code> æˆ– <code>NSMutableCopying</code> è¿™ä¸¤ä¸ªåè®®ã€‚è¿™ä¸¤ä¸ªåè®®è§„å®šäº†å¯¹è±¡éœ€è¦å®ç° <code>copyWithZone:</code> æˆ– <code>mutableCopyWithZone:</code> è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå› ä¸ºå¯¹ä¸€ä¸ªå¯¹è±¡åš copy æˆ– mutableCopy æœ€åéƒ½ä¼šå»è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•æ¥åšæœ€ç»ˆçš„å®ç°ã€‚<br>ä¸Šé¢ä¾‹å­ä¸­çš„é›†åˆå¯¹è±¡èƒ½å¤Ÿä½¿ç”¨ copy å’Œ mutableCopy æ“ä½œæ˜¯ä¹Ÿå› ä¸ºå®ƒä»¬éƒ½å®ç°äº† NSCopying å’Œ NSMutableCopying åè®®ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å¯¹ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡å®ç° NSCopying åè®®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@interface Person: NSObject &lt;NSCopying&gt;</span><br><span class="line">@property (nonatomic, copy) NSString * name;</span><br><span class="line">@property (nonatomic, strong) NSMutableArray * mArray;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation Person</span><br><span class="line">- (instancetype)copyWithZone:(NSZone *)zone &#123;</span><br><span class="line">    Person * person = [[self class] new];</span><br><span class="line">    person.name = [self.name copy];</span><br><span class="line">    person.mArray = [self.mArray mutableCopy];</span><br><span class="line">    return person;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨ <code>[Person copy]</code> äº†ã€‚å½“ç„¶ï¼Œè¿™é‡Œ Person çš„ mArray ä¹Ÿåªæ˜¯<code>å•å±‚æ·±å¤åˆ¶</code>ï¼Œå¦‚æœæƒ³è¦å®ç°<code>å®Œå…¨æ·±å¤åˆ¶</code>çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ NSKeyedArchiver å’Œ NSKeyedUnarchiver æ¥å®Œæˆå¯¹ mArray çš„<code>å®Œå…¨æ·±å¤åˆ¶</code>ã€‚</p>
<h2 id="Block-å’Œ-Copy"><a href="#Block-å’Œ-Copy" class="headerlink" title="Block å’Œ Copy"></a>Block å’Œ Copy</h2><p>ç®€å•è¯´ä¸€ä¸‹ï¼Œåœ¨ Objective-C ä¸­ï¼ŒBlock çš„ copy æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ“ä½œã€‚å› ä¸º Block æ˜¯ä¸€ç§ç»“æ„ä½“ï¼Œå®ƒæ— æ³•å®ç° NSCopying æˆ– NSMutableCopying åè®®ï¼Œä½†æ˜¯å®ƒå´å¯ä»¥è°ƒç”¨ copy æ–¹æ³•ã€‚è¿™æ˜¯ç”± Block çš„ç»“æ„ä½“å†³å®šçš„ï¼š</p>
<p><img src="http://www.devtalking.com/postImages/block-struct.jpg"></p>
<p>Block é‡Œé¢çš„ descriptor æœ‰ copy çš„å‡½æ•°æŒ‡é’ˆï¼Œå½“å¯¹ Block æ‰§è¡Œ copy æ“ä½œæœ€åéƒ½ä¼šé€šè¿‡è¯¥å‡½æ•°æŒ‡é’ˆè¿›è¡ŒçœŸæ­£çš„æ“ä½œã€‚è¿™ä¹Ÿæ˜¯ Blocçœ‹ä¸éœ€è¦å®ç° NSCopying å’Œ NSMutableCopying å°±èƒ½è°ƒç”¨ copy æ–¹æ³•çš„åŸå› ã€‚</p>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Collections/Articles/Copying.html">https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Collections/Articles/Copying.html</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zybuluo.com/MicroCai/note/50592">https://www.zybuluo.com/MicroCai/note/50592</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://hparis.github.io/blog/2018/03/20/%E5%A6%82%E4%BD%95%E5%9C%A8-iOS-%E4%B8%8A%E8%87%AA%E5%AE%9A%E4%B9%89-React-Native-Component/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="å¸•å¸•">
      <meta itemprop="description" content="å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¸•å¸•'s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/03/20/%E5%A6%82%E4%BD%95%E5%9C%A8-iOS-%E4%B8%8A%E8%87%AA%E5%AE%9A%E4%B9%89-React-Native-Component/" class="post-title-link" itemprop="url">å¦‚ä½•åœ¨ iOS ä¸Šè‡ªå®šä¹‰ React Native Component</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-03-19 17:22:09" itemprop="dateCreated datePublished" datetime="2018-03-19T17:22:09Z">2018-03-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 07:08:33" itemprop="dateModified" datetime="2022-04-20T07:08:33Z">2022-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>å½“æˆ‘ä»¬è¦åœ¨ iOS ç«¯å®ç°ä¸€ä¸ª React Native å¯ç”¨çš„ Componentï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;MapView onRegionChange=&#123;(event) =&gt; &#123;&#125;&#125; zoomLevel=&#123;2&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬åŸºæœ¬ä¸Šå°±æ˜¯è¦è§£å†³ä¸‹é¢è¿™ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>å¦‚ä½•æŠŠ iOS ä¸Šçš„ UI æš´éœ²ç»™ React Native ç«¯ï¼Ÿ</li>
<li>å¦‚ä½•åœ¨ React Native ç»™ iOS çš„ UI ä¼ å€¼ï¼Ÿ</li>
<li>å¦‚ä½•åœ¨ React Native ä¸­å“åº” iOS çš„äº‹ä»¶ï¼Ÿ</li>
</ul>
<blockquote>
<p>è¿™ä¸‰ä¸ªé—®é¢˜å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://facebook.github.io/react-native/docs/native-components-ios.html">å®˜æ–¹æ–‡æ¡£</a>æ‰¾åˆ°ç­”æ¡ˆã€‚</p>
</blockquote>
<h2 id="å¦‚ä½•æŠŠ-iOS-ä¸Šçš„-UI-æš´éœ²ç»™-React-Native-ç«¯"><a href="#å¦‚ä½•æŠŠ-iOS-ä¸Šçš„-UI-æš´éœ²ç»™-React-Native-ç«¯" class="headerlink" title="å¦‚ä½•æŠŠ iOS ä¸Šçš„ UI æš´éœ²ç»™ React Native ç«¯"></a>å¦‚ä½•æŠŠ iOS ä¸Šçš„ UI æš´éœ²ç»™ React Native ç«¯</h2><p>é¦–å…ˆä½ éœ€è¦åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª <code>RCTViewManager</code> çš„å­ç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// RNTMapManager.m</span><br><span class="line">#import &lt;MapKit/MapKit.h&gt;</span><br><span class="line">#import &lt;React/RCTViewManager.h&gt;</span><br><span class="line"></span><br><span class="line">// ç»§æ‰¿ RCTViewManager</span><br><span class="line">@interface RNTMapManager : RCTViewManager</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@implementation RNTMapManager</span><br><span class="line"></span><br><span class="line">// è°ƒç”¨ RCT_EXPORT_MODULE æš´éœ²è¯¥ç±»çš„åå­—ç»™ React Native ä½¿ç”¨ã€‚å¦‚æœä½ æƒ³è‡ªå®šä¹‰</span><br><span class="line">// æš´éœ²ç»™ React Native çš„åå­—æ—¶ï¼Œä½ éœ€è¦ RCT_EXPORT_MODULE(YOUR_CUSTOM_NAME)ã€‚</span><br><span class="line">RCT_EXPORT_MODULE()</span><br><span class="line"></span><br><span class="line">// ç”±äº RCTViewManager æ˜¯ NSObjectï¼Œæ‰€ä»¥è¿™é‡Œå¿…é¡»éœ€è¦å®ç°è¯¥æ–¹æ³•æ¥å‘Šè¯‰</span><br><span class="line">// React Native å»ä½¿ç”¨å“ªä¸ª UIView</span><br><span class="line">- (UIView *)view</span><br><span class="line">&#123;</span><br><span class="line">  return [MKMapView new];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ React Native ä½¿ç”¨ MapView äº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// MapView.js</span><br><span class="line"></span><br><span class="line">import &#123; requireNativeComponent &#125; from &#x27;react-native&#x27;;</span><br><span class="line"></span><br><span class="line">// requireNativeComponent ä¼šè‡ªåŠ¨æŠŠ iOS ä¸Šçš„ RNTMapManager è§£ææˆ RNTMapã€‚</span><br><span class="line">// å¦‚æœå»æ‰ iOS ä¸Šçš„ Manager åç¼€ä¼šæœ‰ä»€ä¹ˆå½±å“ï¼Ÿå—¯ï¼Œæ²¡æœ‰ä»»ä½•å½±å“ã€‚</span><br><span class="line">module.exports = requireNativeComponent(&#x27;RNTMap&#x27;, null);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// MyApp.js</span><br><span class="line">import MapView from &#x27;./MapView.js&#x27;;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">render() &#123;</span><br><span class="line">  return &lt;MapView /&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¦‚ä½•åœ¨-React-Native-ç»™-iOS-çš„-UI-ä¼ å€¼"><a href="#å¦‚ä½•åœ¨-React-Native-ç»™-iOS-çš„-UI-ä¼ å€¼" class="headerlink" title="å¦‚ä½•åœ¨ React Native ç»™ iOS çš„ UI ä¼ å€¼"></a>å¦‚ä½•åœ¨ React Native ç»™ iOS çš„ UI ä¼ å€¼</h2><p>å¦‚æœéœ€è¦ä¼ å€¼ç»™ iOS ä¸Šçš„ UIï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨å¦å¤–ä¸€ä¸ªå®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RCT_EXPORT_VIEW_PROPERTY(zoomEnabled, BOOL)</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™å°±å¯ä»¥åœ¨ React Native ä¸Šä½¿ç”¨äº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;MapView zoomEnable=&#123;true&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>RCT_EXPORT_VIEW_PROPERTY</code> æ‰€æš´éœ²çš„å±æ€§å¿…é¡»æ˜¯ä¹‹å‰æˆ‘ä»¬è¯´çš„ UIViewï¼ˆå³ç»§æ‰¿äº <code>RCTViewManager</code> å¹¶é€šè¿‡ <code>- (UIView *)view;</code> è¿”å›çš„ Viewï¼‰å·²ç»å­˜åœ¨çš„å±æ€§ã€‚</p>
<p>é™¤äº†ä¸Šé¢çš„å® <code>RCT_EXPORT_VIEW_PROPERTY</code> å¯ä»¥æš´éœ²å±æ€§ç»™ React Native ä½¿ç”¨ä¹‹å¤–è¿˜æœ‰ä¸‹é¢ 5 ç§ï¼ˆè¿™é‡Œå…ˆæŒ–ä¸ªå‘ï¼Œå›å¤´ç ”ç©¶ä¸€ä¸‹å†è¯´è¯´ä¸‹é¢äº”ç§çš„ä½œç”¨å’ŒåŒºåˆ«ï¼‰ï¼š</p>
<ul>
<li>RCT_REMAP_VIEW_PROPERTY</li>
<li>RCT_CUSTOM_VIEW_PROPERTY</li>
<li>RCT_EXPORT_SHADOW_PROPERTY</li>
<li>RCT_REMAP_SHADOW_PROPERTY</li>
<li>RCT_CUSTOM_SHADOW_PROPERTY</li>
</ul>
<h2 id="å¦‚ä½•åœ¨-React-Native-ä¸­å“åº”-iOS-çš„äº‹ä»¶"><a href="#å¦‚ä½•åœ¨-React-Native-ä¸­å“åº”-iOS-çš„äº‹ä»¶" class="headerlink" title="å¦‚ä½•åœ¨ React Native ä¸­å“åº” iOS çš„äº‹ä»¶"></a>å¦‚ä½•åœ¨ React Native ä¸­å“åº” iOS çš„äº‹ä»¶</h2><p>è¦æƒ³åœ¨ React Native ä¸­å“åº” iOS çš„äº‹ä»¶ï¼Œåªéœ€è¦æš´éœ²ç”¨ <code>RCTBubblingEventBlock</code> æˆ– <code>RCTDirectEventBlock</code> å®šä¹‰çš„å±æ€§å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// RNTMapView.h</span><br><span class="line">#import &lt;MapKit/MapKit.h&gt;</span><br><span class="line">#import &lt;React/RCTComponent.h&gt;</span><br><span class="line"></span><br><span class="line">// ç”±äº MKMapView æ²¡æœ‰ä»»ä½• `RCTBubblingEventBlock` æˆ– `RCTDirectEventBlock` æ‰€å®šä¹‰çš„</span><br><span class="line">// å±æ€§ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å®šä¹‰ MKMapView çš„å­ç±» RNTMapView</span><br><span class="line">@interface RNTMapView: MKMapView</span><br><span class="line"></span><br><span class="line">// éœ€è¦æš´éœ²ç»™ React Native çš„äº‹ä»¶å±æ€§</span><br><span class="line">@property (nonatomic, copy) RCTBubblingEventBlock onRegionChange;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// RNTMapView.m</span><br><span class="line">#import &quot;RNTMapView.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation RNTMapView</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬éœ€è¦åœ¨ <code>RCTViewManager</code> ä¸­æš´éœ² <code>onRegionChange</code> ç»™ React Native ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// RNTMapManager.m</span><br><span class="line">#import &lt;MapKit/MapKit.h&gt;</span><br><span class="line">#import &lt;React/RCTViewManager.h&gt;</span><br><span class="line"></span><br><span class="line">#import &quot;RNTMapView.h&quot;</span><br><span class="line"></span><br><span class="line">@interface RNTMapManager : RCTViewManager &lt;MKMapViewDelegate&gt;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation RNTMapManager</span><br><span class="line"></span><br><span class="line">RCT_EXPORT_MODULE()</span><br><span class="line">// æš´éœ² RNTMapView ä¸­çš„ `onRegionChange` å±æ€§</span><br><span class="line">RCT_EXPORT_VIEW_PROPERTY(onRegionChange, RCTBubblingEventBlock)</span><br><span class="line"></span><br><span class="line">- (UIView *)view &#123;</span><br><span class="line">    // è¿™é‡Œéœ€è¦è¿”å› RNTMapView è€Œä¸æ˜¯ MKMapView</span><br><span class="line">    return [RNTMapView new];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é‡è¦çš„äº‹è¯´ä¸‰éï¼š<br>ä½¿ç”¨ <code>RCTBubblingEventBlock</code> æˆ– <code>RCTDirectEventBlock</code> æ‰€å®šä¹‰çš„äº‹ä»¶éƒ½å¿…é¡»åŠ ä¸Šå‰ç¼€ <code>on</code>ï¼Œå¦åˆ™ React Native æ— æ³•æ¥æ”¶åˆ°äº‹ä»¶<br>ä½¿ç”¨ <code>RCTBubblingEventBlock</code> æˆ– <code>RCTDirectEventBlock</code> æ‰€å®šä¹‰çš„äº‹ä»¶éƒ½å¿…é¡»åŠ ä¸Šå‰ç¼€ <code>on</code>ï¼Œå¦åˆ™ React Native æ— æ³•æ¥æ”¶åˆ°äº‹ä»¶<br>ä½¿ç”¨ <code>RCTBubblingEventBlock</code> æˆ– <code>RCTDirectEventBlock</code> æ‰€å®šä¹‰çš„äº‹ä»¶éƒ½å¿…é¡»åŠ ä¸Šå‰ç¼€ <code>on</code>ï¼Œå¦åˆ™ React Native æ— æ³•æ¥æ”¶åˆ°äº‹ä»¶</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://hparis.github.io/blog/2018/02/27/redux-%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="å¸•å¸•">
      <meta itemprop="description" content="å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¸•å¸•'s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/02/27/redux-%E4%B9%8B%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC/" class="post-title-link" itemprop="url">redux ä¹‹é¡µé¢è·³è½¬</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-02-26 17:48:56" itemprop="dateCreated datePublished" datetime="2018-02-26T17:48:56Z">2018-02-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 07:08:33" itemprop="dateModified" datetime="2022-04-20T07:08:33Z">2022-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>æœ€è¿‘æ­£åœ¨ç”¨ React Native é‡æ„æ•´ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬ç”¨äº† <strong><a target="_blank" rel="noopener" href="https://github.com/krystofcelba/react-native-navigation#rn52">react-native-navigation</a></strong> è¿™ä¸ªåº“æ¥ä½œä¸ºé¡¹ç›®çš„å¯¼èˆªæ§åˆ¶å™¨ã€‚<br>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¹³å¸¸ä¼šæŠŠé¡µé¢è·³è½¬é€»è¾‘çš„æ—¶å€™æ”¾åœ¨ Screen é‡Œé¢çš„ï¼Œæ¯”å¦‚:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FirstScreen</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">    _someAction = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">navigator</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">          <span class="attr">screen</span>: <span class="string">&#x27;example.SecondScreen&#x27;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    render = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸Šé¢çš„å†™æ³•æ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯ç›´åˆ°æˆ‘ä»¬ç¢°åˆ°è¿™æ ·ä¸€ä¸ªéœ€æ±‚çš„æ—¶å€™å°±æŠ“çäº†ï¼šç‚¹å‡»ä¸€ä¸ª PDF æ–‡ä»¶ï¼Œå¦‚æœ PDF æ–‡ä»¶æ²¡æœ‰ä¸‹è½½å°±å…ˆå»ä¸‹è½½ï¼Œä¸‹è½½å®Œæˆä¹‹åè‡ªåŠ¨è·³è½¬åˆ° PDF é˜…è¯»å™¨ã€‚ç”±äºç”¨äº† redux ä¹‹åï¼Œæˆ‘ä»¬å°±å¢åŠ ä¸€ä¸ª finished çš„ state æ¥åˆ¤æ–­æ˜¯å¦å·²ç»ä¸‹è½½å®Œæˆã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExampleScreen</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    componentWillReceiveProps = <span class="function">(<span class="params">nextProps</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œåˆ¤æ–­ä¸‹è½½çŠ¶æ€æ˜¯å¦å·²å®Œæˆï¼Œå®Œæˆçš„è¯å°±å»è·³è½¬</span></span><br><span class="line">        <span class="keyword">if</span> (nextProps.<span class="property">finished</span> === <span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// è¿™é‡Œéœ€è¦é‡ç½®ä¸€ä¸‹çŠ¶æ€ï¼Œä¸ç„¶å…¶ä»– state å‘ç”Ÿå˜åŒ–ä¼šå¤šæ¬¡è§¦å‘é¡µé¢çš„è·³è½¬</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">dispatch</span>(<span class="title function_">resetFinished</span>());</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">navigator</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">              <span class="attr">screen</span>: <span class="string">&#x27;example.PDFScreen&#x27;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">    _someAction = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// openPDF() è¿™ä¸ª action ä¼šè‡ªåŠ¨å»ä¸‹è½½ PDF æ–‡ä»¶ï¼Œç„¶åä¿®æ”¹ finished çš„çŠ¶æ€</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">dispatch</span>(<span class="title function_">openPDF</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    render = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mapStateToProps</span> = state =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">finished</span>: state.<span class="property">finished</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">connect</span>(mapStateToProps)(<span class="title class_">ExampleScreen</span>);</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„åšæ³•æ˜¯å¯ä»¥å®ç°æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä½†æ˜¯è¿™ç§å†™æ³•å¾ˆè›‹ç–¼ã€‚å› ä¸ºå½“ä½ åœ¨è°ƒç”¨ç”¨ openPDF() çš„æ—¶å€™ï¼Œä½ ä»¥ä¸ºåé¢çš„äº‹ä¸éœ€è¦ä½ æ“å¿ƒï¼Œç„¶åè¿™ä¸ªæ—¶å€™æœ‰äººå‘Šè¯‰ä½ è¿˜éœ€è¦åœ¨å…¶ä»–åœ°æ–¹å¢åŠ ä¸€ä¸ªä¸­é—´çŠ¶æ€å»è¡¥å…… openPDF() çš„åç»­é€»è¾‘å¤„ç†ã€‚</p>
<p>ç»è¿‡è®¨è®ºä¹‹åï¼Œæˆ‘ä»¬å†³å®šæ”¹æˆç”¨ callback çš„æ–¹å¼æ¥å®ç°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExampleScreen</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">    _someAction = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// openPDF() æ˜¯ä¸€ä¸ªå¼‚æ­¥ action</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">dispatch</span>(<span class="title function_">openPDF</span>(<span class="attr">callback</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">navigator</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">              <span class="attr">screen</span>: <span class="string">&#x27;example.PDFScreen&#x27;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    render = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ callback çš„å¥½å¤„å°±æ˜¯å»æ‰äº†ä¸€ä¸ªçƒ¦äººçš„ä¸­é—´çŠ¶æ€ï¼Œå¹¶ä¸”ä»é˜…è¯»ä½“éªŒæ¥è¯´å¾ˆå®¹æ˜“è®©è¯»è€…æ˜ç™½è¿™ä¸ªç‚¹å‡»äº‹ä»¶åœ¨å¹²ä»€ä¹ˆã€‚ä½†æ˜¯åœ¨ redux çš„ action æ–¹æ³•ä¸­å¢åŠ ä¸€ä¸ª callback çš„è°ƒç”¨ï¼Œçœ‹èµ·æ¥ä¹Ÿæœ‰ç‚¹ä¸ä¼¦ä¸ç±»çš„ã€‚è™½ç„¶æˆ‘è®¤ä¸º callback å’Œå…¶ä»–å‚æ•°å…·æœ‰ç›¸åŒçš„æ³•å¾‹åœ°ä½ã€‚</p>
<p>å…¶å®æœ€å¥½çš„å®ç°æ˜¯ï¼Œè¿™ä¸ªç‚¹å‡»äº‹ä»¶åº”è¯¥è¿é¡µé¢çš„è·³è½¬é€»è¾‘ä¹Ÿä¸éœ€è¦å¤„ç†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExampleScreen</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç‚¹å‡»äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶åªåšä¸€ä»¶äº‹å°±æ˜¯å» dispatch ä¸€ä¸ª openPDF() çš„ action</span></span><br><span class="line">    _someAction = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">dispatch</span>(<span class="title function_">openPDF</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    render = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åƒä¸Šé¢è¿™ç§å®ç°ï¼Œæˆ‘ä»¬ä¹Ÿå°±åªèƒ½åœ¨ openPDF() é‡ŒåŠ¨æ‰‹è„šäº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// action.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> openPDF = <span class="keyword">await</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">dispatch</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å¼‚æ­¥ä¸‹è½½ PDF</span></span><br><span class="line">        <span class="keyword">async</span> <span class="title function_">downloadPDF</span>();</span><br><span class="line">        <span class="comment">// å®Œæˆä¹‹åé€šè¿‡ router å»å®ç°é¡µé¢è·³è½¬</span></span><br><span class="line">        <span class="title function_">dispatch</span>(<span class="title function_">openRouter</span>(<span class="string">&#x27;PDFScreen&#x27;</span>));</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é‡Œå°±ä¸å†è¯¦ç»†è¯´ router çš„å®ç°ç»†èŠ‚äº†ï¼Œå› ä¸ºç½‘ä¸Šæœ‰å¾ˆå¤šç°æˆçš„èµ„æ–™ã€‚ï¼ˆPS: ä¸»è¦æ˜¯æˆ‘ä¹Ÿè¿˜æ²¡çœ‹åˆ°è¿™ä¸€å—ï¼‰</p>
</blockquote>
<p>ä»é¡µé¢ï¼ˆScreenï¼‰çš„è§’åº¦æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºè¿™æ ·çš„å¤„ç†æ˜¯æœ€åˆé€‚çš„ã€‚å› ä¸º Screen åªéœ€è¦å…³æ³¨æœ¬é¡µé¢çš„ state å’Œ actionï¼Œè‡³äºè·³è½¬çš„é€»è¾‘äº¤ç»™åé¢çš„ action æ¥å¤„ç†æ˜¯æœ€å¥½çš„ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://hparis.github.io/blog/2017/09/05/RAC%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="å¸•å¸•">
      <meta itemprop="description" content="å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¸•å¸•'s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2017/09/05/RAC%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">RAC å’Œå†…å­˜ç®¡ç†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-09-05 15:30:56" itemprop="dateCreated datePublished" datetime="2017-09-05T15:30:56Z">2017-09-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 07:08:33" itemprop="dateModified" datetime="2022-04-20T07:08:33Z">2022-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>æœ€è¿‘åœ¨ç”¨ RAC çš„æ—¶å€™å‘ç°è‡ªå·±å¯¹å†…å­˜ç®¡ç†è¿˜æ˜¯æœ‰äº›å›°æƒ‘ï¼Œäºæ˜¯è‡ªå·±å†™äº†ä¸€äº›ä»£ç æ¥éªŒè¯è‡ªå·±çš„ä¸€äº›ç†è§£ã€‚<br>åœ¨ä¸€å¼€å§‹æ¥è§¦ RAC çš„æ—¶å€™ï¼Œæˆ‘ä»¬çŸ¥é“ RAC å¯¹äº block éƒ½æ˜¯ copy èµ‹å€¼çš„ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@implementation</span> <span class="type">RACSignal</span></span><br><span class="line"></span><br><span class="line">#pragma mark <span class="type">Lifecycle</span></span><br><span class="line"></span><br><span class="line"><span class="operator">+</span> (<span class="type">RACSignal</span> <span class="operator">*</span>)createSignal:(<span class="type">RACDisposable</span> <span class="operator">*</span> (<span class="operator">^</span>)(id<span class="operator">&lt;</span><span class="type">RACSubscriber</span><span class="operator">&gt;</span> subscriber))didSubscribe &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="type">RACDynamicSignal</span> createSignal:didSubscribe];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@implementation</span> <span class="type">RACDynamicSignal</span></span><br><span class="line"></span><br><span class="line">#pragma mark <span class="type">Lifecycle</span></span><br><span class="line"></span><br><span class="line"><span class="operator">+</span> (<span class="type">RACSignal</span> <span class="operator">*</span>)createSignal:(<span class="type">RACDisposable</span> <span class="operator">*</span> (<span class="operator">^</span>)(id<span class="operator">&lt;</span><span class="type">RACSubscriber</span><span class="operator">&gt;</span> subscriber))didSubscribe &#123;</span><br><span class="line">    <span class="type">RACDynamicSignal</span> <span class="operator">*</span>signal <span class="operator">=</span> [[<span class="keyword">self</span> alloc] <span class="keyword">init</span>];</span><br><span class="line">    signal-&gt;_didSubscribe <span class="operator">=</span> [didSubscribe copy];</span><br><span class="line">    <span class="keyword">return</span> [signal setNameWithFormat:@<span class="string">&quot;+createSignal:&quot;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨åˆ›å»º RACSingal çš„æ—¶å€™ä¼šè°ƒç”¨å…¶å­ç±» RACDynamicSignal å»åˆ›å»ºï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ° RACDynamicSignal å¯¹ didSuscribe è¿™ä¸ª block æ˜¯è¿›è¡Œäº† copyã€‚æ‰€ä»¥å¤§å®¶å¯èƒ½ä¼šè¢«è¦æ±‚æ³¨æ„å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œäºæ˜¯å¤§å®¶éƒ½ç”¨ @weakify(target) å’Œ @strongify(target) æ¥é¿å…å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚é‚£æ˜¯ä¸æ˜¯æ‰€æœ‰ç”¨åˆ° RAC çš„åœ°æ–¹éƒ½éœ€è¦ä½¿ç”¨è¿™äº›å®æ¥é¿å…å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œä¸å°½ç„¶ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœºæ™¯1</span></span><br><span class="line">[<span class="type">RACObserve</span>(<span class="keyword">self</span>, title) subscribeNext:<span class="operator">^</span>(id x) &#123;</span><br><span class="line">    <span class="type">NSLog</span>(@<span class="string">&quot;%@&quot;</span>, x);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å¯¹æ¯”ä»¥ä¸‹çš„å‡ ç§ç”¨æ³•ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@interface</span> <span class="type">ViewController</span>()</span><br><span class="line"><span class="meta">@property</span> (strong, nonatomic) <span class="type">ViewModel</span> <span class="operator">*</span> viewModel;</span><br><span class="line"><span class="meta">@end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@implementation</span> <span class="type">ViewController</span></span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> (void)viewDidiLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.viewModel <span class="operator">=</span> [<span class="type">ViewModel</span> new];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœºæ™¯2</span></span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), <span class="operator">^</span>&#123;</span><br><span class="line">        <span class="keyword">self</span>.title <span class="operator">=</span> @<span class="string">&quot;ä½ å¥½&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœºæ™¯3</span></span><br><span class="line">    [<span class="keyword">self</span>.viewModel.titleSignal subscribeNext:<span class="operator">^</span>(<span class="type">NSString</span> <span class="operator">*</span> title) &#123;</span><br><span class="line">        <span class="keyword">self</span>.title <span class="operator">=</span> title;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœºæ™¯4</span></span><br><span class="line">    [<span class="type">RACObserve</span>(<span class="keyword">self</span>.viewModel, title) subscribeNext:<span class="operator">^</span>(<span class="type">NSString</span> <span class="operator">*</span> title)     &#123;</span><br><span class="line">        <span class="keyword">self</span>.title <span class="operator">=</span> title;</span><br><span class="line">    &#125;]; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@end</span></span><br></pre></td></tr></table></figure>

<p>åœºæ™¯2æ˜¯æˆ‘ä»¬å¹³å¸¸éƒ½ä¼šç”¨åˆ°çš„ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿæ²¡æœ‰åœ¨è¿™ç§åœºæ™¯ä¸‹å»è€ƒè™‘å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸º dispatch çš„ block ä¸æ˜¯å±äº self çš„ï¼ˆè‡³äºè¿™ä¸ª block æ˜¯å±äºè°çš„ï¼Œå›å¤´æˆ‘å†æŸ¥ç‚¹èµ„æ–™æˆ–è€…è¯·å„ä½æŒ‡æ•™ï¼‰ï¼Œæ‰€ä»¥å³ä½¿ä½ åœ¨ block ä½¿ç”¨äº† self ä¹Ÿä¸ä¼šæœ‰å¾ªç¯åº”ç”¨çš„é—®é¢˜ã€‚</p>
<p>åœºæ™¯3å¾ˆæ˜æ˜¾æ˜¯æœ‰å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼š<strong>self-&gt;viewModel-&gt;titleSignal-&gt;block-&gt;self</strong>ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬ä¸åšå¤„ç†çš„è¯ï¼Œé‚£ä¹ˆ self å°±æ°¸è¿œä¸ä¼šè¢«é‡Šæ”¾ã€‚æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ä½¿ç”¨ @weakify(self) å’Œ @strongify(self)ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœºæ™¯3</span></span><br><span class="line"><span class="meta">@weakify</span>(<span class="keyword">self</span>);</span><br><span class="line">[<span class="keyword">self</span>.viewModel.titleSignal subscribeNext:<span class="operator">^</span>(<span class="type">NSString</span> <span class="operator">*</span> title) &#123;</span><br><span class="line">    <span class="meta">@strongify</span>(<span class="keyword">self</span>);</span><br><span class="line">    <span class="keyword">self</span>.title <span class="operator">=</span> title;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>åœºæ™¯4åœ¨æˆ‘ä»¬çœ‹æ¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºè¿™é‡Œçœ‹èµ·æ¥åªæœ‰ <strong>singal-&gt;block-&gt;self</strong> çš„å¼•ç”¨ï¼Œå®ƒä»¬ä¹‹é—´å¹¶æ²¡æœ‰é€ æˆå¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ RACObserve çš„å®ç°ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#define <span class="type">RACObserve</span>(<span class="type">TARGET</span>, <span class="type">KEYPATH</span>) \</span><br><span class="line">(&#123; \</span><br><span class="line">_Pragma(<span class="string">&quot;clang diagnostic push&quot;</span>) \</span><br><span class="line">_Pragma(<span class="string">&quot;clang diagnostic ignored <span class="subst">\&quot;</span>-Wreceiver-is-weak<span class="subst">\&quot;</span>&quot;</span>) \</span><br><span class="line">__weak id target_ <span class="operator">=</span> (<span class="type">TARGET</span>); \</span><br><span class="line">[target_ rac_valuesForKeyPath:<span class="meta">@keypath</span>(<span class="type">TARGET</span>, <span class="type">KEYPATH</span>) observer:<span class="keyword">self</span>]; \</span><br><span class="line">_Pragma(<span class="string">&quot;clang diagnostic pop&quot;</span>) \</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> (<span class="type">RACSignal</span> <span class="operator">*</span>)rac_valuesForKeyPath:(<span class="type">NSString</span> <span class="operator">*</span>)keyPath observer:(__weak <span class="type">NSObject</span> <span class="operator">*</span>)observer;</span><br></pre></td></tr></table></figure>

<p>å…¶å®ï¼Œçœ‹åˆ°è¿™é‡Œä½ ä¼šè®¤ä¸ºè¿™é‡Œåªæ˜¯è°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª Signalï¼Œè€Œä¸”è¿™ä¸ª Signal ä¹Ÿå¹¶ä¸å±äºä»»ä½•å¯¹è±¡ã€‚æˆ‘ä»¬å†æ¥çœ‹çœ‹å…·ä½“çš„å®ç°æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-</span> (<span class="type">RACSignal</span> <span class="operator">*</span>)rac_valuesAndChangesForKeyPath:(<span class="type">NSString</span> <span class="operator">*</span>)keyPath options:(<span class="type">NSKeyValueObservingOptions</span>)options observer:(__weak <span class="type">NSObject</span> <span class="operator">*</span>)weakObserver &#123;</span><br><span class="line">    <span class="type">NSObject</span> <span class="operator">*</span>strongObserver <span class="operator">=</span> weakObserver;</span><br><span class="line">    keyPath <span class="operator">=</span> [keyPath copy];</span><br><span class="line"></span><br><span class="line">    <span class="type">NSRecursiveLock</span> <span class="operator">*</span>objectLock <span class="operator">=</span> [[<span class="type">NSRecursiveLock</span> alloc] <span class="keyword">init</span>];</span><br><span class="line">    objectLock.name <span class="operator">=</span> @<span class="string">&quot;org.reactivecocoa.ReactiveCocoa.NSObjectRACPropertySubscribing&quot;</span>;</span><br><span class="line"></span><br><span class="line">    __weak <span class="type">NSObject</span> <span class="operator">*</span>weakSelf <span class="operator">=</span> <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">RACSignal</span> <span class="operator">*</span>deallocSignal <span class="operator">=</span> [[<span class="type">RACSignal</span> zip:@[</span><br><span class="line">                            <span class="keyword">self</span>.rac_willDeallocSignal,</span><br><span class="line">                            strongObserver.rac_willDeallocSignal <span class="operator">?</span>: [<span class="type">RACSignal</span> never]</span><br><span class="line">    ]] doCompleted:<span class="operator">^</span>&#123;</span><br><span class="line">        <span class="comment">// Forces deallocation to wait if the object variables are currently</span></span><br><span class="line">        <span class="comment">// being read on another thread.</span></span><br><span class="line">        [objectLock lock];</span><br><span class="line">        <span class="meta">@onExit</span> &#123;</span><br><span class="line">            [objectLock unlock];</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [[[<span class="type">RACSignal</span> createSignal:<span class="operator">^</span> <span class="type">RACDisposable</span> <span class="operator">*</span> (id<span class="operator">&lt;</span><span class="type">RACSubscriber</span><span class="operator">&gt;</span> subscriber) &#123;</span><br><span class="line">        <span class="comment">// Hold onto the lock the whole time we&#x27;re setting up the KVO</span></span><br><span class="line">        <span class="comment">// observation, because any resurrection that might be caused by our</span></span><br><span class="line">        <span class="comment">// retaining below must be balanced out by the time -dealloc returns</span></span><br><span class="line">        <span class="comment">// (if another thread is waiting on the lock above).</span></span><br><span class="line">        [objectLock lock];</span><br><span class="line">        <span class="meta">@onExit</span> &#123;</span><br><span class="line">            [objectLock unlock];</span><br><span class="line">        &#125;;</span><br><span class="line">    </span><br><span class="line">        __strong <span class="type">NSObject</span> <span class="operator">*</span>observer __attribute__((objc_precise_lifetime)) <span class="operator">=</span> weakObserver;</span><br><span class="line">        __strong <span class="type">NSObject</span> <span class="operator">*</span><span class="keyword">self</span> __attribute__((objc_precise_lifetime)) <span class="operator">=</span> weakSelf;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span> <span class="operator">==</span> <span class="literal">nil</span>) &#123;</span><br><span class="line">            [subscriber sendCompleted];</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> [<span class="keyword">self</span> rac_observeKeyPath:keyPath options:options observer:observer block:<span class="operator">^</span>(id value, <span class="type">NSDictionary</span> <span class="operator">*</span>change, <span class="type">BOOL</span> causedByDealloc, <span class="type">BOOL</span> affectedOnlyLastComponent) &#123;</span><br><span class="line">                [subscriber sendNext:<span class="type">RACTuplePack</span>(value, change)];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;] takeUntil:deallocSignal] setNameWithFormat:@<span class="string">&quot;%@ -rac_valueAndChangesForKeyPath: %@ options: %lu observer: %@&quot;</span>, <span class="keyword">self</span>.rac_description, keyPath, (unsigned long)options, strongObserver.rac_description];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹è§‚å¯Ÿ <strong>deallocSignal</strong> å’Œ **[signal takeUntile:deallocSignal]**ï¼Œæˆ‘ä»¬æŠŠ deallocSignal å•ç‹¬æ‹¿å‡ºæ¥çœ‹çœ‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RACSignal</span> <span class="operator">*</span>deallocSignal <span class="operator">=</span> [[<span class="type">RACSignal</span> zip:@[</span><br><span class="line">                        <span class="keyword">self</span>.rac_willDeallocSignal,</span><br><span class="line">                        strongObserver.rac_willDeallocSignal <span class="operator">?</span>: [<span class="type">RACSignal</span> never]</span><br><span class="line">                        ]] doCompleted:<span class="operator">^</span>&#123;</span><br><span class="line">    <span class="comment">// Forces deallocation to wait if the object variables are currently</span></span><br><span class="line">    <span class="comment">// being read on another thread.</span></span><br><span class="line">    [objectLock lock];</span><br><span class="line">    <span class="meta">@onExit</span> &#123;</span><br><span class="line">    [objectLock unlock];</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ deallocSignal æ˜¯åªæœ‰åœ¨ self å’Œ strongObserve éƒ½å°†è¦å‘ç”Ÿ dealloc çš„æ—¶å€™æ‰ä¼šè§¦å‘çš„ã€‚å³ç”¨ RACObserve åˆ›å»ºçš„ä¿¡å·åªæœ‰åœ¨å…¶ target å’Œ observe éƒ½å‘ç”Ÿ dealloc çš„æ—¶å€™æ‰ä¼šè¢« disposable (è¿™ä¸ªå¥½åƒæ˜¯ RAC ç”¨æ¥é”€æ¯è‡ªå·±èµ„æºçš„ä¸œè¥¿)ã€‚ä¸æ˜ç™½çš„ç«¥é‹ï¼Œæˆ‘ä»¬å›å¤´æ¥åˆ†æä¸€ä¸‹åœºæ™¯4çš„ä»£ç ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœºæ™¯4</span></span><br><span class="line">[<span class="type">RACObserve</span>(<span class="keyword">self</span>.viewModel, title) subscribeNext:<span class="operator">^</span>(<span class="type">NSString</span> <span class="operator">*</span> title) &#123;</span><br><span class="line">    <span class="keyword">self</span>.title <span class="operator">=</span> title;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>ç”¨ RACObserve åˆ›å»ºçš„ä¿¡å·çœ‹èµ·æ¥åªè¦å‡ºäº†å‡½æ•°ä½“å…¶èµ„æºåº”è¯¥å°±ä¼šè¢«å›æ”¶ï¼Œä½†æ˜¯è¿™ä¸ªä¿¡å·å…¶å®æ˜¯åªæœ‰åœ¨ self.viewModel.rac_willDeallocSignal å’Œ self.rac_willDeallocSignal éƒ½å‘ç”Ÿçš„æƒ…å†µä¸‹æ‰ä¼šè¢«é‡Šæ”¾ã€‚æ‰€ä»¥åœºæ™¯4çš„å¼•ç”¨å…³ç³»çœ‹èµ·æ¥åªæœ‰ signal-&gt;block-&gt;selfï¼Œä½†æ˜¯è¿™ä¸ª signal åªæœ‰åœ¨ self.rac_willDeallocSignal çš„æ—¶å€™æ‰ä¼šè¢«é‡Šæ”¾ã€‚æ‰€ä»¥è¿™é‡Œå¦‚æœä¸æ‰“æ–­è¿™ç§å…³ç³»çš„è¯å°±ä¼šé€ æˆå¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œæ­£ç¡®åšæ³•åº”è¯¥æ˜¯ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœºæ™¯4</span></span><br><span class="line"><span class="meta">@weakify</span>(<span class="keyword">self</span>);</span><br><span class="line">[<span class="type">RACObserve</span>(<span class="keyword">self</span>.viewModel, title) subscribeNext:<span class="operator">^</span>(<span class="type">NSString</span> <span class="operator">*</span> title) &#123;</span><br><span class="line">    <span class="meta">@strongify</span>(<span class="keyword">self</span>);</span><br><span class="line">    <span class="keyword">self</span>.title <span class="operator">=</span> title;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œåœ¨è¯´ä¸€ä¸ªç‰¹åˆ«éœ€è¦æ³¨æ„çš„ï¼Œå°±æ˜¯ UITableViewCell å’Œ UICollectionViewCell å¤ç”¨å’Œ RAC çš„é—®é¢˜ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-</span> (<span class="type">NSInteger</span>)tableView:(nonnull <span class="type">UITableView</span> <span class="operator">*</span>)tableView numberOfRowsInSection:(<span class="type">NSInteger</span>)section &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> (<span class="type">UITableViewCell</span> <span class="operator">*</span>)tableView:(nonnull <span class="type">UITableView</span> <span class="operator">*</span>)tableView cellForRowAtIndexPath:(nonnull <span class="type">NSIndexPath</span> <span class="operator">*</span>)indexPath &#123;</span><br><span class="line">    <span class="type">UITableViewCell</span> <span class="operator">*</span> cell <span class="operator">=</span> [tableView dequeueReusableCellWithIdentifier:@<span class="string">&quot;TableViewCell&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="meta">@weakify</span>(<span class="keyword">self</span>);</span><br><span class="line">    [<span class="type">RACObserve</span>(cell.textLabel, text) subscribeNext:<span class="operator">^</span>(id x) &#123;</span><br><span class="line">        <span class="meta">@strongify</span>(<span class="keyword">self</span>);</span><br><span class="line">        <span class="type">NSLog</span>(@<span class="string">&quot;%@&quot;</span>, <span class="keyword">self</span>);</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çœ‹åˆ°è¿™é‡Œçš„ RACObserve åˆ›å»ºçš„ Signal å’Œ self ä¹‹é—´å·²ç»å»æ‰äº†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯æ²¡æœ‰ä»€ä¹ˆé—®é¢˜çš„ã€‚ä½†æ˜¯ç»“åˆä¹‹å‰æˆ‘ä»¬å¯¹ RACObserve çš„ç†è§£å†ä»”ç»†åˆ†æä¸€ä¸‹ï¼Œè¿™é‡Œçš„ Signal åªè¦ self æ²¡æœ‰è¢« dealloc çš„è¯å°±ä¸ä¼šè¢«é‡Šæ”¾ã€‚è™½ç„¶æ¯æ¬¡ UITableViewCell éƒ½ä¼šè¢«é‡ç”¨ï¼Œä½†æ˜¯æ¯æ¬¡é‡ç”¨è¿‡ç¨‹ä¸­åˆ›å»ºçš„ä¿¡å·ç¡®å®æ— æ³•è¢« disposableã€‚é‚£æˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-</span> (<span class="type">NSInteger</span>)tableView:(nonnull <span class="type">UITableView</span> <span class="operator">*</span>)tableView numberOfRowsInSection:(<span class="type">NSInteger</span>)section &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> (<span class="type">UITableViewCell</span> <span class="operator">*</span>)tableView:(nonnull <span class="type">UITableView</span> <span class="operator">*</span>)tableView cellForRowAtIndexPath:(nonnull <span class="type">NSIndexPath</span> <span class="operator">*</span>)indexPath &#123;</span><br><span class="line">    <span class="type">UITableViewCell</span> <span class="operator">*</span> cell <span class="operator">=</span> [tableView dequeueReusableCellWithIdentifier:@<span class="string">&quot;TableViewCell&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="meta">@weakify</span>(<span class="keyword">self</span>);</span><br><span class="line">    [[<span class="type">RACObserve</span>(cell.textLabel, text) takeUntil:cell.rac_prepareForReuseSignal] subscribeNext:<span class="operator">^</span>(id x) &#123;</span><br><span class="line">        <span class="meta">@strongify</span>(<span class="keyword">self</span>);</span><br><span class="line">        <span class="type">NSLog</span>(@<span class="string">&quot;%@&quot;</span>, <span class="keyword">self</span>);</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨cellé‡Œé¢åˆ›å»ºçš„ä¿¡å·åŠ ä¸Š takeUntil:cell.rac_prepareForReuseSignalï¼Œè¿™ä¸ªæ˜¯è®© cell åœ¨æ¯æ¬¡é‡ç”¨çš„æ—¶å€™éƒ½å» disposable åˆ›å»ºçš„ä¿¡å·ã€‚</p>
<p>ä»¥ä¸Šæ‰€è¯´çš„å…³äºå†…å­˜çš„ä¸œè¥¿æˆ‘éƒ½ç”¨ Instrument çš„ Allocations éªŒè¯è¿‡äº†ï¼Œä½†æ˜¯ä¾æ—§å»ºè®®å¤§å®¶è‡ªå·±ä¹Ÿå»è¯•è¯•ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://hparis.github.io/blog/2017/09/05/Shell-Tip/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="å¸•å¸•">
      <meta itemprop="description" content="å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å¸•å¸•'s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2017/09/05/Shell-Tip/" class="post-title-link" itemprop="url">Shell Tip</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-09-05 15:30:56" itemprop="dateCreated datePublished" datetime="2017-09-05T15:30:56Z">2017-09-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-20 07:08:33" itemprop="dateModified" datetime="2022-04-20T07:08:33Z">2022-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">æŠ€æœ¯</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>è®°å½•æ—¥å¸¸ä¸­ç”¨åˆ°çš„ä¸€äº› Bash è„šæœ¬ï¼Œç»å¸¸æ›´æ–°</p>
</blockquote>
<h2 id="Tip-1-ä¿®æ”¹æ–‡ä»¶é‡Œé¢çš„å†…å®¹"><a href="#Tip-1-ä¿®æ”¹æ–‡ä»¶é‡Œé¢çš„å†…å®¹" class="headerlink" title="Tip 1 : ä¿®æ”¹æ–‡ä»¶é‡Œé¢çš„å†…å®¹"></a>Tip 1 : ä¿®æ”¹æ–‡ä»¶é‡Œé¢çš„å†…å®¹</h2><p>æ—©ä¸Šäº§å“æœ‰ä¸€ä¸ªå°éœ€æ±‚å°±æ˜¯æŠŠå·¥ç¨‹ä¸­çš„æ‰€æœ‰ç½‘é¡µçš„æ ‡é¢˜ä¿®æ”¹ä¸ºé»‘ç±³æµé‡é€šï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®ç°</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find . -name <span class="string">&#x27;*.html&#x27;</span> -print0 | xargs -0 sed -i <span class="string">&#x27;&#x27;</span> -e <span class="string">&#x27;s/&lt;title&gt;.*&lt;\/title&gt;/&lt;title&gt;é»‘ç±³æµé‡é€š&lt;\/title&gt;/g&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>find</code>          æŸ¥æ‰¾å‘½ä»¤ï¼Œå¯ä»¥ç”¨ man find æŸ¥çœ‹æ›´å¤šçš„ä¿¡æ¯</li>
<li><code>.</code>             ä»£è¡¨å½“å‰ç›®å½•</li>
<li><code>-name</code>         find å‘½ä»¤çš„å‚æ•°ï¼Œè¡¨ç¤ºè¦æŸ¥æ‰¾çš„æ–‡ä»¶å</li>
<li><code>-print0</code>       æ˜¯ä¸€ç§ä¸æ¢è¡Œçš„è¾“å‡ºæ ¼å¼ï¼Œä»¥ ASCII NUL å­—ç¬¦ï¼ˆä¹Ÿå°±æ˜¯\0ï¼‰ä½œä¸ºåˆ†éš”ç¬¦ã€‚ä¸Šé¢çš„ä¾‹å­å¯èƒ½æ˜¯ <code>a.html\0b.html\0c.html</code></li>
<li><code>|</code>             è¿™æ˜¯ä¸€ä¸ªç®¡é“ç¬¦ï¼Œè¡¨ç¤ºæŠŠå‰é¢å‘½ä»¤çš„è¾“å‡ºä½œä¸ºåé¢å‘½ä»¤çš„è¾“å…¥</li>
<li><code>xargs</code>         æ˜¯ç”¨æ¥æ„é€ è¾“å…¥å‚æ•°ï¼Œå¹¶ä¸”å¾ªç¯æ‰§è¡Œæ¯ä¸€ä¸ªå‚æ•°</li>
<li><code>-0</code>            è¡¨ç¤ºè®© xargs ä½¿ç”¨ ASCII NUL æ¥åˆ†éš”å‚æ•°ã€‚ä¸Šé¢çš„ä¾‹å­å°†è¢«åˆ†éš”æˆ <code>a.html</code> <code>b.html</code> <code>c.html</code> ä¸‰ä¸ªå‚æ•°ä¾æ¬¡æ‰§è¡Œ</li>
<li><code>sed</code>           è¿™æ˜¯ä¸€ä¸ªæµç¼–è¾‘å™¨ï¼Œå¦‚æœä¼ çš„æ˜¯æ–‡ä»¶åä¼šæŠŠæ–‡ä»¶å†…å®¹è¯»å…¥å†…å­˜ï¼Œå¦‚æœåªæ˜¯æ™®é€šå­—ç¬¦ä¸²å°±ä¼šæŠŠå­—ç¬¦ä¸²è¯»å…¥å†…å­˜</li>
<li><code>-i</code>            è¡¨ç¤ºè¦æŠŠåŸæ¥çš„æ–‡ä»¶å†…å®¹åšä¸€æ¬¡å¤‡ä»½ï¼Œåé¢çš„ <code>&#39;&#39;</code> æ˜¯è¡¨ç¤ºè¦å¤‡ä»½çš„æ–‡ä»¶åå­—ï¼Œå¦‚æœæ²¡æœ‰æ–‡ä»¶åå­—å°±è¡¨ç¤ºä¸éœ€è¦å¤‡ä»½</li>
<li><code>-e</code>            è¡¨ç¤ºåé¢çš„å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼Œéœ€è¦è¢«æ‰§è¡Œ</li>
<li><code>s/old/new/g</code>   è¿™ä¸ªæ˜¯ç”¨æ¥æ›¿æ¢å­—ç¬¦ä¸²çš„å‘½ä»¤</li>
</ul>
<h2 id="Tip-2-æŸ¥æ‰¾æ–‡ä»¶çš„å†…å®¹"><a href="#Tip-2-æŸ¥æ‰¾æ–‡ä»¶çš„å†…å®¹" class="headerlink" title="Tip 2 : æŸ¥æ‰¾æ–‡ä»¶çš„å†…å®¹"></a>Tip 2 : æŸ¥æ‰¾æ–‡ä»¶çš„å†…å®¹</h2><p>æŠŠåŒ¹é…çš„æ–‡ä»¶å†…å®¹çš„ç›¸å…³æ–‡ä»¶åˆ—å‡ºæ¥</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find . -name <span class="string">&#x27;*.html&#x27;</span> -print0 | xargs -0 grep <span class="string">&#x27;PATTERN&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Tip-3-è§£å†³-Homebrew-çš„æƒé™é—®é¢˜"><a href="#Tip-3-è§£å†³-Homebrew-çš„æƒé™é—®é¢˜" class="headerlink" title="Tip 3 : è§£å†³ Homebrew çš„æƒé™é—®é¢˜"></a>Tip 3 : è§£å†³ Homebrew çš„æƒé™é—®é¢˜</h2><p>æŸ¥çœ‹ Homebrew çš„æ‰€æœ‰æƒ</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -al `<span class="built_in">which</span> brew`</span><br></pre></td></tr></table></figure>

<p>æŠŠ Homebrew çš„ç”¨æˆ·å’Œåˆ†ç»„ä¿®æ”¹ä¸º root å’Œ wheel</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">chown</span> root:wheel `<span class="built_in">which</span> brew`</span><br></pre></td></tr></table></figure>

<p>æœ€åè¿˜åŸ Homebrew çš„æƒé™ï¼ˆå®‰å…¨ï¼‰</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">chown</span> : `<span class="built_in">chown</span> brew`</span><br></pre></td></tr></table></figure>

<h2 id="Tip-4-åˆ©ç”¨-Shell-ç”Ÿæˆç”Ÿæˆ-ICON"><a href="#Tip-4-åˆ©ç”¨-Shell-ç”Ÿæˆç”Ÿæˆ-ICON" class="headerlink" title="Tip 4 : åˆ©ç”¨ Shell ç”Ÿæˆç”Ÿæˆ ICON"></a>Tip 4 : åˆ©ç”¨ Shell ç”Ÿæˆç”Ÿæˆ ICON</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">#æ­¤è„šæœ¬æ˜¯ç”¨æ¥ç”Ÿæˆ iPhone å’Œ iPad æ‰€éœ€ icon çš„ä¸åŒå°ºå¯¸çš„ï¼Œæœ€å¥½æ˜¯å‡†å¤‡ä¸€å¼  1024x1024 çš„ Icon å›¾ç‰‡</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filename=<span class="string">&quot;icon.png&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dirname</span>=<span class="string">&quot;icon&quot;</span></span><br><span class="line"></span><br><span class="line">name_array=(<span class="string">&quot;Icon-20.png&quot;</span> <span class="string">&quot;Icon-20@2x.png&quot;</span> <span class="string">&quot;Icon-20@3x.png&quot;</span></span><br><span class="line"><span class="string">&quot;Icon-29.png&quot;</span> <span class="string">&quot;Icon-29@2x.png&quot;</span> <span class="string">&quot;Icon-29@3x.png&quot;</span></span><br><span class="line"><span class="string">&quot;Icon-40.png&quot;</span> <span class="string">&quot;Icon-40@2x.png&quot;</span> <span class="string">&quot;Icon-40@3x.png&quot;</span></span><br><span class="line"><span class="string">&quot;Icon-60@2x.png&quot;</span> <span class="string">&quot;Icon-60@3x.png&quot;</span></span><br><span class="line"><span class="string">&quot;Icon-76.png&quot;</span> <span class="string">&quot;Icon-76@2x.png&quot;</span></span><br><span class="line"><span class="string">&quot;Icon-83.5@2x.png&quot;</span>)</span><br><span class="line">size_array=(<span class="string">&quot;20&quot;</span> <span class="string">&quot;40&quot;</span> <span class="string">&quot;60&quot;</span></span><br><span class="line"><span class="string">&quot;29&quot;</span> <span class="string">&quot;58&quot;</span> <span class="string">&quot;87&quot;</span></span><br><span class="line"><span class="string">&quot;40&quot;</span> <span class="string">&quot;80&quot;</span> <span class="string">&quot;120&quot;</span></span><br><span class="line"><span class="string">&quot;120&quot;</span> <span class="string">&quot;180&quot;</span></span><br><span class="line"><span class="string">&quot;76&quot;</span> <span class="string">&quot;152&quot;</span></span><br><span class="line"><span class="string">&quot;167&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> <span class="variable">$dirname</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=0;i&lt;<span class="variable">$&#123;#name_array[@]&#125;</span>;++i)); <span class="keyword">do</span></span><br><span class="line">    m_dir=<span class="variable">$dirname</span>/<span class="variable">$&#123;name_array[i]&#125;</span></span><br><span class="line">    <span class="built_in">cp</span> <span class="variable">$filename</span> <span class="variable">$m_dir</span></span><br><span class="line">    sips -Z <span class="variable">$&#123;size_array[i]&#125;</span> <span class="variable">$m_dir</span></span><br><span class="line"><span class="comment"># å¦‚æœå›¾ç‰‡æ˜¯ sRGB çš„è¯ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤</span></span><br><span class="line"><span class="comment">#    sips --matchTo &#x27;/System/Library/ColorSync/Profiles/sRGB Profile.icc&#x27; -Z $&#123;size_array[i]&#125; $m_dir </span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="Tip5-ä½¿ç”¨-Python-å…±äº«å½“å‰ç›®å½•"><a href="#Tip5-ä½¿ç”¨-Python-å…±äº«å½“å‰ç›®å½•" class="headerlink" title="Tip5 : ä½¿ç”¨ Python å…±äº«å½“å‰ç›®å½•"></a>Tip5 : ä½¿ç”¨ Python å…±äº«å½“å‰ç›®å½•</h2><p>åˆ©ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æš‚æ—¶å¼€å¯ä¸€ä¸ªç«¯å£å·ä¸º 8000 çš„ HTTP æœåŠ¡ï¼Œå…¶ä»–äººåªéœ€è¦åœ¨æµè§ˆå™¨è¾“å…¥ <code>http://ip-address:8000</code> å³å¯æµè§ˆå…±äº«ç›®å½•ä¸‹çš„æ–‡ä»¶</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python -m SimpleHTTPServer</span><br></pre></td></tr></table></figure>


<h2 id="Tip6-åŠ å¯†å’Œè§£å¯†æ–‡ä»¶"><a href="#Tip6-åŠ å¯†å’Œè§£å¯†æ–‡ä»¶" class="headerlink" title="Tip6 : åŠ å¯†å’Œè§£å¯†æ–‡ä»¶"></a>Tip6 : åŠ å¯†å’Œè§£å¯†æ–‡ä»¶</h2><ul>
<li>åŠ å¯†</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar czf - &#123;SRC_DIR&#125; | openssl des3 -salt -k <span class="string">&quot;&#123;KEY&#125;&quot;</span> -out &#123;DIST_PACKAGE&#125;.tar.gz</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<p>ç›®å½•å <code>paris_code</code>ï¼Œç§˜é’¥ <code>meta#com</code>ï¼Œè¾“å‡ºåŒ… <code>paris_code_20161008.tar.gz</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar czf - paris_code | openssl des3 -salt -k <span class="string">&quot;meta#com&quot;</span> -out paris_code_20161008.tar.gz</span><br></pre></td></tr></table></figure>

<ul>
<li>è§£å¯†</li>
</ul>
<p>ç¬¬ä¸€æ­¥ï¼šè·å–ä»£ç å‹ç¼©æ–‡ä»¶åŒ…</p>
<p>ä¸‹è½½åœ°å€ <code>http://XXXX.com/paris_code_20161008.tar.gz</code></p>
<p>ç¬¬äºŒæ­¥ï¼šè§£å¯†æ–‡ä»¶ï¼ˆOS X &#x2F; Linux onlyï¼‰</p>
<p>åœ¨ Terminal è¿›å…¥å‹ç¼©æ–‡ä»¶åŒ…åŒçº§ç›®å½•ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openssl des3 -d -k <span class="string">&quot;meta#com&quot;</span> -salt -<span class="keyword">in</span> paris_code_20161008.tar.gz | tar xzf -</span><br></pre></td></tr></table></figure>

<h2 id="Tip7-iOS-æ‰“åŒ…å‘½ä»¤"><a href="#Tip7-iOS-æ‰“åŒ…å‘½ä»¤" class="headerlink" title="Tip7: iOS æ‰“åŒ…å‘½ä»¤"></a>Tip7: iOS æ‰“åŒ…å‘½ä»¤</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;----------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Begin Build!&quot;</span></span><br><span class="line">PROJECT_NAME=<span class="string">&quot;orbit&quot;</span></span><br><span class="line">BUILD_DATE=<span class="string">&quot;<span class="subst">$(date +&#x27;%Y%m%d&#x27;)</span>&quot;</span></span><br><span class="line">BUNDLE_ID=<span class="string">&quot;com.meta.paris&quot;</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$&#123;WORKSPACE&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#/usr/local/bin/npm install</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$&#123;WORKSPACE&#125;</span>/build&quot;</span> ]; <span class="keyword">then</span> </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ls</span> <span class="variable">$&#123;WORKSPACE&#125;</span>/build/**/*.ipa 1&gt; /dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">rm</span> -rf <span class="variable">$&#123;WORKSPACE&#125;</span>/build/**/*.ipa; </span><br><span class="line">    <span class="keyword">fi</span>;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ls</span> <span class="variable">$&#123;WORKSPACE&#125;</span>/build/**/*.xcarchive 1&gt; /dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">rm</span> -rf <span class="variable">$&#123;WORKSPACE&#125;</span>/build/**/*.xcarchive; </span><br><span class="line">    <span class="keyword">fi</span>;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    <span class="built_in">mkdir</span> <span class="variable">$&#123;WORKSPACE&#125;</span>/build; </span><br><span class="line"><span class="keyword">fi</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;è®¡ç®—ä»Šå¤©çš„ Build Version&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$&#123;WORKSPACE&#125;</span>/build/<span class="variable">$&#123;BUILD_DATE&#125;</span>&quot;</span> ]; <span class="keyword">then</span> </span><br><span class="line">   <span class="comment">#å¦‚æœä¸åŠ ä¸Šé¢çš„ if, Jenkins æ— æ³•ç›´æ¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤â“</span></span><br><span class="line">	BUILD_DATE_COUNT=$(<span class="built_in">ls</span> <span class="variable">$&#123;WORKSPACE&#125;</span>/build | grep <span class="string">&quot;^<span class="variable">$&#123;BUILD_DATE&#125;</span>&quot;</span> -c)</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;BUILD_DATE_COUNT&#125;</span> -lt 10 ]; <span class="keyword">then</span></span><br><span class="line">        BUILD_DATE_COUNT=<span class="string">&quot;0<span class="variable">$&#123;BUILD_DATE_COUNT&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span>;</span><br><span class="line">	BUILD_VERSION=<span class="string">&quot;<span class="variable">$&#123;BUILD_DATE&#125;</span><span class="variable">$&#123;BUILD_DATE_COUNT&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">  	BUILD_VERSION=<span class="variable">$&#123;BUILD_DATE&#125;</span></span><br><span class="line"><span class="keyword">fi</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ä»Šå¤©çš„ Build Version æ˜¯ <span class="variable">$&#123;BUILD_VERSION&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$&#123;WORKSPACE&#125;</span>/build/<span class="variable">$&#123;BUILD_VERSION&#125;</span>&quot;</span> ]; <span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">rm</span> -rf <span class="variable">$&#123;WORKSPACE&#125;</span>/build/<span class="variable">$&#123;BUILD_VERSION&#125;</span>; </span><br><span class="line"><span class="keyword">fi</span>;</span><br><span class="line"><span class="built_in">mkdir</span> <span class="variable">$&#123;WORKSPACE&#125;</span>/build/<span class="variable">$&#123;BUILD_VERSION&#125;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$&#123;WORKSPACE&#125;</span>/Enterprise.plist&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">rm</span> <span class="variable">$&#123;WORKSPACE&#125;</span>/Enterprise.plist; </span><br><span class="line"><span class="keyword">fi</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#http://www.matrixprojects.net/p/xcodebuild-export-options-plist/</span></span><br><span class="line">Enterprise=<span class="string">&#x27;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;plist version=&quot;1.0&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;dict&gt;</span></span><br><span class="line"><span class="string">        &lt;key&gt;teamID&lt;/key&gt;</span></span><br><span class="line"><span class="string">        &lt;string&gt;&lt;/string&gt;</span></span><br><span class="line"><span class="string">        &lt;key&gt;method&lt;/key&gt;</span></span><br><span class="line"><span class="string">        &lt;string&gt;app-store&lt;/string&gt;</span></span><br><span class="line"><span class="string">        &lt;key&gt;uploadSymbols&lt;/key&gt;</span></span><br><span class="line"><span class="string">        &lt;true/&gt;</span></span><br><span class="line"><span class="string">        &lt;key&gt;uploadBitcode&lt;/key&gt;</span></span><br><span class="line"><span class="string">        &lt;false/&gt;</span></span><br><span class="line"><span class="string">&lt;/dict&gt;</span></span><br><span class="line"><span class="string">&lt;/plist&gt;&#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;Enterprise&#125;</span> &gt; <span class="variable">$&#123;WORKSPACE&#125;</span>/Enterprise.plist</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;&#x27;</span> <span class="string">&#x27;s/ProvisioningStyle = Automatic;/ProvisioningStyle = Manual;/g&#x27;</span> \</span><br><span class="line"><span class="variable">$&#123;WORKSPACE&#125;</span>/<span class="variable">$&#123;PROJECT_NAME&#125;</span>.xcodeproj/project.pbxproj</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;&#x27;</span> <span class="string">&#x27;s/DEVELOPMENT_TEAM = .*;/DEVELOPMENT_TEAM = &quot;&quot;;/g&#x27;</span> \</span><br><span class="line"><span class="variable">$&#123;WORKSPACE&#125;</span>/<span class="variable">$&#123;PROJECT_NAME&#125;</span>.xcodeproj/project.pbxproj</span><br><span class="line"></span><br><span class="line"><span class="comment">#åŠ¨æ€ç”Ÿæˆ Build Version</span></span><br><span class="line">sed -i <span class="string">&#x27;&#x27;</span> <span class="string">&quot;/&lt;key&gt;CFBundleVersion&lt;\/key&gt;/&#123;N;s/&lt;string&gt;.*&lt;\/string&gt;/&lt;string&gt;<span class="variable">$&#123;BUILD_VERSION&#125;</span>&lt;\/string&gt;/g;&#125;&quot;</span> \</span><br><span class="line"><span class="variable">$&#123;WORKSPACE&#125;</span>/<span class="variable">$&#123;PROJECT_NAME&#125;</span>/<span class="variable">$&#123;PROJECT_NAME&#125;</span>-Info.plist</span><br><span class="line"></span><br><span class="line">xcodebuild -workspace <span class="variable">$&#123;WORKSPACE&#125;</span>/<span class="variable">$&#123;PROJECT_NAME&#125;</span>.xcworkspace \</span><br><span class="line">-scheme <span class="variable">$&#123;PROJECT_NAME&#125;</span> -sdk iphoneos \</span><br><span class="line">build CODE_SIGN_IDENTITY=<span class="string">&quot;iPhone Distribution: Beijing PS Technology Co., Ltd.&quot;</span> \</span><br><span class="line">PROVISIONING_PROFILE=<span class="string">&quot;&quot;</span> \</span><br><span class="line">-configuration Release clean archive \</span><br><span class="line">-archivePath <span class="variable">$&#123;WORKSPACE&#125;</span>/build/<span class="variable">$&#123;BUILD_VERSION&#125;</span>/<span class="variable">$&#123;PROJECT_NAME&#125;</span>.xcarchive</span><br><span class="line"></span><br><span class="line">xcodebuild -exportArchive -exportOptionsPlist <span class="variable">$&#123;WORKSPACE&#125;</span>/Enterprise.plist \</span><br><span class="line">-archivePath <span class="variable">$&#123;WORKSPACE&#125;</span>/build/<span class="variable">$&#123;BUILD_VERSION&#125;</span>/<span class="variable">$&#123;PROJECT_NAME&#125;</span>.xcarchive \</span><br><span class="line">-exportPath <span class="variable">$&#123;WORKSPACE&#125;</span>/build/<span class="variable">$&#123;BUILD_VERSION&#125;</span>/</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;----------------&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Build successfully!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Begin Upload to itunes...&quot;</span></span><br><span class="line"><span class="comment">#Use [shenzhen](https://github.com/nomad/shenzhen) to upload the ipa file to itunes connect.</span></span><br><span class="line">/usr/local/bin/ipa distribute:itunesconnect -f <span class="variable">$&#123;WORKSPACE&#125;</span>/build/<span class="variable">$&#123;BUILD_VERSION&#125;</span>/<span class="variable">$&#123;PROJECT_NAME&#125;</span>.ipa -a YourAppleID -p YourPassword -i <span class="variable">$&#123;BUNDLE_ID&#125;</span> --upload</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Upload successfully!&quot;</span></span><br></pre></td></tr></table></figure>


<h2 id="Tip8-é‡ç½®-iOS-æ¨¡æ‹Ÿå™¨"><a href="#Tip8-é‡ç½®-iOS-æ¨¡æ‹Ÿå™¨" class="headerlink" title="Tip8: é‡ç½® iOS æ¨¡æ‹Ÿå™¨"></a>Tip8: é‡ç½® iOS æ¨¡æ‹Ÿå™¨</h2><p>ç›¸ä¿¡å„ä½åœ¨åš iOS å¼€å‘çš„åŒå­¦éƒ½ä¼šç¢°åˆ°æ¨¡æ‹Ÿå™¨ä¸Šå„ç§ç¥å¥‡çš„ç°è±¡ï¼Œé€šè¿‡é‡ç½® iOS æ¨¡æ‹Ÿå™¨åŸºæœ¬ä¸Šå¯ä»¥è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// é€€å‡ºå½“å‰çš„æ‰€æœ‰æ¨¡æ‹Ÿå™¨</span><br><span class="line">$ osascript -e <span class="string">&#x27;tell application &quot;iOS Simulator&quot; to quit&#x27;</span></span><br><span class="line">$ osascript -e <span class="string">&#x27;tell application &quot;Simulator&quot; to quit&#x27;</span></span><br><span class="line"></span><br><span class="line">// æ¸…æ‰ä¹‹å‰ä½¿ç”¨æ¨¡æ‹Ÿå™¨äº§ç”Ÿçš„æ‰€æœ‰å†…å®¹</span><br><span class="line">$ xcrun simctl erase all</span><br></pre></td></tr></table></figure>

<h2 id="Tip9-æ¨¡æ‹Ÿå™¨æˆªå›¾"><a href="#Tip9-æ¨¡æ‹Ÿå™¨æˆªå›¾" class="headerlink" title="Tip9: æ¨¡æ‹Ÿå™¨æˆªå›¾"></a>Tip9: æ¨¡æ‹Ÿå™¨æˆªå›¾</h2><p>ä¸‹é¢çš„å‘½ä»¤ä¼šé»˜è®¤æˆªå–ç¬¬ä¸€ä¸ªå¯åŠ¨çš„æ¨¡æ‹Ÿå™¨ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun simctl io booted screenshot screenshot.png</span><br></pre></td></tr></table></figure>

<p>å½“ä½ åŒæ—¶å¯åŠ¨äº†å¤šä¸ªæ¨¡æ‹Ÿå™¨çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å…ˆæŸ¥çœ‹å½“å‰å¯åŠ¨çš„æ¨¡æ‹Ÿå™¨ IDï¼Œç„¶åæŒ‡å®š ID æˆªå›¾ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xcrun simctl list</span><br><span class="line">xcrun simctl io B5EEDDC0-CDA3-46A9-A2B6-FA940D693DFC screenshot screenshot.png</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="extend next" rel="next" href="/blog/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">å¸•å¸•</p>
  <div class="site-description" itemprop="description">å¥‹æ–—ä¸­çš„ç¨‹åºå‘˜ã€‚</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hparis" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;hparis" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/404_Shelter" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;404_Shelter" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">å¸•å¸•</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>




  















  

  

</body>
</html>
